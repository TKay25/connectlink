<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>ConnectLink Admin System</title>
        <meta name="mobile-web-app-capable" content="yes">
        <!-- <link rel="icon" type="image/png" href="{{ url_for('static', filename='images/eds blue.png') }}"> -->
        <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
        <link href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css" rel="stylesheet">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
        <link href="https://cdn.jsdelivr.net/npm/choices.js/public/assets/styles/choices.min.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
        <style>
        /* Main Styling */
        body {
            font-family: 'Roboto', sans-serif;
            background: linear-gradient(to right, #f0f2f5, #e9f1fb);
            margin: 0;
            min-height: 100vh;
            display: flex;
            overflow-x: hidden;
        }

        /* Sidebar Styling */
        .sidebar {
            width: 250px;
            background-color: #1E2A56;
            color: #fff;
            padding-top: 40px;
            position: fixed;
            height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            box-shadow: 4px 0 10px rgba(0, 0, 0, 0.2);
            transition: width 0.3s;
        }

        #editinfocompModal {
            z-index: 1061 !important;
        }

        .modal-backdrop.show:nth-of-type(2) {
            z-index: 1060 !important;
        }

        .sidebar:hover {
            width: 270px;
        }

        .sidebar h5 {
            font-weight: bold;
            margin-bottom: 30px;
            font-size: 1.2rem;
        }

        .sidebar img {
            max-width: 150px;
            margin-bottom: 20px;
        }

        .sidebar .btn {
            color: #1E2A56;
            background-color: #fff;
            width: 150px;
            margin: 5px 0;
            padding: 8x;
            border: 3px solid #1E2A56;
            border-radius: 8px;
            font-size: 0.9rem;
            transition: background 0.3s;
            text-align: center;
            font-weight: 600;
        }

        .sidebar .btn:hover {
            background-color: #1E2A56;
            color: #fff;
            border: 3px solid white;
            box-shadow: 0 5px 8px rgba(0, 0, 0, 0.15);
        }

        .btn-danger-2{
            color: white;
            background-color: red;
            width: 15%;
            margin: 8px 0;
            padding: 5px;
            border-radius: 8px;
            border: 3px solid red;
            font-size: 0.9rem;
            transition: background 0.3s;
            text-align: center;
            font-weight: 500;

        }
        .btn-danger-2:hover{
            background-color: white;
            color: red;
            border: 3px solid red;
            box-shadow: 0 5px 8px rgba(0, 0, 0, 0.15);
        }



        .btn-primary{
            color: white;
            background-color: #1E2A56;
            width: 15%;
            margin: 8px 0;
            padding: 5px;
            border-radius: 8px;
            border: 3px solid #1E2A56;
            font-size: 0.9rem;
            transition: background 0.3s;
            text-align: center;
            font-weight: 500;

        }
        .btn-primary:hover{
            background-color: white;
            color: #1E2A56;
            border: 3px solid #1E2A56;
            box-shadow: 0 5px 8px rgba(0, 0, 0, 0.15);
        }

        .btn-primary10{
            color: #1E2A56;
            background-color: white;
            width: 15%;
            margin: 8px 0;
            padding: 5px;
            border-radius: 8px;
            border: 3px solid #1E2A56;
            font-size: 0.9rem;
            transition: background 0.3s;
            text-align: center;
            font-weight: 600;

        }
        .btn-primary10:hover{
            background-color: #e9f1fb;
            color: #1E2A56;
            border: 3px solid #1E2A56;
            box-shadow: 0 5px 8px rgba(0, 0, 0, 0.15);
        }

        .btn-primary2{
            color: white;
            background-color: #1E2A56;
            width: 37%;
            margin: 8px 0;
            padding: 6px;
            border-radius: 8px;
            border: 3px solid #1E2A56;
            font-size: 0.9rem;
            transition: background 0.3s;
            text-align: center;
            font-weight: 500;

        }
        .btn-primary2:hover{
            background-color: white;
            color: #1E2A56;
            border: 3px solid #1E2A56;
            box-shadow: 0 5px 8px rgba(0, 0, 0, 0.15);
        }
        .btn-primary9{
            color: white;
            background-color: #1E2A56;
            margin: 8px 0;
            padding: 5px;
            border-radius: 8px;
            border: 3px solid #1E2A56;
            transition: background 0.3s;
            text-align: center;
            font-weight: 500;

        }
        .btn-primary9:hover{
            background-color: white;
            color: #1E2A56;
            border: 3px solid #1E2A56;
            box-shadow: 0 5px 8px rgba(0, 0, 0, 0.15);
        }

        .btn-primary3{
            color: white;
            background-color: #1E2A56;
            width: 100%;
            padding-left: 5px;
            padding-right: 5px;
            padding-top: 1px;
            padding-bottom: 1px;
            border-radius: 8px;
            border: 3px solid #1E2A56;
            font-size: 13px;
            transition: background 0.3s;
            text-align: center;
            font-weight: 500;

        }
        .form-control-blue {
            background-color: #1E2A5611; /* Example */
            border: 1px solid #ccc;
            appearance: auto; /* Ensure native dropdown appearance */
            padding: 8px 12px;
        }


        .btn-primary3:hover{
            background-color: white;
            color: #1E2A56;
            border: 3px solid #1E2A56;
        }

        /* Main Content Styling */
        .main-content {
            margin-left: 270px;
            padding: 30px;
            width: calc(100% - 270px);
            background-color: #ffffff;
            min-height: 100vh;
        }


        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 4px;
            background-color: #e9f1fb;
            border-radius: 15px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            margin-bottom: 10px;
        }

        .current-date {
            color: #1E2A56;
            font-weight: bold;
            font-size: smaller;
            font-size: 1rem;
        }

        .employeetag {
            color: #1E2A56;;
            font-size: 1.1rem;
            font-weight: 800;
            text-transform: uppercase;

        }

        /* Tab Styling */
        .nav-tabs .nav-link {
            color: #1E2A56;
            font-weight: 600;
            padding: 12px 25px;
            font-size: 16px;
            border-radius: 8px 8px 0 0;
            background: #e9f1fb;
            transition: background 0.3s ease, color 0.3s ease;
        }

        .nav-tabs .nav-link.active {
            color: #ffffff;
            background-color: #1E2A56;
            font-weight: 800;
        }

        /* Card Styling */
        .card {
            border-radius: 12px;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.1);
            padding: 20px;
            margin-top: 20px;
            background-color: #ffffff;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .modal-content {
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
            }
        .modal-header{
            background-color: #1E2A56;
            color: white;
            font-weight: bold;
        }
        .form-group {
            margin-bottom: 20px; /* Increase vertical spacing between fields */
            }

        .btn-center {
            display: flex;
            justify-content: center;
            justify-content: space-between; 
            gap: 10px;
            }

        .form-control-blue::after {
            content: '\25BC'; /* Unicode for downwards triangle */
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            color: white; /* Arrow color */
            font-size: 18px;
        }

        /* Style for disabled option (making it grey) */
        .form-control-blue option:disabled {
            background-color: #A9A9A9; /* Grey background */
            color: #D3D3D3; /* Grey text color */
        }

        .table-theme {
            width: 100%;
            border-collapse: collapse;
            table-layout: auto; /* Allow columns to adjust based on content */
        }

        .table-theme th {
            background-color: #1E2A56;
            color: white;
            text-align: center !important;
            vertical-align: middle !important;
            padding: 2px;
            font-weight: bold;
            white-space: nowrap; /* Prevent text wrapping */
        }

        #employeesTable th,
        #employeespayrollTable th, 
        #employeespersonalTable th,
        #employeesaccumulatorsTable th, 
        #employeesbulk1Table th, 
        #employeesbulkbalancesTable th, 
        #removeemployeesTable th {
            position: sticky;
            top: 0;
            z-index: 1;
        }


        .table-theme td {
            font-weight: 500;
            padding: 0px;
            color: #1E2A56;
            text-align: center;
            white-space: nowrap; /* Prevent text wrapping */
            border-bottom: 1px solid #ddd;
        }


        .container2 {
            font-size: 13px;
            margin-top: -2rem;
        }
        /* Custom scrollbar styling */
        .container2::-webkit-scrollbar {
            width: 12px; /* Width of the scrollbar */
        }

        .container2::-webkit-scrollbar-thumb {
            background-color: #1E2A56; /* Scrollbar thumb color */
            border-radius: 5px; /* Rounded corners for thumb */
        }

        .container2::-webkit-scrollbar-thumb:hover {
            background-color: #e9f1fb;
            box-shadow: inset 0 0 0 3px #1E2A56; /* Simulates a border */
        }

        .container2::-webkit-scrollbar-track {
            background-color: #f0f0f0; /* Scrollbar track color */
            border-radius: 5px; /* Rounded corners for track */
        }
        .form-group label{
            font-weight: bold;
        }
        /* For WebKit-based browsers (Chrome, Edge, Safari) */
        #employeeList::-webkit-scrollbar {
            width: 15px; /* Width of the scrollbar */
        }

        #employeeList::-webkit-scrollbar-thumb {
            background-color: #1E2A56; /* Blue color for the scrollbar handle */
            border-radius: 5px; /* Rounded scrollbar handle */
        }

        #employeeList::-webkit-scrollbar-track {
            background-color: #f1f1f1; /* Background color of the scrollbar track */
        }

        /* For Firefox */
        #employeeList {
            scrollbar-color: #1E2A56 #f1f1f1; /* Handle color followed by track color */
        }
        select.form-control-blue option:hover {
            background-color: #e6f0ff; /* Light blue on hover */
            color: #1E2A56; /* Dark blue text */
        }
        /* Style the close button */
        .modal-header .btn-close {
            background-color: white; /* Makes the background white */
            color: black; /* Change the icon color to black */
            opacity: 1; /* Ensure the button is fully opaque */
        }

        /* Optional: Hover effect */
        .modal-header .btn-close:hover {
            background-color: #f8f9fa; /* Light grey background on hover */
            color: #000; /* Ensure the icon stays black on hover */
            opacity: 1; /* Ensure full opacity on hover */
        }
        .modal-footer{
            gap: 10px;
        }

        /* Default background color for editable fields */
        .editable-field {
            border-radius: 8px;
            background-color: #e6f0ff; /* Light blue when not being edited */
            border: rgba(0, 0, 0, 0.2) solid #1E2A56; /* Light border */
            transition: background-color 0.3s ease;
        }

        /* Background color when the field is focused (being edited) */
        .editable-field:focus {
            background-color: #1E2A56; /* Change to light yellow when being edited */
            color: white; /* Dark blue border when focused */
            outline: none; /* Remove the default outline */
        }

        /* Style the checkboxes */
        .custom-checkbox {
            width: 25px; /* Make the checkbox bigger */
            height: 25px; /* Make the checkbox bigger */
            background-color: #e6f0ff; /* Dark blue background */
            border-radius: 8px; /* Optional: round the corners */
            border: 3px solid #1E2A56; /* Dark blue border */
            appearance: none; /* Remove default checkbox style */
            position: relative;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .custom-checkbox:checked {
            background-color: #1E2A56; /* Dark blue when checked */
            border-color: #1E2A56; /* Dark blue border when checked */
        }

        .custom-checkbox:checked::after {
            content: '\2713'; /* Checkmark symbol */
            position: absolute;
            top: 0;
            left: 4px; /* Adjust position of the checkmark */
            color: white; /* White color for the checkmark */
            font-size: 15px; /* Make the checkmark larger */
        }

        #removeemployeesTable input[type="checkbox"] {
            margin-right: 10px;
        }

        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8); /* Semi-transparent background */
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            color: white;
            font-size: 18px;
            z-index: 9999;
        }

        .loading-spinner {
            border: 8px solid #f3f3f3; /* Light grey background color */
            border-top: 8px solid #1E2A56; /* Blue spinner color */
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }


        .uppercase-text {
        text-transform: uppercase;
        }

        .form-select {
            padding: 5px 10px;
            font-size: 0.9rem;
            border-radius: 10px;
            border: 3px solid  #1E2A56;
            font-weight: 800;
            outline: none;
            color:#1E2A56;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);

        }
        /* Black overlay */
        .dropdown-overlay {
            position: fixed;  /* Covers the entire screen */
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7); /* Black with 70% opacity */
            z-index: 10; /* Ensure it appears above everything */
            display: none; /* Initially hidden */
        }

        .dropdown-overlayxx {
            position: fixed;  /* Covers the entire screen */
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7); /* Black with 70% opacity */
        }


        .dropdown-menu .dropdown-item {
        color: #1E2A56;
        font-weight: 500;
        }
        .dropdown-menu .dropdown-item:hover {
            background-color: #1E2A56; /* Dark blue background on hover */
            color: white; /* White text color on hover */
            transition: background-color 0.3s ease, color 0.3s ease; /* Smooth transition */
            cursor: pointer;
        }
        .otherleave{
            display: none;
        }



        .modal-body{
            color: #1E2A56;
        }
        #chartContainer {
            margin-top: 20px;
            width: 230px;  /* Reduce chart size */
        }
        .dropdownfilter {
            position: relative;
            display: inline-block;
        }
        .dropdownfilter-toggle {
            background-color: #1E2A56;
            color: white;
            padding: 2px 12px;
            border: none;
            cursor: pointer;
            border-radius: 5px;
            font-weight: 500;
        }
        .dropdownfilter-content {
            display: none;
            position: absolute;
            background-color: white;
            box-shadow: 0px 4px 8px rgba(0,0,0,0.2);
            z-index: 1;
            padding: 3px;
            border-radius: 5px;
        }
        .dropdownfilter-content label {
            display: block;
            margin-bottom: 5px;
            cursor: pointer;
            color: #1E2A56;
        }
        .dropdownfilter:hover .dropdownfilter-content {
            display: block;
        }

        .eds-loader {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            font-family: 'Century Gothic', sans-serif;  
        }
        
        .eds-logo {
            color: white;
            font-size: 1rem;
            font-weight: bold;
            margin-bottom: 20px;
            text-align: center;
            text-shadow: 0 0 10px #1E2A56;
        }
        
        .eds-tagline {
            color: #fff;
            font-size: 0.6rem;
            margin-bottom: 30px;
            opacity: 0.8;
        }
        
        .loader-bar {
            width: 300px;
            height: 4px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 2px;
            overflow: hidden;
            position: relative;
        }
        
        .loader-progress {
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, White, #1E2A56);
            animation: load 3s ease-in-out infinite;
            border-radius: 2px;
        }
        
        @keyframes load {
            0% { width: 0%; left: 0; }
            50% { width: 100%; left: 0; }
            100% { width: 0%; left: 100%; }
        }
        
        .eds-grid {
            display: grid;
            grid-template-columns: repeat(4, 20px);
            gap: 10px;
            margin-top: 30px;
        }
        
        .grid-item {
            width: 20px;
            height: 20px;
            background: rgba(0, 255, 252, 0.2);
            animation: pulse 1.5s ease-in-out infinite;
        }
        
        .grid-item:nth-child(1) { animation-delay: 0s; }
        .grid-item:nth-child(2) { animation-delay: 0.2s; }
        .grid-item:nth-child(3) { animation-delay: 0.4s; }
        .grid-item:nth-child(4) { animation-delay: 0.6s; }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 0.2; }
            50% { transform: scale(1.2); opacity: 1; background: #336699; }
        }



        .dashboard-summary {
            display: grid;
            grid-template-columns: repeat(5, 1fr); /* 4 columns */
            gap: 20px;
            margin-top: 20px;
        }

        .summary-card {
            flex: 1 1 calc(33.33% - 10px);
            background-color: #f0f4f8;
            padding: 4px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            font-size: 10px;
        }

        .summary-card .icon {
            font-size: 15px;
            margin-right: 10px;
        }

        .summary-card .details h5 {
            margin: 0;
            font-size: 13px;
            color: #1E2A56;
        }

        .summary-card .details p {
            margin: 0;
            font-size: 14px;
            font-weight: bold;
        }

        .dashboard-graphs {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .graph-card {
            background-color: #ffffff;
            padding: 10px;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            font-size: 12px;
        }

        .graph-card h6 {
            margin-bottom: 10px;
            font-size: 13px;
            font-weight: bold;
            color: #1E2A56;
        }

        .sidebar .accordion-button {
            background-color: #f8f9fa;
            border-radius: 0 !important;
            box-shadow: none;
            cursor: pointer;
        }

        .sidebar .accordion-button:hover {
            background-color: #e9ecef;
        }

        .sidebar .accordion-item {
            border-radius: 0 !important;
        }

        .sidebar .list-group-item {
            border-radius: 0 !important;
            border-left: none;
            border-right: none;
            font-size: 0.95rem;
        }

        /* Remove default Bootstrap accordion arrow for this item */
        .accordion-item:has(.bi-people-fill) .accordion-button::after, .accordion-item:has(.bi-wallet-fill) .accordion-button::after {
            display: none;
        }


    </style>
</head>

<body>
    <div class="eds-loader" id="edsLoader" style="display: none;">
        <div class="eds-logo"><img src="{{ url_for('static', filename='images/web-logo.png') }}"  alt="Logo" class="logo" style="width: 200px;"></div> 

        <br><br>
        <p style="font-weight: 700;color: white;font-size: 1.2rem;">We Are Commiting Your Changes {{user_name}}, Please Wait...</p>

        <div class="loader-bar">
            <div class="loader-progress"></div>
        </div>
        
        <div class="eds-grid">
            <div class="grid-item"></div>
            <div class="grid-item"></div>
            <div class="grid-item"></div>
            <div class="grid-item"></div>
        </div>
    </div>
    
    <div class="sidebar p-2">
        <br><br>
        <div class="eds-logo"><img style="width: 350px;" src="{{ url_for('static', filename='images/web-logo-white.png') }}"  alt="Logo" class="logo" style="width: 200px;"></div> 

        <br>
        <h6 class="mb-3 text-center">ADMINISTRATION SYSTEM</h6>

        <button class="btn w-100 d-flex justify-content-between align-items-center border rounded-2 mb-2 p-2"
                id="addnewprojectBtn" data-bs-toggle="modal" data-bs-target="#addnewProjectModal">
            <span><i class="bi bi-briefcase-fill me-2"></i> Add New Project</span>
        </button>

        <button class="btn w-100 d-flex justify-content-between align-items-center border rounded-2 mb-2 p-2"
                id="addnewprojectBtn">
            <span><i class="bi bi-briefcase-fill me-2"></i> Push Payment Reminders</span>
        </button>

        <button class="btn w-100 d-flex justify-content-between align-items-center border rounded-2 mb-2 p-2"
                id="addnewprojectBtn">
            <span><i class="bi bi-briefcase-fill me-2"></i> Create System User</span>
        </button>

        <button class="btn w-100 d-flex justify-content-between align-items-center border rounded-2 mb-2 p-2"
                data-bs-toggle="modal"
                data-bs-target="#addcompAdminModal">
            <span><i class="bi bi-briefcase-fill me-2"></i> Manage Administrators</span>
        </button>

    </div>


    <div class="modal fade" id="addcompAdminModal" tabindex="-1" aria-labelledby="addcompAdminModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content">

            <!-- Modal Header -->
            <div class="modal-header">
                <h5 class="modal-title" id="addcompAdminModalLabel">ADMINISTRATORS</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>

            <!-- Modal Body -->
            <div class="modal-body">

                    <div class="container mt-5">
                        <div class="container2" style="max-height: 450px; overflow-y: auto;">
                            {{ table_datamain_admins_html|safe }}
                        </div>
                    </div>

            </div>

            <!-- Modal Footer -->
            <div class="modal-footer">
                <button class="btn btn-primary" id="addAdminplusBtn" style="width: max-content;"
                        data-bs-toggle="modal" data-bs-target="#addAdminplusModal">
                    <i class="bi bi-person-plus"></i> Add Administrator
                </button>

                <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Close</button>

            </div>

            </div>
        </div>
    </div>

    <div class="modal fade" id="viewprojectModal" tabindex="-1" aria-labelledby="viewprojectModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl modal-dialog-centered modal-dialog-scrollable">
            <div class="modal-content">

            <div class="modal-header">
                <h5 class="modal-title" id="viewprojectModalLabel">Project Details</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>

            <div class="modal-body">
                <table class="table table-striped table-borderless">
                    <tbody id="projectDetailsBody">
                        <!-- Filled dynamically with JS -->
                    </tbody>
                </table>
            </div>

            <div class="modal-footer">
                <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Close</button>
            </div>

            </div>
        </div>
        </div>


    <div class="modal fade" id="addAdminplusModal" tabindex="-1" aria-labelledby="addAdminplusModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-md modal-dialog-centered">
            <div class="modal-content">

            <div class="modal-header">
                <h5 class="modal-title" id="addAdminplusModalLabel">ADD ADMINISTRATOR</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>

            <div class="modal-body">

                <form id="adminForm">
                    <div class="mb-3">
                        <label class="form-label fw-bold">Full Name</label>
                        <input type="text" class="form-control" id="adminName" name="adminName" placeholder="Enter Admin full name">
                    </div>

                    <div class="mb-3">
                        <label class="form-label fw-bold">Contact Phone</label>
                        <input type="text" class="form-control" id="adminPhone" name="adminPhone" placeholder="e.g. +263 77 123 4567">
                    </div>
                </form>

            </div>

            <div class="modal-footer">
                <button type="button" class="btn btn-success d-flex align-items-center" id="saveAdminBtn" style="gap:6px;">
                    <span id="saveText"><i class="bi bi-check-circle"></i> Save</span>
                    <div id="saveLoader" class="spinner-border spinner-border-sm text-light d-none" role="status"></div>
                </button>

                <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Close</button>
            </div>

            </div>
        </div>
    </div>



    <div class="modal fade" id="addnewProjectModal" tabindex="-1" aria-labelledby="addnewProjectModalLabel" aria-hidden="true">
        <div class="modal-dialog" style="max-width: 80%;">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addnewProjectModalLabel"><i class="bi bi-briefcase-fill"></i> NEW PROJECT</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">

                    <form id="addProjectForm">

                        <!-- Row for side-by-side cards -->
                        <div class="row g-3">

                            <!-- CLIENT DETAILS CARD -->
                            <div class="col-md-4">
                                <div class="card" style="padding:15px;">

                                    <h6 style="background-color:#1E2A56; font-weight:800;color: white;text-align: center;padding: 1%;">CLIENT DETAILS</h6>

                                    <div class="form-group row align-items-center" style="margin-bottom: 0.5rem;">
                                        <label for="person_name" class="col-auto col-form-label" style="padding-right: 0.5rem;">Name:</label>
                                        <div class="col">
                                            <input type="text" class="form-control editable-field" id="client_name" name="client_name" required>
                                        </div>
                                    </div>

                                    <div class="form-group row align-items-center" style="margin-bottom: 0.5rem;">
                                        <label for="national_id" class="col-auto col-form-label" style="padding-right: 0.5rem;">National ID Number:</label>
                                        <div class="col">
                                            <input type="text" class="form-control editable-field" id="client_national_id" name="client_national_id" required>
                                        </div>
                                    </div>



                                    <div class="form-group row align-items-start" style="margin-bottom: 0.5rem;">
                                        <label for="address" class="col-auto col-form-label" style="padding-right: 0.5rem;">Address:</label>
                                        <div class="col">
                                            <textarea class="form-control editable-field" id="client_address" rows="3" name="client_address" required></textarea>
                                        </div>
                                    </div>


                                    <div class="form-group row align-items-center" style="margin-bottom: 0.5rem;">
                                        <label for="whatsapp_number" class="col-auto col-form-label" style="padding-right: 0.5rem;">Whatsapp Number:</label>
                                        <div class="col">
                                            <input type="text" class="form-control editable-field" id="client_whatsapp_number" name="client_whatsapp_number" required>
                                        </div>
                                    </div>

                                    <div class="form-group row align-items-center" style="margin-bottom: 0.5rem;">
                                        <label for="email_address" class="col-auto col-form-label" style="padding-right: 0.5rem;">Email:</label>
                                        <div class="col">
                                            <input type="email" class="form-control editable-field" id="client_email" name="client_email" required>
                                        </div>
                                    </div>


                                </div>
                            </div>

                            <!-- NEXT OF KIN DETAILS CARD -->
                            <div class="col-md-4">
                                <div class="card" style="padding:15px;">

                                    <h6 style="background-color:#1E2A56; font-weight:800;color: white;text-align: center;padding: 1%;">NEXT OF KIN DETAILS</h6>

                                    <div class="form-group row align-items-center" style="margin-bottom: 0.5rem;">
                                        <label for="person_name" class="col-auto col-form-label" style="padding-right: 0.5rem;">Name:</label>
                                        <div class="col">
                                            <input type="text" class="form-control editable-field" id="next_of_kin_name" name="next_of_kin_name" required>
                                        </div>
                                    </div>

                                    <div class="form-group row align-items-center" style="margin-bottom: 0.5rem;">
                                        <label for="person_address" class="col-auto col-form-label" style="padding-right: 0.5rem;">Address:</label>
                                        <div class="col">
                                            <textarea class="form-control editable-field" id="next_of_kin_address" rows="3" name="next_of_kin_address" required></textarea>
                                        </div>
                                    </div>

                                    <div class="form-group row align-items-center" style="margin-bottom: 0.5rem;">
                                        <label for="contact_number" class="col-auto col-form-label" style="padding-right: 0.5rem;">Contact Number:</label>
                                        <div class="col">
                                            <input type="text" class="form-control editable-field" id="next_of_kin_contact_number" name="next_of_kin_contact_number" required>
                                        </div>
                                    </div>

                                    <div class="form-group row align-items-center" style="margin-bottom: 0.5rem;">
                                        <label for="relationship" class="col-auto col-form-label" style="padding-right: 0.5rem;">Relationship:</label>
                                        <div class="col">
                                            <input type="text" class="form-control editable-field" id="relationship" name="relationship" required>
                                        </div>
                                    </div>


                                </div>

                            </div>



                            <div class="col-md-4">
                                <div class="card" style="padding:15px;">
                                    <!-- CONTRACTOR DETAILS -->
                                    <h6 style="background-color:#1E2A56; font-weight:800;color: white;text-align: center;padding: 1%;">CONTRACTOR DETAILS</h6>

                                    <div class="form-group row align-items-center" style="margin-bottom: 0.5rem;">
                                        <label for="contractor_name" class="col-auto col-form-label" style="padding-right: 0.5rem;">Name:</label>
                                        <div class="col">
                                            <input type="text" class="form-control editable-field" id="contractor_name" value="ConnectLink Properties" readonly>
                                        </div>
                                    </div>


                                    <div class="form-group">
                                        <label>Address:</label>
                                        <input type="text" class="form-control editable-field" value="38A Coronation Avenue Greendale Harare" readonly>
                                    </div>

                                    <div class="form-group">
                                        <label>Contact Number</label>
                                        <input type="text" class="form-control editable-field" value="+263 773 368 558 ; +263 716 788 838" readonly>
                                    </div>

                                    <div class="form-group row align-items-center" style="margin-bottom: 0.5rem;">
                                        <label for="contractor_email" class="col-auto col-form-label" style="padding-right: 0.5rem;">Email:</label>
                                        <div class="col">
                                            <input type="email" class="form-control editable-field" id="contractor_email" value="info@connectlinkproperties.co.zw" readonly>
                                        </div>
                                    </div>

                                    <div class="form-group">
                                        <label>Administrator:</label>
                                        <select class="form-control-blue editable-field" id="projectadministrator" name="projectadministrator" required>
                                            <option value="" disabled selected>Select Administrator</option>
                                            {% for option in admin_options %}
                                                <option value="{{ option }}">{{ option }}</option>
                                            {% endfor %}
                                        </select>
                                    </div>

                                </div>
                            </div>

                            <div class="col-md-6">
                                <div class="card" style="padding:15px;">
                                    <!-- PROJECT DETAILS -->
                                    <h6 style="background-color:#1E2A56; font-weight:800;color: white;text-align: center;padding: 1%;">PROJECT DETAILS</h6>

                                    <div class="form-group row align-items-center" style="margin-bottom: 0.5rem;">
                                        <label for="project_name" class="col-auto col-form-label" style="padding-right: 0.5rem;">Project Name:</label>
                                        <div class="col">
                                            <input type="text" class="form-control editable-field" id="project_name" name="project_name" required>
                                        </div>
                                    </div>

                                    <div class="form-group row align-items-center" style="margin-bottom: 0.5rem;">
                                        <label for="project_location" class="col-auto col-form-label" style="padding-right: 0.5rem;">Project Location:</label>
                                        <div class="col">
                                            <input type="text" class="form-control editable-field" id="project_location" name="project_location" required>
                                        </div>
                                    </div>


                                    <div class="form-group">
                                        <label>Project Scope:</label>
                                        <textarea class="form-control editable-field" rows="3" id="project_description" name="project_description" required></textarea>
                                    </div>

                                    <div class="form-group row align-items-center" style="margin-bottom: 0.5rem;">
                                        <label for="project_start_date" class="col-auto col-form-label" style="padding-right: 0.5rem;">Project Start Date:</label>
                                        <div class="col">
                                            <input type="date" class="form-control editable-field" id="project_start_date" name="project_start_date" required>
                                        </div>
                                    </div>

                                    <div class="form-group row align-items-center" style="margin-bottom: 0.5rem;">
                                        <label for="months_to_completion" class="col-auto col-form-label" style="padding-right: 0.5rem;">Project Duration (Days):</label>
                                        <div class="col">
                                            <input type="number" class="form-control editable-field" id="months_to_completion" name="months_to_completion" required>
                                        </div>
                                    </div>

                                </div>
                            </div>

                            <div class="col-md-6">
                                <div class="card" style="padding:15px;">

                        
                                    <!-- PAYMENT TERMS -->
                                    <h6 style="background-color:#1E2A56; font-weight:800;color: white;text-align: center;padding: 1%;">PAYMENT TERMS</h6>

                                    <div class="form-group row align-items-center" style="margin-bottom: 0.5rem;">
                                        <label for="agreement_date" class="col-auto col-form-label" style="padding-right: 0.5rem;">Contract Agreement Date:</label>
                                        <div class="col">
                                            <input type="date" class="form-control editable-field" id="agreement_date" name="agreement_date" required>
                                        </div>
                                    </div>


                                    <div class="form-group row align-items-center" style="margin-bottom: 0.5rem;">
                                        <label class="col-auto col-form-label" style="padding-right: 0.5rem;">Total Contract Price (USD):</label>
                                        <div class="col">
                                            <input type="number" class="form-control editable-field" id="total_contract_price" name="total_contract_price" required>
                                        </div>
                                    </div>

                                    <div class="form-group row align-items-center" style="margin-bottom: 0.5rem;">
                                        <label class="col-auto col-form-label" style="padding-right: 0.5rem;">Late Payment Interest (% p.a):</label>
                                        <div class="col">
                                            <input type="number" class="form-control editable-field" id="late_payment_interest" name="late_payment_interest" required>
                                        </div>
                                    </div>

                                    <div class="form-group">
                                        <label>Payment Method:</label>
                                        <select class="form-control-blue editable-field" id="paymentMethod" name="payment_method" required>
                                            <option value="" disabled selected>Select Payment Method</option>
                                            <option value="Installments">Installments</option>
                                            <option value="Bullet">Bullet</option>
                                        </select>
                                    </div>

                                    <div class="form-group row align-items-start" id="bullet_payment_date" style="display: none; margin-bottom: 0.5rem;">
                                        <label for="bullet_payment_date" class="col-auto col-form-label" style="padding-right: 0.5rem;">Date Full Payment Made:</label>
                                        <div class="col">
                                            <input type="date" class="form-control editable-field" id="bullet_payment_date" name="bullet_payment_date" required>
                                        </div>
                                    </div>



                                    <div id="paymentschedule" style="display: none;">


                                        <div class="form-group row align-items-center" style="margin-bottom: 0.5rem;">
                                            <label for="monthstopay" class="col-auto col-form-label" style="padding-right: 0.5rem;">Months To Pay:</label>
                                            <div class="col">
                                                <input type="number" class="form-control editable-field" id="monthstopay" name="months_to_pay" style="width: 40%;" required>
                                            </div>
                                        </div>

                                        <div class="form-group row align-items-center" style="margin-bottom: 0.5rem;">
                                            <label class="col-auto col-form-label" style="padding-right: 0.5rem;">Deposit Required (USD):</label>
                                            <div class="col">
                                                <input type="number" class="form-control editable-field" id="deposit_required" name="deposit_required" readonly>
                                            </div>
                                        </div>

                                        <div class="form-group row align-items-center" style="margin-bottom: 0.5rem;">
                                            <label for="deposit_payment_date" class="col-auto col-form-label" style="padding-right: 0.5rem;">Date Deposit Paid:</label>
                                            <div class="col">
                                                <input type="date" class="form-control editable-field" id="deposit_payment_date" name="deposit_payment_date" required>
                                            </div>
                                        </div>

                                        <div class="form-group row align-items-center" style="margin-bottom: 0.5rem;">
                                            <label for="first_installment_due_date" class="col-auto col-form-label" style="padding-right: 0.5rem;">Due Date For First Installment:</label>
                                            <div class="col">
                                                <input type="date" class="form-control editable-field" id="first_installment_due_date" name="first_installment_due_date" required>
                                            </div>
                                        </div>

                                    </div>

                                </div>

                            </div>
                        </div>

                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="saveProjectBtn" style="width: max-content;">Save Project</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Update Project Modal -->
    <div class="modal fade" id="updateModal" tabindex="-1" aria-labelledby="updateModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header" style="background-color: #1E2A56; color: white;">
                    <h5 class="modal-title" id="updateModalLabel">Update Project Details</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="updateProjectForm">
                        <input type="hidden" id="updateProjectId" name="project_id">
                        
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="updateClientName" class="form-label fw-bold">Client Name</label>
                                <input type="text" class="form-control" id="updateClientName" readonly>
                            </div>
                            <div class="col-md-6">
                                <label for="updateProjectName" class="form-label fw-bold">Project Name</label>
                                <input type="text" class="form-control" id="updateProjectName" readonly>
                            </div>
                        </div>
                        
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="updateAdminName" class="form-label fw-bold">Administrator Name</label>
                                <input type="text" class="form-control" id="updateAdminName" readonly>
                            </div>
                            <div class="col-md-6">
                                <label for="updateCompletionStatus" class="form-label fw-bold">Completion Status</label>
                                <select class="form-select" id="updateCompletionStatus" name="completion_status">
                                    <option value="Not Started">Not Started</option>
                                    <option value="In Progress">In Progress</option>
                                    <option value="On Hold">On Hold</option>
                                    <option value="Completed">Completed</option>
                                    <option value="Cancelled">Cancelled</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="card mb-3">
                            <div class="card-header bg-light">
                                <h6 class="mb-0">Installment 1 Details</h6>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-4">
                                        <label for="updateInstallment1Amount" class="form-label fw-bold">Amount (USD)</label>
                                        <input type="text" class="form-control" id="updateInstallment1Amount" readonly>
                                    </div>
                                    <div class="col-md-4">
                                        <label for="updateInstallment1DueDate" class="form-label fw-bold">Due Date</label>
                                        <input type="text" class="form-control" id="updateInstallment1DueDate" readonly>
                                    </div>
                                    <div class="col-md-4">
                                        <label for="updateInstallment1PaidDate" class="form-label fw-bold">Paid Date</label>
                                        <input type="date" class="form-control" id="updateInstallment1PaidDate" name="installment1_paid_date">
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- You can add more installments here if needed -->
                        <div class="card mb-3">
                            <div class="card-header bg-light">
                                <h6 class="mb-0">Additional Information</h6>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-6">
                                        <label for="updateProjectLocation" class="form-label fw-bold">Project Location</label>
                                        <input type="text" class="form-control" id="updateProjectLocation" name="project_location">
                                    </div>
                                    <div class="col-md-6">
                                        <label for="updateTotalContractPrice" class="form-label fw-bold">Total Contract Price (USD)</label>
                                        <input type="text" class="form-control" id="updateTotalContractPrice" name="total_contract_price">
                                    </div>
                                </div>
                                <div class="row mt-3">
                                    <div class="col-12">
                                        <label for="updateProjectDescription" class="form-label fw-bold">Project Description</label>
                                        <textarea class="form-control" id="updateProjectDescription" name="project_description" rows="3"></textarea>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="saveUpdateChanges">Save Changes</button>
                </div>
            </div>
        </div>
    </div>

    <main class="main-content" id="main-content">
        <header>
            <div class="employeetag">{{user_name}}, CONNECTLINK PROPERTIES <span style="color: white;background-color: #1E2A56;border-radius: 10px;padding: 6px;font-size: 13px;">ID: {{userid}}</span></div>
            <div><span class="current-date" id="currdate">DATE: {{ today_date }}</span></div>
            <span id="name-down" value="{{firstname}}" style="display: none;"></span>
            <span id="name-down2" value="{{surname}}" style="display: none;"></span>

            <button onclick="window.location.href='/logout'" class="btn btn-primary" style="width: max-content;">  Logout<i class="bi bi-door-closed-fill" style="margin-left: 7px;"></i>  </button>

        </header>

        <div class="card" id="admin-content" style="display: block;">
            <ul class="nav nav-tabs">
                <li class="nav-item">
                    <button class="nav-link active" data-bs-toggle="tab" data-bs-target="#dashboard-tab"><i class="bi bi-person-badge-fill"></i>    ADMIN DASHBOARD</button>
                </li>

                <li class="nav-item">
                    <button class="nav-link" data-bs-toggle="tab" data-bs-target="#projects-tab"><i class="bi bi-list-columns-reverse"></i>    PROJECTS PORTFOLIO PORTAL</button>
                </li>

                <li class="nav-item">
                    <button class="nav-link" data-bs-toggle="tab" data-bs-target="#contractor-details-tab"><i class="bi bi-list-columns-reverse"></i>    CONTRACTOR DETAILS</button>
                </li>

            </ul>
            <div class="tab-content mt-4">
                <div class="tab-pane fade show active" id="dashboard-tab">

                    <div class="tab-pane fade show active" id="dashboard-tab">
                        <div class="dashboard-summary">
                            <div class="summary-card">
                                <div class="icon"><i class="bi bi-people-fill fs-3" style="color: #1E2A56;"></i></div>
                                <div class="details">
                                    <h5 style="font-weight: bolder;">Projects</h5>
                                    <p>{{ num_projects }}</p>
                                </div>
                            </div>
                            <div class="summary-card">
                                <div class="icon"><i class="bi bi-hourglass-split fs-3" style="color: #1E2A56;"></i></div>
                                <div class="details">
                                    <h5 style="font-weight: bolder;">Ongoing Projects</h5>
                                    <p>{{ ongoing_projects }}</p>
                                </div>
                            </div>
                            <div class="summary-card">
                                <div class="icon"><i class="bi bi-calendar2-check-fill fs-3" style="color: #1E2A56;"></i></div>
                                <div class="details">
                                    <h5 style="font-weight: bolder;">Completed Projects</h5>
                                    <p>{{ completed_projects }}</p>
                                </div>
                            </div>
                            <div class="summary-card">
                                <div class="icon"><i class="bi bi-stopwatch-fill fs-3" style="color: #1E2A56;"></i></div>
                                <div class="details">
                                    <h5 style="font-weight: bolder;">Average Completion Time</h5>
                                    <p>{{ avg_completion_time }} days</p>
                                </div>
                            </div>

                            <div class="summary-card">
                                <div class="icon"><i class="bi bi-1-circle-fill fs-3" style="color: #1E2A56;"></i></div>
                                <div class="details">
                                    <h5 style="font-weight: bolder;">Top Location</h5>
                                    <p>{{ top_location }}</p>
                                </div>
                            </div>

                        </div>
                        <br>
                        <div class="dashboard-graphs">

                            <div class="graph-card">
                                <h6>Completed vs Ongoing</h6>
                                <canvas id="leaveByTypeChart" width="800" height="800"></canvas>
                            </div>

                            <div class="graph-card">
                                <h6>Projects By Location</h6>
                                <canvas id="projectsByLocationChart" width="800" height="800"></canvas>
                            </div>

                            <div class="graph-card">
                                <h6>Overdue Payments</h6>
                                <canvas id="employeesRemainingChart" width="800" height="800"></canvas>
                            </div>

                        </div>
                    </div>

                </div>
                <div class="tab-pane fade" id="projects-tab">
                    <button class="btn btn-primary mt-3" style="width: max-content;" data-bs-toggle="modal" data-bs-target="#ExportProjectsPortfolioModal"><i class="bi bi-journal-text"></i>    Export Projects Portfolio</button>
                    <div class="container mt-5">
                        <div class="container2" style="overflow-y: auto;">
                            {{ table_datamain_html |safe }}
                        </div>
                    </div>
                </div>
                <div class="tab-pane fade" id="contractor-details-tab">
                    <div class="container mt-5" style="color: #1E2A56;">

                        <div class="card shadow-sm border-0 rounded-4">
                            <div class="card-body p-4">

                                <h4 class="mb-4 fw-bold">CONTRACTOR DETAILS</h4>

                                <div class="row mb-3">
                                    <div class="col-md-4">
                                        <p class="text-muted mb-1">COMPANY</p>
                                        <p class="fw-semibold">{{ companyname }}</p>
                                    </div>
                                    <div class="col-md-4">
                                        <p class="text-muted mb-1">PHONES</p>
                                        <p class="fw-semibold">{{ contact1 }}</p>
                                        <p class="fw-semibold">{{ contact2 }}</p>
                                    </div>
                                    <div class="col-md-4">
                                        <p class="text-muted mb-1">EMAIL</p>
                                        <p class="fw-semibold">{{ compemail }}</p>
                                    </div>
                                </div>
 
                                <div class="row mb-4">

                                    <div class="col-md-4">
                                        <p class="text-muted mb-1">ADDRESS</p>
                                        <p class="fw-semibold">{{ address }}</p>
                                    </div>
                                    <div class="col-md-4">
                                        <p class="text-muted mb-1">TIN NUMBER</p>
                                        <p class="fw-semibold">{{ tinnumber }}</p>
                                    </div>
                                </div>

                                <button class="btn btn-primary px-4 py-2" data-bs-toggle="modal" data-bs-target="#editContractorModal">
                                    Edit Details
                                </button>

                            </div>
                        </div>

                    </div>
                </div>

                <div class="tab-pane fade" id="settings">
                    <h4>Payments</h4>
                    <p>Manage Payments</p>
                </div>
            </div>
        </div>
    </main>

    <div class="modal fade" id="editContractorModal" tabindex="-1" aria-labelledby="editContractorModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content rounded-4 border-0 shadow">

            <div class="modal-header">
                <h5 class="modal-title fw-bold" id="editContractorModalLabel">CONTRACTOR DETAILS EDITOR</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>

            <div class="modal-body">

                <form id="contractorEditForm">

                <div class="row mb-3">
                    <div class="col-md-6">
                        <label class="form-label fw-semibold">Company Name</label>
                        <input type="text" class="form-control" value="{{ companyname }}">
                    </div>
                </div>

                <div class="row mb-3">
                    <div class="col-md-6">
                        <label class="form-label fw-semibold">Phone 1</label>
                        <input type="text" class="form-control" value="{{contact1}}">
                    </div>

                    <div class="col-md-6">
                    <label class="form-label fw-semibold">Phone 2</label>
                    <input type="text" class="form-control" value="{{contact2}}">
                    </div>

                    <div class="col-md-6">
                    <label class="form-label fw-semibold">Email</label>
                    <input type="email" class="form-control" value="{{ compemail }}">
                    </div>

                    <div class="col-md-6">
                    <label class="form-label fw-semibold">Tin Number</label>
                    <input type="text" class="form-control" value="{{ tinnumber }}">
                    </div>

                </div>

                <div class="row mb-3">
                    <div class="col-md-6">
                    <label class="form-label fw-semibold">Address</label>
                    <input type="text" class="form-control" value="{{ address }}">
                    </div>

                </div>

                </form>

            </div>

            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary">Save Changes</button>
            </div>

            </div>
        </div>
    </div>


    <div class="modal fade" id="exportleaveapplicationsreportModal" tabindex="-1" aria-labelledby="exportleaveapplicationsreportModalLabel" >
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exportleaveapplicationsreportModalLabel"><i class="bi bi-files-alt"></i>    EXPORT PAYMENTS REPORT</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p style="font-weight: 500;">Select file format to Export Leave Applications Report for <b>{{company_name}}</b> :</p>
                    <div class="d-flex justify-content-around">
                        <button class="btn btn-primary2 mt-3"  data-bs-dismiss="modal" id="formatexcelapplicationsexport"><i class="bi bi-filetype-xlsx"></i>    Excel Workbook</button>
                        <button class="btn btn-primary2 mt-3"  data-bs-dismiss="modal" id="formatpdfapplicationsexport"><i class="bi bi-filetype-pdf"></i>    PDF</button>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Cancel</button>
                </div>
            </div>
        </div>
    </div>


    


    <div class="modal fade" id="SubmitLeaveApplicationModal" tabindex="-1" role="dialog" aria-labelledby="SubmitLeaveApplicationModalLabel">
        <div class="modal-dialog" role="document"  style="max-width: 40%;">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="SubmitLeaveApplicationModalLabel"><i class="bi bi-file-earmark-medical-fill"></i>    LEAVE APPLICATION SUBMISSION CONFIRMATION</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div id="confirmationSubmitLeaveApplication" style="text-align: center;color: #1E2A56;font-weight: 500;"></div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" data-bs-dismiss="modal" id="confirmSubmit">Yes</button>
                    <button type="button" class="btn btn-primary" data-bs-dismiss="modal">No</button>
                </div>
            </div>
        </div>
    </div>


    <div class="modal fade" id="ExportProjectsPortfolioModal" tabindex="-1" aria-labelledby="ExportProjectsPortfolioModalLabel" >
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="ExportProjectsPortfolioModalLabel"><i class="bi bi-journal-text"></i>    EXPORT PROJECTS PORTFOLIO</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p style="font-weight: 500;">Select file format to export Projects Portfolio for <b>{{company_name}}</b> :</p>
                    <div class="d-flex justify-content-around">
                        <button class="btn btn-primary2 mt-3"  data-bs-dismiss="modal" id="formatexcellmsbookexport"><i class="bi bi-filetype-xlsx"></i>    Excel Workbook</button>
                        <button class="btn btn-primary2 mt-3"  data-bs-dismiss="modal" id="formatpdflmsbookexport"><i class="bi bi-filetype-pdf"></i>    PDF</button>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Cancel</button>
                </div>
            </div>
        </div>
    </div>


  <!-- Bootstrap and jQuery Scripts -->


<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>


<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.min.js"></script>
<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/choices.js/public/assets/scripts/choices.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels"></script>
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
<script>
// Function to load data into update modal
function loadUpdateData(projectId) {
    // Set the project ID in hidden field
    document.getElementById('updateProjectId').value = projectId;
    
    // Show loading state
    const modalBody = document.querySelector('#updateModal .modal-body');
    modalBody.innerHTML = '<div class="text-center py-5"><div class="spinner-border text-primary" role="status"><span class="visually-hidden">Loading...</span></div><p class="mt-2">Loading project data...</p></div>';
    
    // Fetch project data from server
    fetch(`/get_project_data/${projectId}`)
        .then(response => {
            if (!response.ok) {
                throw new Error('Network response was not ok');
            }
            return response.json();
        })
        .then(data => {
            // Populate form fields with data
            populateUpdateForm(data);
        })
        .catch(error => {
            console.error('Error loading project data:', error);
            modalBody.innerHTML = '<div class="alert alert-danger">Failed to load project data. Please try again.</div>';
        });
}

// Function to populate form with data
function populateUpdateForm(data) {
    // Basic information
    document.getElementById('updateClientName').value = data.clientname || '';
    document.getElementById('updateProjectName').value = data.projectname || '';
    document.getElementById('updateAdminName').value = data.projectadministratorname || '';
    
    // Completion status
    const statusSelect = document.getElementById('updateCompletionStatus');
    if (data.completion_status) {
        statusSelect.value = data.completion_status;
    }
    
    // Installment 1 details
    document.getElementById('updateInstallment1Amount').value = data.installment1amount || '';
    document.getElementById('updateInstallment1DueDate').value = formatDateForDisplay(data.installment1duedate) || '';
    document.getElementById('updateInstallment1PaidDate').value = formatDateForInput(data.installment1_paid_date) || '';
    
    // Additional fields
    document.getElementById('updateProjectLocation').value = data.project_location || '';
    document.getElementById('updateTotalContractPrice').value = data.total_contract_price || '';
    document.getElementById('updateProjectDescription').value = data.project_description || '';
}

// Helper function to format date for display
function formatDateForDisplay(dateString) {
    if (!dateString) return '';
    const date = new Date(dateString);
    return date.toLocaleDateString('en-GB', {
        day: 'numeric',
        month: 'long',
        year: 'numeric'
    });
}

// Helper function to format date for date input
function formatDateForInput(dateString) {
    if (!dateString) return '';
    const date = new Date(dateString);
    return date.toISOString().split('T')[0];
}

// Save changes handler
document.getElementById('saveUpdateChanges').addEventListener('click', function() {
    const projectId = document.getElementById('updateProjectId').value;
    const formData = new FormData(document.getElementById('updateProjectForm'));
    
    // Convert FormData to JSON
    const data = {};
    formData.forEach((value, key) => {
        data[key] = value;
    });
    
    // Add project ID
    data.project_id = projectId;
    
    // Show loading on save button
    const saveButton = this;
    const originalText = saveButton.innerHTML;
    saveButton.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span>Saving...';
    saveButton.disabled = true;
    
    // Send update request
    fetch('/update_project', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify(data)
    })
    .then(response => response.json())
    .then(result => {
        if (result.success) {
            // Show success message
            showToast('Success', 'Project updated successfully!', 'success');
            
            // Close modal after short delay
            setTimeout(() => {
                const modal = bootstrap.Modal.getInstance(document.getElementById('updateModal'));
                modal.hide();
                
                // Refresh page or update table data
                location.reload(); // Or update specific row
            }, 1500);
        } else {
            throw new Error(result.message || 'Update failed');
        }
    })
    .catch(error => {
        console.error('Error updating project:', error);
        showToast('Error', 'Failed to update project. Please try again.', 'error');
    })
    .finally(() => {
        // Reset button
        saveButton.innerHTML = originalText;
        saveButton.disabled = false;
    });
});

// Toast notification function (if not already defined)
function showToast(title, message, type = 'info') {
    // Create or use existing toast container
    let toastContainer = document.getElementById('toast-container');
    if (!toastContainer) {
        toastContainer = document.createElement('div');
        toastContainer.id = 'toast-container';
        toastContainer.className = 'toast-container position-fixed top-0 end-0 p-3';
        document.body.appendChild(toastContainer);
    }
    
    const toastId = 'toast-' + Date.now();
    const bgClass = type === 'success' ? 'bg-success' : 
                    type === 'error' ? 'bg-danger' : 
                    type === 'warning' ? 'bg-warning' : 'bg-info';
    
    const toastHtml = `
        <div id="${toastId}" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="toast-header ${bgClass} text-white">
                <strong class="me-auto">${title}</strong>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
            <div class="toast-body">
                ${message}
            </div>
        </div>
    `;
    
    toastContainer.insertAdjacentHTML('beforeend', toastHtml);
    
    const toastElement = document.getElementById(toastId);
    const toast = new bootstrap.Toast(toastElement, {
        autohide: true,
        delay: 5000
    });
    toast.show();
    
    // Remove toast from DOM after it's hidden
    toastElement.addEventListener('hidden.bs.toast', function () {
        this.remove();
    });
}

// Initialize modal event listeners
document.addEventListener('DOMContentLoaded', function() {
    // Clear form when modal is hidden
    const updateModal = document.getElementById('updateModal');
    updateModal.addEventListener('hidden.bs.modal', function () {
        document.getElementById('updateProjectForm').reset();
    });
});
</script>
<script>
// Track ongoing downloads
const ongoingDownloads = new Set();

function handleDownloadClick(button) {
    const originalText = button.textContent;
    const downloadId = button.dataset.id || Date.now(); // Unique identifier
    
    // Skip if already downloading
    if (ongoingDownloads.has(downloadId)) {
        return true;
    }
    
    // Mark as downloading
    ongoingDownloads.add(downloadId);
    
    // Change button state
    button.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span>Downloading...';
    button.disabled = true;
    
    // Create a hidden iframe to track download
    const iframe = document.createElement('iframe');
    iframe.style.display = 'none';
    iframe.name = 'downloadFrame_' + downloadId;
    document.body.appendChild(iframe);
    
    // Change the link target to the iframe
    const originalTarget = button.target;
    button.target = iframe.name;
    
    // Listen for iframe load event (download complete)
    iframe.onload = function() {
        // Reset button
        button.innerHTML = 'Download Contract';
        button.disabled = false;
        button.target = originalTarget;
        
        // Cleanup
        document.body.removeChild(iframe);
        ongoingDownloads.delete(downloadId);
        
        // Optional: Show success message for 1 second
        button.innerHTML = '<i class="fas fa-check me-2"></i>Downloaded!';
        button.classList.add('btn-success');
        
        setTimeout(() => {
            button.innerHTML = 'Download Contract';
            button.classList.remove('btn-success');
        }, 1000);
    };
    
    // Set timeout as fallback (in case iframe doesn't trigger)
    const fallbackTimeout = setTimeout(() => {
        if (ongoingDownloads.has(downloadId)) {
            button.innerHTML = 'Download Contract';
            button.disabled = false;
            button.target = originalTarget;
            
            if (document.body.contains(iframe)) {
                document.body.removeChild(iframe);
            }
            ongoingDownloads.delete(downloadId);
        }
    }, 10000); // 10 second timeout
    
    return true;
}
</script>
<script>
document.getElementById("saveAdminBtn").addEventListener("click", function () {

    const name = document.getElementById("adminName").value.trim();
    const phone = document.getElementById("adminPhone").value.trim();

    if (!name || !phone) {
        alert("Please fill in all fields");
        return;
    }

    // Show loader + disable button
    document.getElementById("saveText").classList.add("d-none");
    document.getElementById("saveLoader").classList.remove("d-none");
    document.getElementById("saveAdminBtn").disabled = true;

    fetch("/addadmin", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
            adminName: name,
            adminPhone: phone
        })
    })
    .then(response => response.json())
    .then(data => {

        // Hide loader, restore button
        document.getElementById("saveText").classList.remove("d-none");
        document.getElementById("saveLoader").classList.add("d-none");
        document.getElementById("saveAdminBtn").disabled = false;

        if (data.status === "success") {

            alert("Administrator added!");

            const modal = bootstrap.Modal.getInstance(document.getElementById("addAdminplusModal"));
            modal.hide();

            location.reload();

        } else {
            alert("Error: " + data.message);
        }

    })
    .catch(error => {

        // Hide loader, restore button if an error occurs
        document.getElementById("saveText").classList.remove("d-none");
        document.getElementById("saveLoader").classList.add("d-none");
        document.getElementById("saveAdminBtn").disabled = false;

        alert("Request failed: " + error);
    });
});
</script>


<script>
document.getElementById("saveProjectBtn").addEventListener("click", function () {

    // ----------------------------------------------------
    // 1. Perform your custom checks before submitting
    // ----------------------------------------------------

    const clientName = document.getElementById("client_name").value.trim();
    const projectName = document.getElementById("project_name").value.trim();
    const paymentMethod = document.getElementById("paymentMethod").value;

    if (clientName === "" || projectName === "") {
        alert("Client Name and Project Name are required.");
        return; // STOP submission
    }

    if (paymentMethod === "") {
        alert("Select a payment method.");
        return; // STOP submission
    }

    // Example additional logic:
    if (paymentMethod === "Installments") {
        let months = document.getElementById("monthstopay").value;
        if (months === "" || months <= 0) {
            alert("Months To Pay must be greater than 0.");
            return;
        }
    }

    // ----------------------------------------------------
    // 2. Build FormData object and send to Flask route
    // ----------------------------------------------------
    let form = document.getElementById("addProjectForm");
    let formData = new FormData(form);

    fetch("/contract_log", {
        method: "POST",
        body: formData
    })
    .then(async response => {

        // If server returned JSON error 
        if (!response.ok) {
            let errorText = await response.text();
            console.error("Server error:", errorText);
            alert(" Failed to save: " + errorText);
            throw new Error("Server returned an error");
        }

        // If Flask redirected normally = success
        if (response.redirected) {
            window.location.href = response.url;
            return;
        }

        return response.text();
    })
    .then(data => {
        console.log("Server response:", data);
        alert(" Project saved successfully!");
    })
    .catch(error => {
        console.error("Error:", error);
        alert(" There was an error saving the project.");
    });


});
</script>
<script>
document.addEventListener("DOMContentLoaded", function () {
    document.querySelector('#allprojectsTable').addEventListener('click', function(e) {
        if (e.target && e.target.classList.contains('view-project-btn')) {

            const projectId = e.target.getAttribute('data-id');

            // Fetch project details from backend
            fetch(`/get_project/${projectId}`)
            .then(response => response.json())
            .then(data => {

                // Define the exact order you want
                const fieldOrder = [
                    "id",
                    "datecaptured",
                    "capturer",
                    "capturerid",
                    "clientname",
                    "clientidnumber",
                    "clientaddress",
                    "clientwanumber",
                    "clientemail",
                    "clientnextofkinname",
                    "clientnextofkinaddress",
                    "clientnextofkinphone",
                    "nextofkinrelationship",
                    "projectname",
                    "projectlocation",
                    "projectdescription",
                    "projectadministratorname",
                    "projectstartdate",
                    "projectduration",
                    "contractagreementdate",
                    "totalcontractamount",
                    "latepaymentinterest",
                    "paymentmethod",
                    "monthstopay",
                    "depositorbullet",
                    "datedepositorbullet",
                    "monthlyinstallment",
                    "installment1amount",
                    "installment1duedate",
                    "installment1date",
                    "installment2amount",
                    "installment2duedate",
                    "installment2date",
                    "installment3amount",
                    "installment3duedate",
                    "installment3date",
                    "installment4amount",
                    "installment4duedate",
                    "installment4date",
                    "installment5amount",
                    "installment5duedate",
                    "installment5date",
                    "installment6amount",
                    "installment6duedate",
                    "installment6date",
                    "projectcompletionstatus"
                ];

                // Get the table body
                const tbody = document.getElementById('projectDetailsBody');
                tbody.innerHTML = ''; // Clear old data

                // Build rows in the exact order defined above
                fieldOrder.forEach(key => {
                    if (data[key] !== undefined) {

                        const row = document.createElement('tr');

                        row.innerHTML = `
                            <th style="width: 30%; text-transform: capitalize;">
                                ${key.replace(/_/g, ' ')}
                            </th>
                            <td>${data[key] === null ? "" : data[key]}</td>
                        `;

                        tbody.appendChild(row);
                    }
                });

            })
            .catch(err => {
                alert('Failed to fetch project details: ' + err);
            });

        }
    });


        // Delegate click events for dynamically generated buttons
    document.querySelector('#alladminsTable').addEventListener('click', function(e) {
        if (e.target && e.target.classList.contains('remove-admin-btn')) {
            const adminId = e.target.getAttribute('data-ID');

            if (!confirm("Are you sure you want to remove this administrator?")) {
                return;
            }

            fetch('/removeadmin', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ id: adminId })
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    alert('Administrator removed!');
                    // Optionally remove the row from table
                    e.target.closest('tr').remove();
                    location.reload();

                } else {
                    alert('Error: ' + data.message);
                }
            })
            .catch(error => {
                alert('Request failed: ' + error);
            });
        }
    });








    const table = document.getElementById("allprojectsTable");
    if (!table) return;

    const columnsToShow = [
        "id",
        "clientname",
        "projectname",
        "projectadministratorname",
        "projectcompletionstatus",
        "action"
    ];

    const headerCells = table.querySelectorAll("thead th");
    let colIndexMap = {};

    // Map column names  column index
    headerCells.forEach((th, index) => {
        const key = th.innerText.trim().toLowerCase().replace(/\s+/g, "");
        colIndexMap[key] = index;
    });

    // Loop through all columns and hide those NOT in columnsToShow
    headerCells.forEach((th, index) => {
        const field = th.innerText.trim().toLowerCase().replace(/\s+/g, "");
        if (!columnsToShow.includes(field)) {
            hideColumn(table, index);
        }
    });

    function hideColumn(table, columnIndex) {
        const rows = table.querySelectorAll("tr");
        rows.forEach(row => {
            const cells = row.children;
            if (cells[columnIndex]) {
                cells[columnIndex].style.display = "none";
            }
        });
    }

});
</script>

<script>
    const paymentMethod = document.getElementById('paymentMethod');
    const paymentSchedule = document.getElementById('paymentschedule');
    const bulletpaymentdate = document.getElementById('bullet_payment_date');
    const depositRequired = document.getElementById('deposit_required');
    const totalContractPrice = document.getElementById('total_contract_price');

    paymentMethod.addEventListener('change', function() {
        if (this.value === 'Installments') {
            paymentSchedule.style.display = 'block';
            bulletpaymentdate.style.display = 'none';

            const total = parseFloat(totalContractPrice.value);
            if (!isNaN(total)) {
                depositRequired.value = (total * 0.3).toFixed(2);
            } else {
                depositRequired.value = '';
            }

        } else {
            paymentSchedule.style.display = 'none';
            bulletpaymentdate.style.display = 'block';
        }
    });


</script>

<script>

$(document).ready(function () {

    $('#saveaccumulators').click(function () {
        let updates = [];
        const companyname = $('#company_name').val().trim();  // Get the company name from the hidden input

        // Check if company name is empty
        if (!companyname) {
            alert("Company name is required.");
            return;  // Prevent further execution if company name is missing
        }

        // Gather data from the table
        $('#employeesaccumulatorsTable .editable-field').each(function () {
            let $field = $(this);
            let id = $field.data('id'); // Employee ID
            let newValue = parseFloat($field.val()); // New value entered

            // Check if the ID and value are valid before adding to updates
            if (id && !isNaN(newValue)) {
                updates.push({ id: id, accumulated_days: newValue });
            } else {
                console.error("Invalid data-id or value for field:", $field);
            }
        });

        // Check if updates array is empty (no valid data to send)
        if (updates.length === 0) {
            alert("No valid data to update.");
            return;  // Prevent sending the request if no valid data
        }
        $('#edsLoader').show();  // Show loading overlay immediately

        // Send updates to the server
        $.ajax({
            url: '/update_accumulators',
            type: 'POST',
            contentType: 'application/json',
            data: JSON.stringify({ updates: updates, companyname: companyname }),
            success: function (response) {

                $('#editLeaveDaysAccumulatorModal').modal('hide');  // Hide the modal after success
                $('#edsLoader').hide();  // Show loading overlay immediately
                setTimeout(function() {
                    alert(response.message);  // Show alert after the overlay
                }, 100);  // 100ms delay to ensure UI update before alert
                location.reload();  // Reload the table to reflect changes
            },
            error: function () {
                alert('Error updating Accumulators.');
            }
        });
    });
});



$('#btn-dashboard').click(function() {
        $('#dashboard-tab').tab('show');
    });

$('#btn-leave-apps-portal').click(function() {
    $('#projects-tab').tab('show');
});

$('#closepriv').on('click', function() {
    $('#editModalpriv').modal('hide'); 
});

$('#closeapprover').on('click', function() {
    $('#editModalapprover').modal('hide'); 
});

$('#closeaccumulators').on('click', function() {
    $('#editLeaveDaysAccumulatorModal').modal('hide'); 
});

$('#cancel_add_emplyee_manual').on('click', function() {
    $('#manualaddemployeeModal').modal('hide'); 
});



$('#savedepartmentconfirm').on('click', function() {
    var newdepartment = $('#department-emp').val();  // Get the selected role
    var companyname = $('#company_name').val();  // Get the company name from the hidden input

    if (!newdepartment || !companyname) {
        alert("Please fill in all required fields.");
        return;  // Prevent further execution if fields are empty
    }

    $('#edsLoader').show();

    
    if (newdepartment) {
        // Send the data to the Flask endpoint
        $.ajax({
            url: '/update_department',  // Change to your desired endpoint
            method: 'POST',
            data: {
                department: newdepartment,
                currentId: currentIdeditdepartment,  // Include the currentId in the request
                companyname: companyname  // Include the company_name in the request
            },
            success: function(response) {
                // Handle the response from Flask (e.g., show success message or refresh data)
                $('#editModaldepartment').modal('hide');  // Hide the modal after success
                $('#edsLoader').hide();

                setTimeout(function() {
                    alert('Department updated successfully.');
                }, 100);  // 100ms delay to ensure UI update before alert
                location.reload();  
            },
            error: function(xhr, status, error) {
                // Handle any errors (e.g., alert user)
                alert('Error: ' + error);
            }
        });
    } else {
        // If no role is selected
        alert("Please select a department before saving.");
    }
});


async function downloadLeaveApp(appId) {
    const btn = document.querySelector(`button[data-id="${appId}"]`);
    const originalText = btn.innerHTML;
    // Find the <tr> where the button is located
    const row = btn.closest('tr');

    // Find the full name from the "Employee Name" column
    // You can improve this by assigning a class to that <td> (e.g., <td class="employee-name">)
    const nameCell = Array.from(row.cells).find(cell =>
        cell.textContent.trim() && !cell.querySelector('button') && isNaN(cell.textContent.trim())
    );

    const fullName = nameCell ? nameCell.textContent.trim() : 'Unknown_Name';
    
    try {
        // 1. Show loading state
        btn.disabled = true;
        btn.innerHTML = '<i class="fa fa-spinner fa-spin"></i> Generating...';

        // 2. Fetch PDF
        const response = await fetch(`/download_leave_app/${appId}`);
        
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }

        // 3. Check content type (ensure it's PDF)
        const contentType = response.headers.get('content-type');
        if (!contentType || !contentType.includes('application/pdf')) {
            throw new Error('Invalid content type - expected PDF');
        }

        // 4. Create download
        const blob = await response.blob();
        const url = window.URL.createObjectURL(blob);
        
        const a = document.createElement('a');
        a.style.display = 'none';
        a.href = url;
        a.download = `leave_application_${fullName}_${appId}.pdf`;
        document.body.appendChild(a);
        a.click();

        // 5. Cleanup
        window.URL.revokeObjectURL(url);
        document.body.removeChild(a);

    } catch (error) {
        console.error('Download failed:', error);
        btn.innerHTML = '<i class="fa fa-exclamation-circle"></i> Failed - Retry';
        // Optional: Show user-friendly alert
        alert(`Download failed: ${error.message}`);
    } finally {
        // 6. Reset button (even if success or error)
        btn.disabled = false;
        btn.innerHTML = originalText;
    }
}





document.addEventListener('DOMContentLoaded', () => {
    const modals = document.querySelectorAll('.modal');
    const mainContent = document.querySelector('body > *:not(.modal)'); // Select all content outside modals

    modals.forEach(modal => {
        modal.addEventListener('show.bs.modal', () => {
            // Add inert to main content when modal is open
            mainContent.setAttribute('inert', '');
        });

        modal.addEventListener('hidden.bs.modal', () => {
            // Remove inert from main content when modal is closed
            mainContent.removeAttribute('inert');
        });
    });



    document.getElementById('formatexcellmsbookexport').addEventListener('click', () => {
            window.location.href = '/export_lms_book_excel';
        });

    document.getElementById('formatpdflmsbookexport').addEventListener('click', () => {
        window.location.href = '/export_lms_book_pdf';
    });

  });




  </script>
<script>
    $(document).ready(function () {
        // Initialize DataTable for the main employees table
        $('#allprojectsTable').DataTable({
            paging: false,    // Enable pagination
            searching: true, // Enable search
            ordering: true,  // Enable sorting
            info: true,      // Show table information
            pageLength: 8,       // Force max 5 entries per page
            lengthChange: false, // Disable entries per page dropdown
        });


    });
</script>



</body>
</html>
