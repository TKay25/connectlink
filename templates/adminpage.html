<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>ConnectLink Admin System</title>
        <meta name="mobile-web-app-capable" content="yes">
        <!-- <link rel="icon" type="image/png" href="{{ url_for('static', filename='images/eds blue.png') }}"> -->
        <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
        <link href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css" rel="stylesheet">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
        <link href="https://cdn.jsdelivr.net/npm/choices.js/public/assets/styles/choices.min.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
        <style>
        /* Main Styling */
        body {
            font-family: 'Roboto', sans-serif;
            background: linear-gradient(to right, #f0f2f5, #e9f1fb);
            margin: 0;
            min-height: 100vh;
            display: flex;
            overflow-x: hidden;
        }

        /* Sidebar Styling */
        .sidebar {
            width: 250px;
            background-color: #1E2A56;
            color: #fff;
            padding-top: 40px;
            position: fixed;
            height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            box-shadow: 4px 0 10px rgba(0, 0, 0, 0.2);
            transition: width 0.3s;
        }

        #editinfocompModal {
            z-index: 1061 !important;
        }

        .modal-backdrop.show:nth-of-type(2) {
            z-index: 1060 !important;
        }

        .sidebar:hover {
            width: 270px;
        }

        .sidebar h5 {
            font-weight: bold;
            margin-bottom: 30px;
            font-size: 1.2rem;
        }

        .sidebar img {
            max-width: 150px;
            margin-bottom: 20px;
        }

        .sidebar .btn {
            color: #1E2A56;
            background-color: #fff;
            width: 150px;
            margin: 5px 0;
            padding: 8x;
            border: 3px solid #1E2A56;
            border-radius: 8px;
            font-size: 0.9rem;
            transition: background 0.3s;
            text-align: center;
            font-weight: 600;
        }

        .sidebar .btn:hover {
            background-color: #1E2A56;
            color: #fff;
            border: 3px solid white;
            box-shadow: 0 5px 8px rgba(0, 0, 0, 0.15);
        }
        .btn-primary{
            color: white;
            background-color: #1E2A56;
            width: 15%;
            margin: 8px 0;
            padding: 5px;
            border-radius: 8px;
            border: 3px solid #1E2A56;
            font-size: 0.9rem;
            transition: background 0.3s;
            text-align: center;
            font-weight: 500;

        }
        .btn-primary:hover{
            background-color: white;
            color: #1E2A56;
            border: 3px solid #1E2A56;
            box-shadow: 0 5px 8px rgba(0, 0, 0, 0.15);
        }

        .btn-primary10{
            color: #1E2A56;
            background-color: white;
            width: 15%;
            margin: 8px 0;
            padding: 5px;
            border-radius: 8px;
            border: 3px solid #1E2A56;
            font-size: 0.9rem;
            transition: background 0.3s;
            text-align: center;
            font-weight: 600;

        }
        .btn-primary10:hover{
            background-color: #e9f1fb;
            color: #1E2A56;
            border: 3px solid #1E2A56;
            box-shadow: 0 5px 8px rgba(0, 0, 0, 0.15);
        }

        .btn-primary2{
            color: white;
            background-color: #1E2A56;
            width: 37%;
            margin: 8px 0;
            padding: 6px;
            border-radius: 8px;
            border: 3px solid #1E2A56;
            font-size: 0.9rem;
            transition: background 0.3s;
            text-align: center;
            font-weight: 500;

        }
        .btn-primary2:hover{
            background-color: white;
            color: #1E2A56;
            border: 3px solid #1E2A56;
            box-shadow: 0 5px 8px rgba(0, 0, 0, 0.15);
        }
        .btn-primary9{
            color: white;
            background-color: #1E2A56;
            margin: 8px 0;
            padding: 5px;
            border-radius: 8px;
            border: 3px solid #1E2A56;
            transition: background 0.3s;
            text-align: center;
            font-weight: 500;

        }
        .btn-primary9:hover{
            background-color: white;
            color: #1E2A56;
            border: 3px solid #1E2A56;
            box-shadow: 0 5px 8px rgba(0, 0, 0, 0.15);
        }

        .btn-primary3{
            color: white;
            background-color: #1E2A56;
            width: 100%;
            padding-left: 5px;
            padding-right: 5px;
            padding-top: 1px;
            padding-bottom: 1px;
            border-radius: 8px;
            border: 3px solid #1E2A56;
            font-size: 13px;
            transition: background 0.3s;
            text-align: center;
            font-weight: 500;

        }
        .form-control-blue {
            background-color: #1E2A5611; /* Example */
            border: 1px solid #ccc;
            appearance: auto; /* Ensure native dropdown appearance */
            padding: 8px 12px;
        }


        .btn-primary3:hover{
            background-color: white;
            color: #1E2A56;
            border: 3px solid #1E2A56;
        }

        /* Main Content Styling */
        .main-content {
            margin-left: 270px;
            padding: 30px;
            width: calc(100% - 270px);
            background-color: #ffffff;
            min-height: 100vh;
        }


        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 4px;
            background-color: #e9f1fb;
            border-radius: 15px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            margin-bottom: 10px;
        }

        .current-date {
            color: #1E2A56;
            font-weight: bold;
            font-size: smaller;
            font-size: 1rem;
        }

        .employeetag {
            color: #1E2A56;;
            font-size: 1.1rem;
            font-weight: 800;
            text-transform: uppercase;

        }

        /* Tab Styling */
        .nav-tabs .nav-link {
            color: #1E2A56;
            font-weight: 600;
            padding: 12px 25px;
            font-size: 16px;
            border-radius: 8px 8px 0 0;
            background: #e9f1fb;
            transition: background 0.3s ease, color 0.3s ease;
        }

        .nav-tabs .nav-link.active {
            color: #ffffff;
            background-color: #1E2A56;
            font-weight: 800;
        }

        /* Card Styling */
        .card {
            border-radius: 12px;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.1);
            padding: 20px;
            margin-top: 20px;
            background-color: #ffffff;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .modal-content {
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
            }
        .modal-header{
            background-color: #1E2A56;
            color: white;
            font-weight: bold;
        }
        .form-group {
            margin-bottom: 20px; /* Increase vertical spacing between fields */
            }

        .btn-center {
            display: flex;
            justify-content: center;
            justify-content: space-between; 
            gap: 10px;
            }

        .form-control-blue::after {
            content: '\25BC'; /* Unicode for downwards triangle */
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            color: white; /* Arrow color */
            font-size: 18px;
        }

        /* Style for disabled option (making it grey) */
        .form-control-blue option:disabled {
            background-color: #A9A9A9; /* Grey background */
            color: #D3D3D3; /* Grey text color */
        }

        .table-theme {
            width: 100%;
            border-collapse: collapse;
            table-layout: auto; /* Allow columns to adjust based on content */
        }

        .table-theme th {
            background-color: #1E2A56;
            color: white;
            text-align: center !important;
            vertical-align: middle !important;
            padding: 2px;
            font-weight: bold;
            white-space: nowrap; /* Prevent text wrapping */
        }

        #employeesTable th,
        #employeespayrollTable th, 
        #employeespersonalTable th,
        #employeesaccumulatorsTable th, 
        #employeesbulk1Table th, 
        #employeesbulkbalancesTable th, 
        #removeemployeesTable th {
            position: sticky;
            top: 0;
            z-index: 1;
        }


        .table-theme td {
            font-weight: 500;
            padding: 0px;
            color: #1E2A56;
            text-align: center;
            white-space: nowrap; /* Prevent text wrapping */
            border-bottom: 1px solid #ddd;
        }


        .container2 {
            font-size: 13px;
            margin-top: -2rem;
        }
        /* Custom scrollbar styling */
        .container2::-webkit-scrollbar {
            width: 12px; /* Width of the scrollbar */
        }

        .container2::-webkit-scrollbar-thumb {
            background-color: #1E2A56; /* Scrollbar thumb color */
            border-radius: 5px; /* Rounded corners for thumb */
        }

        .container2::-webkit-scrollbar-thumb:hover {
            background-color: #e9f1fb;
            box-shadow: inset 0 0 0 3px #1E2A56; /* Simulates a border */
        }

        .container2::-webkit-scrollbar-track {
            background-color: #f0f0f0; /* Scrollbar track color */
            border-radius: 5px; /* Rounded corners for track */
        }
        .form-group label{
            font-weight: bold;
        }
        /* For WebKit-based browsers (Chrome, Edge, Safari) */
        #employeeList::-webkit-scrollbar {
            width: 15px; /* Width of the scrollbar */
        }

        #employeeList::-webkit-scrollbar-thumb {
            background-color: #1E2A56; /* Blue color for the scrollbar handle */
            border-radius: 5px; /* Rounded scrollbar handle */
        }

        #employeeList::-webkit-scrollbar-track {
            background-color: #f1f1f1; /* Background color of the scrollbar track */
        }

        /* For Firefox */
        #employeeList {
            scrollbar-color: #1E2A56 #f1f1f1; /* Handle color followed by track color */
        }
        select.form-control-blue option:hover {
            background-color: #e6f0ff; /* Light blue on hover */
            color: #1E2A56; /* Dark blue text */
        }
        /* Style the close button */
        .modal-header .btn-close {
            background-color: white; /* Makes the background white */
            color: black; /* Change the icon color to black */
            opacity: 1; /* Ensure the button is fully opaque */
        }

        /* Optional: Hover effect */
        .modal-header .btn-close:hover {
            background-color: #f8f9fa; /* Light grey background on hover */
            color: #000; /* Ensure the icon stays black on hover */
            opacity: 1; /* Ensure full opacity on hover */
        }
        .modal-footer{
            gap: 10px;
        }

        /* Default background color for editable fields */
        .editable-field {
            border-radius: 8px;
            background-color: #e6f0ff; /* Light blue when not being edited */
            border: rgba(0, 0, 0, 0.2) solid #1E2A56; /* Light border */
            transition: background-color 0.3s ease;
        }

        /* Background color when the field is focused (being edited) */
        .editable-field:focus {
            background-color: #1E2A56; /* Change to light yellow when being edited */
            color: white; /* Dark blue border when focused */
            outline: none; /* Remove the default outline */
        }

        /* Style the checkboxes */
        .custom-checkbox {
            width: 25px; /* Make the checkbox bigger */
            height: 25px; /* Make the checkbox bigger */
            background-color: #e6f0ff; /* Dark blue background */
            border-radius: 8px; /* Optional: round the corners */
            border: 3px solid #1E2A56; /* Dark blue border */
            appearance: none; /* Remove default checkbox style */
            position: relative;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .custom-checkbox:checked {
            background-color: #1E2A56; /* Dark blue when checked */
            border-color: #1E2A56; /* Dark blue border when checked */
        }

        .custom-checkbox:checked::after {
            content: '\2713'; /* Checkmark symbol */
            position: absolute;
            top: 0;
            left: 4px; /* Adjust position of the checkmark */
            color: white; /* White color for the checkmark */
            font-size: 15px; /* Make the checkmark larger */
        }

        #removeemployeesTable input[type="checkbox"] {
            margin-right: 10px;
        }

        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8); /* Semi-transparent background */
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            color: white;
            font-size: 18px;
            z-index: 9999;
        }

        .loading-spinner {
            border: 8px solid #f3f3f3; /* Light grey background color */
            border-top: 8px solid #1E2A56; /* Blue spinner color */
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }


        .uppercase-text {
        text-transform: uppercase;
        }

        .form-select {
            padding: 5px 10px;
            font-size: 0.9rem;
            border-radius: 10px;
            border: 3px solid  #1E2A56;
            font-weight: 800;
            outline: none;
            color:#1E2A56;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);

        }
        /* Black overlay */
        .dropdown-overlay {
            position: fixed;  /* Covers the entire screen */
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7); /* Black with 70% opacity */
            z-index: 10; /* Ensure it appears above everything */
            display: none; /* Initially hidden */
        }

        .dropdown-overlayxx {
            position: fixed;  /* Covers the entire screen */
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7); /* Black with 70% opacity */
        }


        .dropdown-menu .dropdown-item {
        color: #1E2A56;
        font-weight: 500;
        }
        .dropdown-menu .dropdown-item:hover {
            background-color: #1E2A56; /* Dark blue background on hover */
            color: white; /* White text color on hover */
            transition: background-color 0.3s ease, color 0.3s ease; /* Smooth transition */
            cursor: pointer;
        }
        .otherleave{
            display: none;
        }



        .modal-body{
            color: #1E2A56;
        }
        #chartContainer {
            margin-top: 20px;
            width: 230px;  /* Reduce chart size */
        }
        .dropdownfilter {
            position: relative;
            display: inline-block;
        }
        .dropdownfilter-toggle {
            background-color: #1E2A56;
            color: white;
            padding: 2px 12px;
            border: none;
            cursor: pointer;
            border-radius: 5px;
            font-weight: 500;
        }
        .dropdownfilter-content {
            display: none;
            position: absolute;
            background-color: white;
            box-shadow: 0px 4px 8px rgba(0,0,0,0.2);
            z-index: 1;
            padding: 3px;
            border-radius: 5px;
        }
        .dropdownfilter-content label {
            display: block;
            margin-bottom: 5px;
            cursor: pointer;
            color: #1E2A56;
        }
        .dropdownfilter:hover .dropdownfilter-content {
            display: block;
        }

        .eds-loader {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            font-family: 'Century Gothic', sans-serif;  
        }
        
        .eds-logo {
            color: white;
            font-size: 1rem;
            font-weight: bold;
            margin-bottom: 20px;
            text-align: center;
            text-shadow: 0 0 10px #1E2A56;
        }
        
        .eds-tagline {
            color: #fff;
            font-size: 0.6rem;
            margin-bottom: 30px;
            opacity: 0.8;
        }
        
        .loader-bar {
            width: 300px;
            height: 4px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 2px;
            overflow: hidden;
            position: relative;
        }
        
        .loader-progress {
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, White, #1E2A56);
            animation: load 3s ease-in-out infinite;
            border-radius: 2px;
        }
        
        @keyframes load {
            0% { width: 0%; left: 0; }
            50% { width: 100%; left: 0; }
            100% { width: 0%; left: 100%; }
        }
        
        .eds-grid {
            display: grid;
            grid-template-columns: repeat(4, 20px);
            gap: 10px;
            margin-top: 30px;
        }
        
        .grid-item {
            width: 20px;
            height: 20px;
            background: rgba(0, 255, 252, 0.2);
            animation: pulse 1.5s ease-in-out infinite;
        }
        
        .grid-item:nth-child(1) { animation-delay: 0s; }
        .grid-item:nth-child(2) { animation-delay: 0.2s; }
        .grid-item:nth-child(3) { animation-delay: 0.4s; }
        .grid-item:nth-child(4) { animation-delay: 0.6s; }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 0.2; }
            50% { transform: scale(1.2); opacity: 1; background: #336699; }
        }



        .dashboard-summary {
            display: grid;
            grid-template-columns: repeat(5, 1fr); /* 4 columns */
            gap: 20px;
            margin-top: 20px;
        }

        .summary-card {
            flex: 1 1 calc(33.33% - 10px);
            background-color: #f0f4f8;
            padding: 4px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            font-size: 10px;
        }

        .summary-card .icon {
            font-size: 15px;
            margin-right: 10px;
        }

        .summary-card .details h5 {
            margin: 0;
            font-size: 13px;
            color: #1E2A56;
        }

        .summary-card .details p {
            margin: 0;
            font-size: 14px;
            font-weight: bold;
        }

        .dashboard-graphs {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .graph-card {
            background-color: #ffffff;
            padding: 10px;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            font-size: 12px;
        }

        .graph-card h6 {
            margin-bottom: 10px;
            font-size: 13px;
            font-weight: bold;
            color: #1E2A56;
        }

        .sidebar .accordion-button {
            background-color: #f8f9fa;
            border-radius: 0 !important;
            box-shadow: none;
            cursor: pointer;
        }

        .sidebar .accordion-button:hover {
            background-color: #e9ecef;
        }

        .sidebar .accordion-item {
            border-radius: 0 !important;
        }

        .sidebar .list-group-item {
            border-radius: 0 !important;
            border-left: none;
            border-right: none;
            font-size: 0.95rem;
        }

        /* Remove default Bootstrap accordion arrow for this item */
        .accordion-item:has(.bi-people-fill) .accordion-button::after, .accordion-item:has(.bi-wallet-fill) .accordion-button::after {
            display: none;
        }


    </style>
</head>

<body>
    <div class="eds-loader" id="edsLoader" style="display: none;">
        <div class="eds-logo"><img src="{{ url_for('static', filename='images/web-logo.png') }}"  alt="Logo" class="logo" style="width: 200px;"></div> 

        <br><br>
        <p style="font-weight: 700;color: white;font-size: 1.2rem;">We Are Commiting Your Changes {{user_name}}, Please Wait...</p>

        <div class="loader-bar">
            <div class="loader-progress"></div>
        </div>
        
        <div class="eds-grid">
            <div class="grid-item"></div>
            <div class="grid-item"></div>
            <div class="grid-item"></div>
            <div class="grid-item"></div>
        </div>
    </div>
    
    <div class="sidebar p-2">
        <br><br>
        <div class="eds-logo" style="background-color: white;border-radius: 20px;padding: 20px;"><img src="{{ url_for('static', filename='images/web-logo.png') }}"  alt="Logo" class="logo" style="width: 200px;"></div> 

        <br>
        <h6 class="mb-3 text-center">ADMINISTRATION SYSTEM</h6>

        <button class="btn w-100 d-flex justify-content-between align-items-center border rounded-2 mb-2 p-2"
                id="addnewprojectBtn" data-bs-toggle="modal" data-bs-target="#addnewProjectModal">
            <span><i class="bi bi-briefcase-fill me-2"></i> Add New Project</span>
        </button>

        <button class="btn w-100 d-flex justify-content-between align-items-center border rounded-2 mb-2 p-2"
                id="addnewprojectBtn">
            <span><i class="bi bi-briefcase-fill me-2"></i> Push Payment Reminders</span>
        </button>

        <button class="btn w-100 d-flex justify-content-between align-items-center border rounded-2 mb-2 p-2"
                id="addnewprojectBtn">
            <span><i class="bi bi-briefcase-fill me-2"></i> Create System User</span>
        </button>

        <button class="btn w-100 d-flex justify-content-between align-items-center border rounded-2 mb-2 p-2"
                id="addnewprojectBtn">
            <span><i class="bi bi-briefcase-fill me-2"></i> Manage Administrators</span>
        </button>




    </div>

    <div class="modal fade" id="addnewProjectModal" tabindex="-1" aria-labelledby="addnewProjectModalLabel" aria-hidden="true">
        <div class="modal-dialog" style="max-width: 80%;">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addnewProjectModalLabel"><i class="bi bi-briefcase-fill"></i> NEW PROJECT</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">

                    <form id="addProjectForm">

                        <!-- Row for side-by-side cards -->
                        <div class="row g-3">

                            <!-- CLIENT DETAILS CARD -->
                            <div class="col-md-4">
                                <div class="card" style="padding:15px;">

                                    <h6 style="background-color:#1E2A56; font-weight:800;color: white;text-align: center;padding: 1%;">CLIENT DETAILS</h6>

                                    <div class="form-group row align-items-center" style="margin-bottom: 0.5rem;">
                                        <label for="person_name" class="col-auto col-form-label" style="padding-right: 0.5rem;">Name:</label>
                                        <div class="col">
                                            <input type="text" class="form-control editable-field" id="client_name" name="client_name" required>
                                        </div>
                                    </div>

                                    <div class="form-group row align-items-center" style="margin-bottom: 0.5rem;">
                                        <label for="national_id" class="col-auto col-form-label" style="padding-right: 0.5rem;">National ID Number:</label>
                                        <div class="col">
                                            <input type="text" class="form-control editable-field" id="client_national_id" name="client_national_id" required>
                                        </div>
                                    </div>



                                    <div class="form-group row align-items-start" style="margin-bottom: 0.5rem;">
                                        <label for="address" class="col-auto col-form-label" style="padding-right: 0.5rem;">Address:</label>
                                        <div class="col">
                                            <textarea class="form-control editable-field" id="client_address" rows="3" name="client_address" required></textarea>
                                        </div>
                                    </div>


                                    <div class="form-group row align-items-center" style="margin-bottom: 0.5rem;">
                                        <label for="whatsapp_number" class="col-auto col-form-label" style="padding-right: 0.5rem;">Whatsapp Number:</label>
                                        <div class="col">
                                            <input type="text" class="form-control editable-field" id="client_whatsapp_number" name="client_whatsapp_number" required>
                                        </div>
                                    </div>

                                    <div class="form-group row align-items-center" style="margin-bottom: 0.5rem;">
                                        <label for="email_address" class="col-auto col-form-label" style="padding-right: 0.5rem;">Email:</label>
                                        <div class="col">
                                            <input type="email" class="form-control editable-field" id="client_email" name="client_email" required>
                                        </div>
                                    </div>


                                </div>
                            </div>

                            <!-- NEXT OF KIN DETAILS CARD -->
                            <div class="col-md-4">
                                <div class="card" style="padding:15px;">

                                    <h6 style="background-color:#1E2A56; font-weight:800;color: white;text-align: center;padding: 1%;">NEXT OF KIN DETAILS</h6>

                                    <div class="form-group row align-items-center" style="margin-bottom: 0.5rem;">
                                        <label for="person_name" class="col-auto col-form-label" style="padding-right: 0.5rem;">Name:</label>
                                        <div class="col">
                                            <input type="text" class="form-control editable-field" id="next_of_kin_name" name="next_of_kin_name" required>
                                        </div>
                                    </div>

                                    <div class="form-group row align-items-center" style="margin-bottom: 0.5rem;">
                                        <label for="person_address" class="col-auto col-form-label" style="padding-right: 0.5rem;">Address:</label>
                                        <div class="col">
                                            <input type="text" class="form-control editable-field" id="next_of_kin_address" name="next_of_kin_address" required>
                                        </div>
                                    </div>

                                    <div class="form-group row align-items-center" style="margin-bottom: 0.5rem;">
                                        <label for="contact_number" class="col-auto col-form-label" style="padding-right: 0.5rem;">Contact Number:</label>
                                        <div class="col">
                                            <input type="text" class="form-control editable-field" id="next_of_kin_contact_number" name="next_of_kin_contact_number" required>
                                        </div>
                                    </div>

                                    <div class="form-group row align-items-center" style="margin-bottom: 0.5rem;">
                                        <label for="relationship" class="col-auto col-form-label" style="padding-right: 0.5rem;">Relationship:</label>
                                        <div class="col">
                                            <input type="text" class="form-control editable-field" id="relationship" name="relationship" required>
                                        </div>
                                    </div>


                                </div>

                            </div>



                            <div class="col-md-4">
                                <div class="card" style="padding:15px;">
                                    <!-- CONTRACTOR DETAILS -->
                                    <h6 style="background-color:#1E2A56; font-weight:800;color: white;text-align: center;padding: 1%;">CONTRACTOR DETAILS</h6>

                                    <div class="form-group row align-items-center" style="margin-bottom: 0.5rem;">
                                        <label for="contractor_name" class="col-auto col-form-label" style="padding-right: 0.5rem;">Name:</label>
                                        <div class="col">
                                            <input type="text" class="form-control editable-field" id="contractor_name" value="ConnectLink Properties" readonly>
                                        </div>
                                    </div>


                                    <div class="form-group">
                                        <label>Address:</label>
                                        <input type="text" class="form-control editable-field" value="38A Coronation Avenue Greendale Harare" readonly>
                                    </div>

                                    <div class="form-group">
                                        <label>Contact Number</label>
                                        <input type="text" class="form-control editable-field" value="+263 773 368 558 ; +263 716 788 838" readonly>
                                    </div>

                                    <div class="form-group row align-items-center" style="margin-bottom: 0.5rem;">
                                        <label for="contractor_email" class="col-auto col-form-label" style="padding-right: 0.5rem;">Email:</label>
                                        <div class="col">
                                            <input type="email" class="form-control editable-field" id="contractor_email" value="info@connectlinkproperties.co.zw" readonly>
                                        </div>
                                    </div>

                                    <div class="form-group">
                                        <label>Administrator:</label>
                                        <select class="form-control-blue editable-field" id="projectadministrator" name="projectadministrator" required>
                                            <option value="" disabled selected>Select Administrator</option>
                                            <option value="AAA">AAA</option>
                                            <option value="BBB">BBB</option>
                                        </select>
                                    </div>

                                </div>
                            </div>

                            <div class="col-md-6">
                                <div class="card" style="padding:15px;">
                                    <!-- PROJECT DETAILS -->
                                    <h6 style="background-color:#1E2A56; font-weight:800;color: white;text-align: center;padding: 1%;">PROJECT DETAILS</h6>

                                    <div class="form-group row align-items-center" style="margin-bottom: 0.5rem;">
                                        <label for="project_name" class="col-auto col-form-label" style="padding-right: 0.5rem;">Project Name:</label>
                                        <div class="col">
                                            <input type="text" class="form-control editable-field" id="project_name" name="project_name" required>
                                        </div>
                                    </div>

                                    <div class="form-group row align-items-center" style="margin-bottom: 0.5rem;">
                                        <label for="project_location" class="col-auto col-form-label" style="padding-right: 0.5rem;">Project Location:</label>
                                        <div class="col">
                                            <input type="text" class="form-control editable-field" id="project_location" name="project_location" required>
                                        </div>
                                    </div>


                                    <div class="form-group">
                                        <label>Project Scope:</label>
                                        <textarea class="form-control editable-field" rows="3" id="project_description" name="project_description" required></textarea>
                                    </div>

                                    <div class="form-group row align-items-center" style="margin-bottom: 0.5rem;">
                                        <label for="project_start_date" class="col-auto col-form-label" style="padding-right: 0.5rem;">Project Start Date:</label>
                                        <div class="col">
                                            <input type="date" class="form-control editable-field" id="project_start_date" name="project_start_date" required>
                                        </div>
                                    </div>

                                    <div class="form-group row align-items-center" style="margin-bottom: 0.5rem;">
                                        <label for="months_to_completion" class="col-auto col-form-label" style="padding-right: 0.5rem;">Project Duration (Months):</label>
                                        <div class="col">
                                            <input type="number" class="form-control editable-field" id="months_to_completion" name="months_to_completion" required>
                                        </div>
                                    </div>

                                </div>
                            </div>

                            <div class="col-md-6">
                                <div class="card" style="padding:15px;">

                        
                                    <!-- PAYMENT TERMS -->
                                    <h6 style="background-color:#1E2A56; font-weight:800;color: white;text-align: center;padding: 1%;">PAYMENT TERMS</h6>

                                    <div class="form-group row align-items-center" style="margin-bottom: 0.5rem;">
                                        <label for="agreement_date" class="col-auto col-form-label" style="padding-right: 0.5rem;">Contract Agreement Date:</label>
                                        <div class="col">
                                            <input type="date" class="form-control editable-field" id="agreement_date" name="agreement_date" required>
                                        </div>
                                    </div>


                                    <div class="form-group row align-items-center" style="margin-bottom: 0.5rem;">
                                        <label class="col-auto col-form-label" style="padding-right: 0.5rem;">Total Contract Price (USD):</label>
                                        <div class="col">
                                            <input type="number" class="form-control editable-field" id="total_contract_price" name="total_contract_price" required>
                                        </div>
                                    </div>


                                    <div class="form-group">
                                        <label>Payment Method:</label>
                                        <select class="form-control-blue editable-field" id="paymentMethod" name="payment_method" required>
                                            <option value="" disabled selected>Select Payment Method</option>
                                            <option value="Installments">Installments</option>
                                            <option value="Bullet">Bullet</option>
                                        </select>
                                    </div>

                                    <div class="form-group row align-items-start" id="bullet_payment_date" style="display: none; margin-bottom: 0.5rem;">
                                        <label for="bullet_payment_date" class="col-auto col-form-label" style="padding-right: 0.5rem;">Date Full Payment Made:</label>
                                        <div class="col">
                                            <input type="date" class="form-control editable-field" id="bullet_payment_date" name="bullet_payment_date" required>
                                        </div>
                                    </div>



                                    <div id="paymentschedule" style="display: none;">


                                        <div class="form-group row align-items-center" style="margin-bottom: 0.5rem;">
                                            <label for="monthstopay" class="col-auto col-form-label" style="padding-right: 0.5rem;">Months To Pay:</label>
                                            <div class="col">
                                                <input type="number" class="form-control editable-field" id="monthstopay" name="months_to_pay" style="width: 40%;" required>
                                            </div>
                                        </div>

                                        <div class="form-group row align-items-center" style="margin-bottom: 0.5rem;">
                                            <label class="col-auto col-form-label" style="padding-right: 0.5rem;">Deposit Required (USD):</label>
                                            <div class="col">
                                                <input type="number" class="form-control editable-field" id="deposit_required" name="deposit_required" readonly>
                                            </div>
                                        </div>

                                        <div class="form-group row align-items-center" style="margin-bottom: 0.5rem;">
                                            <label for="deposit_payment_date" class="col-auto col-form-label" style="padding-right: 0.5rem;">Date Deposit Paid:</label>
                                            <div class="col">
                                                <input type="date" class="form-control editable-field" id="deposit_payment_date" name="deposit_payment_date" required>
                                            </div>
                                        </div>

                                        <div class="form-group row align-items-center" style="margin-bottom: 0.5rem;">
                                            <label for="first_installment_due_date" class="col-auto col-form-label" style="padding-right: 0.5rem;">Due Date For First Installment:</label>
                                            <div class="col">
                                                <input type="date" class="form-control editable-field" id="first_installment_due_date" name="first_installment_due_date" required>
                                            </div>
                                        </div>

                                    </div>

                                </div>

                            </div>
                        </div>

                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="saveProjectBtn" style="width: max-content;">Save Project</button>
                </div>
            </div>
        </div>
    </div>

    <main class="main-content" id="main-content">
        <header>
            <div class="employeetag">{{user_name}}, CONNECTLINK PROPERTIES <span style="color: white;background-color: #1E2A56;border-radius: 10px;padding: 6px;font-size: 13px;">ID: {{id}}</span></div>
            <div><span class="current-date" id="currdate">DATE: {{ today_date }}</span></div>
            <span id="name-down" value="{{firstname}}" style="display: none;"></span>
            <span id="name-down2" value="{{surname}}" style="display: none;"></span>

            <button onclick="window.location.href='/logout'" class="btn btn-primary" style="width: max-content;">  Logout<i class="bi bi-door-closed-fill" style="margin-left: 7px;"></i>  </button>

        </header>

        <div class="card" id="admin-content" style="display: block;">
            <ul class="nav nav-tabs">
                <li class="nav-item">
                    <button class="nav-link active" data-bs-toggle="tab" data-bs-target="#dashboard-tab"><i class="bi bi-person-badge-fill"></i>    ADMIN DASHBOARD</button>
                </li>

                <li class="nav-item">
                    <button class="nav-link" data-bs-toggle="tab" data-bs-target="#projects-tab"><i class="bi bi-list-columns-reverse"></i>    PROJECTS PORTFOLIO PORTAL</button>
                </li>

                <li class="nav-item">
                    <button class="nav-link" data-bs-toggle="tab" data-bs-target="#contractor-details-tab"><i class="bi bi-list-columns-reverse"></i>    CONTRACTOR DETAILS</button>
                </li>

            </ul>
            <div class="tab-content mt-4">
                <div class="tab-pane fade show active" id="dashboard-tab">

                    <div class="tab-pane fade show active" id="dashboard-tab">
                        <div class="dashboard-summary">
                            <div class="summary-card">
                                <div class="icon"><i class="bi bi-people-fill fs-3" style="color: #1E2A56;"></i></div>
                                <div class="details">
                                    <h5 style="font-weight: bolder;">Projects</h5>
                                    <p>{{ total_employees }}</p>
                                </div>
                            </div>
                            <div class="summary-card">
                                <div class="icon"><i class="bi bi-hourglass-split fs-3" style="color: #1E2A56;"></i></div>
                                <div class="details">
                                    <h5 style="font-weight: bolder;">Ongoing Projects</h5>
                                    <p>{{ open_requests }}</p>
                                </div>
                            </div>
                            <div class="summary-card">
                                <div class="icon"><i class="bi bi-calendar2-check-fill fs-3" style="color: #1E2A56;"></i></div>
                                <div class="details">
                                    <h5 style="font-weight: bolder;">Completed Projects</h5>
                                    <p>{{ approved_requests }}</p>
                                </div>
                            </div>
                            <div class="summary-card">
                                <div class="icon"><i class="bi bi-stopwatch-fill fs-3" style="color: #1E2A56;"></i></div>
                                <div class="details">
                                    <h5 style="font-weight: bolder;">Average Completion Time</h5>
                                    <p>{{ avg_approval_time }} days</p>
                                </div>
                            </div>

                            <div class="summary-card">
                                <div class="icon"><i class="bi bi-1-circle-fill fs-3" style="color: #1E2A56;"></i></div>
                                <div class="details">
                                    <h5 style="font-weight: bolder;">Top Location</h5>
                                    <p>{{ top_leave_type }} Leave</p>
                                </div>
                            </div>

                        </div>
                        <br>
                        <input id="dateRangePicker" placeholder="Select Date Range" style="width: 250px; padding: 3px; border-radius: 10px;">
                        <button id="filterBtn"  class="btn btn-primary" style="width:max-content;">Filter</button>
                        <br>
                        <div class="dashboard-graphs">
                            <div class="graph-card">
                                <h6>Leave Requests by Department</h6>
                                <canvas id="leaveByDepartmentChart" width="800" height="800"></canvas>

                            </div>
                            <div class="graph-card">
                                <h6>Leave Requests by Leave Type</h6>
                                <canvas id="leaveByTypeChart" width="800" height="800"></canvas>
                            </div>

                            <div class="graph-card">
                                <h6>Employees at Work by Department</h6>
                                <canvas id="employeesRemainingChart" width="800" height="800"></canvas>
                            </div>


                            <div class="graph-card">
                                <h6>% Employee Occupancy by Department</h6>
                                <canvas id="employeesRemainingChartbar" width="800" height="800"></canvas>
                            </div>
                            <div class="graph-card">
                                <h6>Top 5 Leave Takers</h6>
                                <canvas id="topLeaveTakersChart"></canvas>
                            </div>
                            <div class="graph-card">
                                <h6>Pending vs Approved</h6>
                                <canvas id="statusPieChart"></canvas>
                            </div>
                        </div>
                    </div>

                </div>
                <div class="tab-pane fade" id="projects-tab">
                    <button class="btn btn-primary mt-3" style="width: max-content;" data-bs-toggle="modal" data-bs-target="#ExportProjectsPortfolioModal"><i class="bi bi-journal-text"></i>    Export Projects Portfolio</button>
                    <div class="container mt-5">
                        <div class="container2" style="overflow-y: auto;">
                            {{ table_datamain_html |safe }}
                        </div>
                    </div>
                </div>
                <div class="tab-pane fade" id="contractor-details-tab">
                    <div class="container mt-5" style="color: #1E2A56;">

                        <div class="card shadow-sm border-0 rounded-4">
                            <div class="card-body p-4">

                                <h4 class="mb-4 fw-bold">CONTRACTOR DETAILS</h4>

                                <div class="row mb-3">
                                    <div class="col-md-4">
                                        <p class="text-muted mb-1">COMPANY</p>
                                        <p class="fw-semibold">{{ companyname }}</p>
                                    </div>
                                    <div class="col-md-4">
                                        <p class="text-muted mb-1">PHONES</p>
                                        <p class="fw-semibold">{{ contact1 }}</p>
                                        <p class="fw-semibold">{{ contact2 }}</p>
                                    </div>
                                    <div class="col-md-4">
                                        <p class="text-muted mb-1">EMAIL</p>
                                        <p class="fw-semibold">{{ compemail }}</p>
                                    </div>
                                </div>
 
                                <div class="row mb-4">

                                    <div class="col-md-4">
                                        <p class="text-muted mb-1">ADDRESS</p>
                                        <p class="fw-semibold">{{ address }}</p>
                                    </div>
                                    <div class="col-md-4">
                                        <p class="text-muted mb-1">TIN NUMBER</p>
                                        <p class="fw-semibold">{{ tinnumber }}</p>
                                    </div>
                                </div>

                                <button class="btn btn-primary px-4 py-2" data-bs-toggle="modal" data-bs-target="#editContractorModal">
                                    Edit Details
                                </button>

                            </div>
                        </div>

                    </div>
                </div>

                <div class="tab-pane fade" id="settings">
                    <h4>Payments</h4>
                    <p>Manage Payments</p>
                </div>
            </div>
        </div>
    </main>

    <div class="modal fade" id="editContractorModal" tabindex="-1" aria-labelledby="editContractorModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content rounded-4 border-0 shadow">

            <div class="modal-header">
                <h5 class="modal-title fw-bold" id="editContractorModalLabel">Edit Contractor Details</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>

            <div class="modal-body">

                <form id="contractorEditForm">

                <div class="row mb-3">
                    <div class="col-md-6">
                    <label class="form-label fw-semibold">Name</label>
                    <input type="text" class="form-control" value="John Doe">
                    </div>
                    <div class="col-md-6">
                    <label class="form-label fw-semibold">Company</label>
                    <input type="text" class="form-control" value="Doe Construction Ltd.">
                    </div>
                </div>

                <div class="row mb-3">
                    <div class="col-md-6">
                    <label class="form-label fw-semibold">Phone</label>
                    <input type="text" class="form-control" value="+1 (555) 123-4567">
                    </div>
                    <div class="col-md-6">
                    <label class="form-label fw-semibold">Email</label>
                    <input type="email" class="form-control" value="contact@doeconstruction.com">
                    </div>
                </div>

                <div class="row mb-3">
                    <div class="col-md-6">
                    <label class="form-label fw-semibold">Address</label>
                    <input type="text" class="form-control" value="123 Main St, Springfield">
                    </div>
                    <div class="col-md-6">
                    <label class="form-label fw-semibold">License Number</label>
                    <input type="text" class="form-control" value="LC-784923">
                    </div>
                </div>

                </form>

            </div>

            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary">Save Changes</button>
            </div>

            </div>
        </div>
    </div>


    <div class="modal fade" id="exportleaveapplicationsreportModal" tabindex="-1" aria-labelledby="exportleaveapplicationsreportModalLabel" >
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exportleaveapplicationsreportModalLabel"><i class="bi bi-files-alt"></i>    EXPORT LEAVE APPLICATIONS REPORT</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p style="font-weight: 500;">Select file format to Export Leave Applications Report for <b>{{company_name}}</b> :</p>
                    <div class="d-flex justify-content-around">
                        <button class="btn btn-primary2 mt-3"  data-bs-dismiss="modal" id="formatexcelapplicationsexport"><i class="bi bi-filetype-xlsx"></i>    Excel Workbook</button>
                        <button class="btn btn-primary2 mt-3"  data-bs-dismiss="modal" id="formatpdfapplicationsexport"><i class="bi bi-filetype-pdf"></i>    PDF</button>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Cancel</button>
                </div>
            </div>
        </div>
    </div>






    <div class="modal fade" id="editempdetailsModal" tabindex="-1" aria-labelledby="editempdetailsModalLabel"  >
        <div class="modal-dialog" style="max-width: 70%;">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="editempdetailsModalLabel"><i class="bi bi-files-alt"></i>    EMPLOYEE PERSONAL DETAILS EDITOR</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="container mt-5">
                        <div class="container2" style="max-height: 450px; overflow-y: auto;">
                            {{ employee_personal_details_html|safe }}
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Cancel</button>
                </div>
            </div>
        </div>
    </div>
    


<div class="modal fade" id="SubmitLeaveApplicationModal" tabindex="-1" role="dialog" aria-labelledby="SubmitLeaveApplicationModalLabel">
    <div class="modal-dialog" role="document"  style="max-width: 40%;">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="SubmitLeaveApplicationModalLabel"><i class="bi bi-file-earmark-medical-fill"></i>    LEAVE APPLICATION SUBMISSION CONFIRMATION</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div id="confirmationSubmitLeaveApplication" style="text-align: center;color: #1E2A56;font-weight: 500;"></div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" data-bs-dismiss="modal" id="confirmSubmit">Yes</button>
                <button type="button" class="btn btn-primary" data-bs-dismiss="modal">No</button>
            </div>
        </div>
    </div>
</div>


<div class="modal fade" id="editinfocompModal" tabindex="-1" role="dialog" aria-labelledby="editinfocompModalLabel">
   <div class="dropdown-overlayxx"></div>
    <div class="modal-dialog" role="document" style="max-width: 35%;">
        <div class="modal-content">
            <div class="modal-header">
                <h6 class="modal-title" id="editinfocompModalLabel">
                    <i class="bi bi-file-earmark-medical-fill"></i> PERSONAL DETAILS EDITOR  <span id="emp-name-title" class="uppercase-text"></span>
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>

            <div class="modal-body">

                <form id="employeeDetailsEditFormcomp">

                    <input type="hidden" id="emp-id-hidden-comp" name="employee_number_admin_edit">

                    <div class="mb-3">
                        <label for="firstname-editinfo-4-comp" class="form-label">First Name</label>
                        <input type="text" class="form-control" id="firstname-editinfo-4-comp" placeholder="Enter first name">
                    </div>

                    <div class="mb-3">
                        <label for="surname-editinfo-4-comp" class="form-label">Surname</label>
                        <input type="text" class="form-control" id="surname-editinfo-4-comp" placeholder="Enter surname">
                    </div>

                    <div class="mb-3">
                        <label for="whatsapp-editinfo-4-comp" class="form-label">WhatsApp Number</label>
                        <input type="text" class="form-control" id="whatsapp-editinfo-4-comp" placeholder="Enter WhatsApp number" maxlength="10" oninput="this.value = this.value.replace(/\D/g, '')">
                    </div>

                    <div class="mb-3">
                        <label for="email-editinfo-4-comp" class="form-label">Email Address</label>
                        <input type="email" class="form-control" id="email-editinfo-4-comp" placeholder="Enter email address">
                    </div>

                    <div class="mb-3">
                        <label for="address-editinfo-4-comp" class="form-label">Residential Address</label>
                        <textarea class="form-control" id="address-editinfo-4-comp" rows="3" placeholder="Enter address"></textarea>
                    </div>
                </form>
            </div>

            <div class="modal-footer">
                <button type="button" class="btn btn-primary" data-bs-dismiss="modal" id="savenewinfocomp" style="width: max-content;">Save Changes</button>
                <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Cancel</button>
            </div>
        </div>
    </div>
</div>





<div class="modal fade" id="editinfoModal" tabindex="-1" role="dialog" aria-labelledby="editinfoModalLabel">
    <div class="modal-dialog" role="document"  style="max-width: 40%;">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editinfoModalLabel"><i class="bi bi-file-earmark-medical-fill"></i>    EMPLOYEE DETAILS EDITOR</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="employeeDetailsEditForm">
                    <div class="mb-3">
                        <label for="whatsappNumber" class="form-label">WhatsApp Number</label>
                        <input type="number" class="form-control" id="whatsapp-editinfo-4"
                               placeholder="{{whatsapp}}">
                    </div>
                    
                    <div class="mb-3">
                        <label for="emailAddress" class="form-label">Email Address</label>
                        <input type="email" class="form-control" id="email-editinfo-4" 
                               placeholder="{{email}}">
                    </div>
                    
                    <div class="mb-3">
                        <label for="residentialAddress" class="form-label">Residential Address</label>
                        <textarea class="form-control" id="address-editinfo-4" 
                                  rows="3" placeholder="{{address}}"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" data-bs-dismiss="modal" id="savenewinfo" style="width: max-content;">Save Changes</button>
                <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Cancel</button>
            </div>
        </div>
    </div>
</div>


<div class="modal fade" id="cancelappModal" tabindex="-1" role="dialog" aria-labelledby="cancelappModalLabel">
    <div class="modal-dialog" role="document"  style="max-width: 40%;">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="cancelappModalLabel"><i class="bi bi-calendar2-x-fill"></i>   LEAVE APPLICATION CANCELLATION CONFIRMATION</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div id="cancelLeaveApplication" style="text-align: center;color: #1E2A56;font-weight: 500;"></div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" id="confirmcancelleaveapp">Yes</button>
                <button type="button" class="btn btn-primary" data-bs-dismiss="modal">No</button>
            </div>
        </div>
    </div>
</div>


<div class="modal fade" id="reapplyappModal" tabindex="-1" role="dialog" aria-labelledby="reapplyappModalLabel">
    <div class="modal-dialog" role="document"  style="max-width: 50%;">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="reapplyappModalLabel"><i class="bi bi-repeat"></i>    CONFIRMATION FOR RE-APPLICATION OF CANCELLED/DECLINED APPLICATION</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div id="reapplyLeaveApplication" style="text-align: center;color: #1E2A56;font-weight: 500;"></div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" id="confirmreapplyleaveapp">Yes</button>
                <button type="button" class="btn btn-primary" data-bs-dismiss="modal">No</button>
            </div>
        </div>
    </div>
</div>


<div class="modal fade" id="reviveappModal" tabindex="-1" role="dialog" aria-labelledby="reviveappModalLabel">
    <div class="modal-dialog" role="document"  style="max-width: 50%;">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="reviveappModalLabel"><i class="bi bi-repeat"></i>    CONFIRMATION FOR REVIVAL OF CANCELLED/DECLINED APPLICATION</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div id="reviveLeaveApplication" style="text-align: center;color: #1E2A56;font-weight: 500;"></div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" id="confirmreviveleaveapp">Yes</button>
                <button type="button" class="btn btn-primary" data-bs-dismiss="modal">No</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="revokeapproverappModal" tabindex="-1" role="dialog" aria-labelledby="revokeapproverappModalLabel">
    <div class="modal-dialog" role="document"  style="max-width: 50%;">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="revokeapproverappModalLabel"><i class="bi bi-backspace-reverse"></i>    CONFIRMATION FOR REVOCATION OF LEAVE APPLICATION</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div id="revokeapproverLeaveApplication" style="text-align: center;color: #1E2A56;font-weight: 500;"></div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" id="confirmrevokeapproverleaveapp">Yes</button>
                <button type="button" class="btn btn-primary" data-bs-dismiss="modal">No</button>
            </div>
        </div>
    </div>
</div>


<div class="modal fade" id="revokeappModal" tabindex="-1" role="dialog" aria-labelledby="revokeappModalLabel">
    <div class="modal-dialog" role="document"  style="max-width: 50%;">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="revokeappModalLabel"><i class="bi bi-backspace-reverse"></i>    CONFIRMATION FOR REVOCATION OF LEAVE APPLICATION</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div id="revokeappLeaveApplication" style="text-align: center;color: #1E2A56;font-weight: 500;"></div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" id="confirmrevokeleaveapp">Yes</button>
                <button type="button" class="btn btn-primary" data-bs-dismiss="modal">No</button>
            </div>
        </div>
    </div>
</div>








<div class="modal fade" id="editLeaveDaysAccumulatorModal" tabindex="-1" aria-labelledby="editLeaveDaysAccumulatorModalLabel" >
    <div class="modal-dialog" style="max-width: 50%;">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editLeaveDaysAccumulatorModalLabel">LEAVE DAYS ACCUMULATORS EDITOR</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="container mt-5">
                    <div class="container2" style="max-height: 450px; overflow-y: auto;">
                        {{ table_employees_accumulators_html|safe }}
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary9" id="saveaccumulators">Save Changes</button>
                <button type="button" class="btn btn-primary9" data-dismiss="modal" id="closeaccumulators">Cancel</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="ExportProjectsPortfolioModal" tabindex="-1" aria-labelledby="ExportProjectsPortfolioModalLabel" >
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="ExportProjectsPortfolioModalLabel"><i class="bi bi-journal-text"></i>    EXPORT PROJECTS PORTFOLIO</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p style="font-weight: 500;">Select file format to export Projects Portfolio for <b>{{company_name}}</b> :</p>
                <div class="d-flex justify-content-around">
                    <button class="btn btn-primary2 mt-3"  data-bs-dismiss="modal" id="formatexcellmsbookexport"><i class="bi bi-filetype-xlsx"></i>    Excel Workbook</button>
                    <button class="btn btn-primary2 mt-3"  data-bs-dismiss="modal" id="formatpdflmsbookexport"><i class="bi bi-filetype-pdf"></i>    PDF</button>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Cancel</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="addEmployeeModal" tabindex="-1" aria-labelledby="addEmployeeModalLabel" >
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addEmployeeModalLabel"><i class="bi bi-person-fill-add"></i>    ADD EMPLOYEES</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>Select an option to add employees:</p>
                <div class="d-flex justify-content-around">
                    <button class="btn btn-primary2 mt-3" id="formaddemployees">Add Manually</button>
                    <button class="btn btn-primary2 mt-3" data-bs-toggle="modal" data-bs-target="#ExcelTempModal">Import from Excel File</button>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Cancel</button>
            </div>
        </div>
    </div>
</div>


<div class="modal fade" id="ExcelTempModal" tabindex="-1" aria-labelledby="ExcelTempModalLabel">
    <div class="modal-dialog" style="max-width: 40%;">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="ExcelTempModal">ADD EMPLOYEES FROM EXCEL TEMPLATE</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="d-flex flex-column align-items-center justify-content-center text-center">
                    <form id="upload-form" action="/upload-excel" method="POST" enctype="multipart/form-data">
                        <button class="btn upload-template btn-primary2 mt-3" style="width: max-content;">
                            Upload Excel Template Containing Employee Details 
                            <i class="bi bi-cloud-upload" style="margin-left: 5px;"></i>
                        </button>
                        <!-- Hidden file input -->
                        <input type="file" id="file-upload" name="file" accept=".xlsx" style="display: none;">
                    </form>
                    <button class="btn btn-primary2 mt-3" id="download-btn-excel-template" style="width: max-content;">Download EDS LMS Template <i class="bi bi-file-earmark-arrow-down" style="margin-left: 5px;"></i></button>
                </div>         
            </div>
            
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Cancel</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="RemoveEmployeeModal" tabindex="-1" aria-labelledby="RemoveEmployeeModalLabel">
    <div class="modal-dialog" style="max-width: 40%;">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="RemoveEmployeeModalLabel">REMOVE EMPLOYEES</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="container mt-5">
                    <div class="container2" style="max-height: 450px; overflow-y: auto;">
                        {{ table_rememployees_html |safe }}
                    </div>
                </div>         
            </div>
            <div class="modal-footer">
                <button type="submit" class="btn btn-primary" id="removeselectedemployees" style="white-space: nowrap;width: auto;display: inline-block;">Remove Selected Employee(s)</button>
                <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Cancel</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal for displaying selected employees -->
<div class="modal fade" id="confirmationModalremove" tabindex="-1" role="dialog" aria-labelledby="confirmationModalremoveLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="confirmationModalremoveLabel">EMPLOYEE REMOVAL CONFIRMATION</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div id="confirmationMessageremove"></div>
                <div id="selectedEmployeesList" style="max-height: 200px; overflow-y: scroll;margin-top: 20px;"></div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" data-bs-dismiss="modal" id="confirmERemove" style="width: max-content;">Yes, Remove</button>
                <button type="button" class="btn btn-primary" data-bs-dismiss="modal">No</button>
            </div>
        </div>
    </div>
</div>



<!-- Modal for displaying selected employees -->
<div class="modal fade" id="approveappModal" tabindex="-1" role="dialog" aria-labelledby="approveappModalLabel">
    <div class="modal-dialog" role="document" style="max-width: 40%;">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="approveappModalLabel"><i class="bi bi-file-earmark-check" style="margin-left: 5px;font-size: 1.7rem;"></i> LEAVE APPLICATION APPROVAL CONFIRMATION</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div id="confirmationMessageapproveapp" style="text-align: center;color: #1E2A56;font-weight: 500;"></div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" data-bs-dismiss="modal" id="confirmapproveleaveapp" style="width: max-content;">Yes, Approve</button>
                <button type="button" class="btn btn-primary" data-bs-dismiss="modal">No</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="disapproveappModal" tabindex="-1" role="dialog" aria-labelledby="disapproveappModalLabel">
    <div class="modal-dialog" role="document" style="max-width: 40%;">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="disapproveappModalLabel"><i class="bi bi-file-earmark-excel" style="margin-left: 5px;font-size: 1.7rem;"></i> LEAVE APPLICATION DISAPPROVAL CONFIRMATION</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div id="confirmationMessagedisapproveapp" style="text-align: center;color: #1E2A56;font-weight: 500;"></div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" data-bs-dismiss="modal" id="confirmdisapproveleaveapp" style="width: max-content;">Yes, Disapprove</button>
                <button type="button" class="btn btn-primary" data-bs-dismiss="modal">No</button>
            </div>
        </div>
    </div>
</div>





<!-- Modal -->


  <div class="modal fade" id="confirmationModaldepartment" tabindex="-1" role="dialog" aria-labelledby="confirmationModaldepartmentLabel" >
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="confirmationModaldepartmentLabel">DEPARTMENT ASSIGNMENT CONFIRMATION</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <p id="confirmationMessagedepartment" style="text-align: center;font-size: 13pt;"></p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-primary" data-bs-dismiss="modal" id="savedepartmentconfirm">Yes</button>
          <button type="button" class="btn btn-primary" data-bs-dismiss="modal">No</button>
        </div>
      </div>
    </div>
  </div>


  <div class="dropdown-overlay" id="ovovo"></div>

  <div class="modal fade" id="confirmationModal" tabindex="-1" role="dialog" aria-labelledby="confirmationModalLabel" >
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="confirmationModalLabel">ROLE ASSIGNMENT CONFIRMATION</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <p id="confirmationMessage" style="text-align: center;font-size: 13pt;"></p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-primary" data-bs-dismiss="modal" id="saveroleconfirm">Yes</button>
          <button type="button" class="btn btn-primary" data-bs-dismiss="modal">No</button>
        </div>
      </div>
    </div>
  </div>
  

    <div class="modal fade" id="editModalapprover" tabindex="-1" role="dialog" aria-labelledby="editModalapproverLabel">
        <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
            <h5 class="modal-title" id="editModalapproverLabel">LEAVE APPLICATIONS APPROVER EDITOR</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>

            </div>
            <div class="modal-body">
            <form id="editapproverForm">
                <div class="form-group">
                    <label for="leaveapplicationsapprover-emp" id="content-change-approver"></label>
                    <select name="leaveapplicationsapprover-emp" class="form-control form-control-blue" id="leaveapplicationsapprover-emp" style="margin-top: 20px;">
                    
                    <option value="" disabled selected>Select Approver</option>        
                    {% for employee in employees_list %}
                        <option value="{{ employee }}">{{ employee }}</option>
                    {% endfor %}
                    </select> 
                </div>
            </form>
            </div>
            <div class="modal-footer">
            <button type="button" class="btn btn-primary" id="saveapprover" style="width: 35%;">Save Changes</button>
            <button type="button" class="btn btn-primary" data-bs-dismiss="modal" id="closeapprover">Cancel</button>
            </div>
        </div>
        </div>
    </div>

    <div class="modal fade" id="confirmationModalapprover" tabindex="-1" role="dialog" aria-labelledby="confirmationModalapproverLabel">
        <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
            <h5 class="modal-title" id="confirmationModalapproverLabel">APPLICATIONS APPROVER CONFIRMATION</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
            <p id="confirmationMessageapprover" style="text-align: center;font-size: 13pt;"></p>
            </div>
            <div class="modal-footer">
            <button type="button" class="btn btn-primary" data-bs-dismiss="modal" id="changeapproverconfirm">Yes</button>
            <button type="button" class="btn btn-primary" data-bs-dismiss="modal">No</button>
            </div>
        </div>
        </div>
    </div>
  
  <input type="hidden" id="role"  name="role" value="{{ role }}">
  <input type="hidden" id="idadmin"  name="idadmin" value="{{ id }}">

  <div class="modal fade" id="editModalbalance" tabindex="-1" role="dialog" aria-labelledby="editModalbalanceLabel">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="editModalbalanceLabel">LEAVE DAYS BALANCE EDITOR</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>

        </div>
        <div class="modal-body">
          <form id="editbalanceForm">
            <div class="form-group">
                <label for="leavedaysbalance-emp" id="content-edit-balance"></label>
                <input type="number" class="form-control" name="leavedaysbalance" id="leavedaysbalance-emp" placeholder="Enter New Leave Days Balance" style="margin-top: 20px;" required>

            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-primary9" id="savebalance" style="width: 35%;">Save Changes</button>
          <button type="button" class="btn btn-primary9" data-bs-dismiss="modal">Cancel</button>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="confirmationModalbalance" tabindex="-1" role="dialog" aria-labelledby="confirmationModalbalanceLabel">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="confirmationModalbalanceLabel">LEAVE DAYS BALANCE CONFIRMATION</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <p id="confirmationMessagebalance" style="text-align: center;font-size: 13pt;"></p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-primary" data-bs-dismiss="modal" id="editbalanceconfirm">Yes</button>
          <button type="button" class="btn btn-primary" data-bs-dismiss="modal">No</button>
        </div>
      </div>
    </div>
  </div>
  


  <!-- Bulk Operations -->
  <div class="modal fade" id="BulkRoleModal" tabindex="-1" aria-labelledby="BulkRoleModalLabel">
    <div class="modal-dialog" style="max-width: 40%;">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="BulkRoleModalLabel">BULK EMPLOYEE ROLE EDITOR</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">                    
                <div>
                    <button id="selectAllCheckboxes" type="button" class="btn btn-primary">Select All</button>
                    <button id="deselectAllCheckboxes" type="button" class="btn btn-primary" style="width: max-content;">Deselect All</button>
                </div>

                <div class="container mt-5">

                    <div class="container2" style="max-height: 400px; overflow-y: auto;">
                        {{ table_rememployees_bulk1_html |safe }}
                    </div>
                </div>   

                <div class="form-group" style="margin-top: 30px; text-align: center; display: flex; flex-direction: column; align-items: center;">
                    <label for="employeerole-emp-bulk">Select New Role for the Above Selected Employee(s)</label>
   
                    <select id="employeerole-emp-bulk" class="form-control form-control-blue" name="employeerole-emp-bulk" style="margin-top: 20px;">
                        <option value="" disabled selected>Select Employee Role</option>
                        <option value="Administrator">Administrator</option>
                        <option value="Ordinary User">Ordinary User</option> 
                    </select>
                </div>                   
            </div>
            <div class="modal-footer">
                <button type="submit" class="btn btn-primary" id="bulkroleassign" data-bs-toggle="modal" data-bs-target="#ConfirmBulkRoleModal" style="white-space: nowrap;width: auto;display: inline-block;">Assign Role to Selected Employees</button>
                <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Cancel</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="ConfirmBulkRoleModal" tabindex="-1" aria-labelledby="ConfirmBulkRoleModalLabel">
    <div class="modal-dialog" style="max-width: 40%;">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="ConfirmBulkRoleModalLabel">BULK EMPLOYEE ROLES CONFIRMATION</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body" id="confirmRolesMessage" style="text-align: center;"></div>
            <div id="selectedEmployeesList" style="text-align: center; padding: 5px;">
                <strong>Selected Employees:</strong>
                <ul id="selectedEmployeesUl" style="list-style-type: none; padding: 0; margin-top: 10px;"></ul>
            </div>
            
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" id="confirmRoleAssign" data-bs-dismiss="modal">Yes</button>
                <button type="button" class="btn btn-primary" data-bs-dismiss="modal">No</button>
            </div>
        </div>
    </div>
</div>

  <div class="modal fade" id="BulkApproverModal" tabindex="-1" aria-labelledby="BulkApproverModalLabel">
    <div class="modal-dialog" style="max-width: 40%;">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="BulkApproverModalLabel">BULK LEAVE APPLICATIONS APPROVER EDITOR</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">                    
                <div>
                    <button id="selectAllCheckboxes" type="button" class="btn btn-primary">Select All</button>
                    <button id="deselectAllCheckboxes" type="button" class="btn btn-primary" style="width: max-content;">Deselect All</button>
                </div>

                <div class="container mt-5">

                    <div class="container2" style="max-height: 400px; overflow-y: auto;">
                        {{ table_rememployees_bulk1_html |safe }}
                    </div>
                </div>   

                <div class="form-group" style="margin-top: 30px; text-align: center; display: flex; flex-direction: column; align-items: center;">
                    <label for="leaveapplicationsapprover-emp-bulk">Select New Leave Applications Approver for the Above Selected Employee(s)</label>

                    <select name="leaveapplicationsapprover-emp-bulk" class="form-control form-control-blue" id="leaveapplicationsapprover-emp-bulk" style="margin-top: 5px; width: 60%;border: 3px solid #1E2A56;">
                        <option value="" disabled selected>Select Approver</option>        
                        {% for employeebulk in employees_list %}
                            <option value="{{ employeebulk }}">{{ employeebulk }}</option>
                        {% endfor %}
                    </select>  
                </div>                   
            </div>
            <div class="modal-footer">
                <button type="submit" class="btn btn-primary" id="bulkapproverassign" data-bs-toggle="modal" data-bs-target="#ConfirmBulkApproverModal" style="white-space: nowrap;width: auto;display: inline-block;">Assign Approver to Selected Employees</button>
                <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Cancel</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="ConfirmBulkApproverModal" tabindex="-1" aria-labelledby="ConfirmBulkApproverModalLabel">
    <div class="modal-dialog" style="max-width: 40%;">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="ConfirmBulkApproverModalLabel">BULK LEAVE APPLICATIONS APPROVER CONFIRMATION</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body" id="confirmMessage" style="text-align: center;"></div>
            <div id="selectedEmployeesList" style="text-align: center; padding: 5px;">
                <strong>Selected Employees:</strong>
                <ul id="selectedEmployeesUl" style="list-style-type: none; padding: 0; margin-top: 10px;"></ul>
            </div>
            
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" id="confirmAssign" data-bs-dismiss="modal">Yes</button>
                <button type="button" class="btn btn-primary" data-bs-dismiss="modal">No</button>
            </div>
        </div>
    </div>
</div>


<div class="modal fade" id="BulkLeaveDaysBalanceModal" tabindex="-1" aria-labelledby="BulkLeaveDaysBalanceModalLabel">
    <div class="modal-dialog" style="max-width: 40%;">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="BulkLeaveDaysBalanceModalLabel">BULK LEAVE DAYS BALANCES EDITOR</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div>
                    <button id="selectAllCheckboxesbalances" type="button" class="btn btn-primary">Select All</button>
                    <button id="deselectAllCheckboxesbalances" type="button" class="btn btn-primary" style="width: max-content;">Deselect All</button>
                </div>
                <div class="container mt-5">
                    <div class="container2" style="max-height: 400px; overflow-y: auto;">
                        {{ table_rememployees_bulk_balances_html  |safe }}
                    </div>
                </div>   

                <div class="form-group" style="margin-top: 30px; text-align: center; display: flex; flex-direction: column; align-items: center;">
                    <label for="leavedaysbalance-emp-bulk">Enter New Leave Days Balance for the Above Selected Employee(s)</label>
                    <input type="number" id="leavedaysbalance-emp-bulk" name="leavedaysbalance-emp-bulk" class="form-control" placeholder="Enter new leave days balance" style="margin-top: 5px;width: 60%;border: 3px solid #1E2A56;" required />
                </div>      
            </div>
            <div class="modal-footer">
                <button type="submit" class="btn btn-primary" id="bulkbalancesassign" data-bs-toggle="modal" data-bs-target="#ConfirmBulkLeaveDaysBalanceModal" style="white-space: nowrap;width: auto;display: inline-block;">Commit New Leave Days Balance to Selected Employees</button>
                <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Cancel</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="ConfirmBulkLeaveDaysBalanceModal" tabindex="-1" aria-labelledby="ConfirmBulkLeaveDaysBalanceModalLabel">
    <div class="modal-dialog" style="max-width: 40%;">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="ConfirmBulkLeaveDaysBalanceModalLabel">BULK LEAVE DAYS BALANCES CONFIRMATION</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body" id="confirmMessagebalances" style="text-align: center;"></div>
            <div id="selectedEmployeesListbalances" style="text-align: center; padding: 5px;">
                <strong>Selected Employees:</strong>
                <ul id="selectedEmployeesUlbalances" style="list-style-type: none; padding: 0; margin-top: 10px;"></ul>
            </div>
            
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" id="confirmAssignbalances" data-bs-dismiss="modal">Yes</button>
                <button type="button" class="btn btn-primary" data-bs-dismiss="modal">No</button>
            </div>
        </div>
    </div>
</div>














<div class="modal fade" id="BulkAccumulatorsModal" tabindex="-1" aria-labelledby="BulkAccumulatorsModalLabel">
    <div class="modal-dialog" style="max-width: 45%;">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="BulkAccumulatorsModalLabel">BULK LEAVE DAYS ACCUMULATORS EDITOR</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div>
                    <button id="selectAllCheckboxesaccumulators" type="button" class="btn btn-primary">Select All</button>
                    <button id="deselectAllCheckboxesaccumulators" type="button" class="btn btn-primary" style="width: max-content;">Deselect All</button>
                </div>
                <div class="container mt-5">
                    <div class="container2" style="max-height: 400px; overflow-y: auto;">
                        {{ table_rememployees_bulk_accumulators_html |safe }}
                    </div>
                </div>   

                <div class="form-group" style="margin-top: 30px; text-align: center; display: flex; flex-direction: column; align-items: center;">
                    <label for="leavedaysaccumulators-emp-bulk">Select New Leave Days Accumulator for the Above Selected Employee(s)</label>
                    <input type="number" id="leavedaysaccumulators-emp-bulk" name="leavedaysaccumulators-emp-bulk" class="form-control" placeholder="Enter new leave days monthly accumulator" style="margin-top: 5px;width: 60%;border: 3px solid #1E2A56;" required />
                </div>      
            </div>
            <div class="modal-footer">
                <button type="submit" class="btn btn-primary" id="bulkaccumulatorsassign"  data-bs-toggle="modal" data-bs-target="#ConfirmBulkAccumulatorsModal" style="white-space: nowrap;width: auto;display: inline-block;">Commit New Leave Days Monthly Accumulator to Selected Employees</button>
                <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Cancel</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="ConfirmBulkAccumulatorsModal" tabindex="-1" aria-labelledby="ConfirmBulkAccumulatorsModalLabel">
    <div class="modal-dialog" style="max-width: 40%;">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="ConfirmBulkAccumulatorsModalLabel">BULK LEAVE DAYS ACCUMULATORS CONFIRMATION</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body" id="confirmMessageaccumulators88" style="text-align: center;"></div>
            <div id="selectedEmployeesListaccumulators" style="text-align: center; padding: 5px;">
                <strong>Selected Employees:</strong>
                <ul id="selectedEmployeesUlaccumulators" style="list-style-type: none; padding: 0; margin-top: 10px;"></ul>
            </div>
            
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" id="confirmAssignaccumulators" data-bs-dismiss="modal">Yes</button>
                <button type="button" class="btn btn-primary" data-bs-dismiss="modal">No</button>
            </div>
        </div>
    </div>
</div>






  <!-- Bootstrap and jQuery Scripts -->


<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>


<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.min.js"></script>
<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/choices.js/public/assets/scripts/choices.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels"></script>
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>

<script>
document.getElementById("saveProjectBtn").addEventListener("click", function () {

    // ----------------------------------------------------
    // 1. Perform your custom checks before submitting
    // ----------------------------------------------------

    const clientName = document.getElementById("client_name").value.trim();
    const projectName = document.getElementById("project_name").value.trim();
    const paymentMethod = document.getElementById("paymentMethod").value;

    if (clientName === "" || projectName === "") {
        alert("Client Name and Project Name are required.");
        return; // STOP submission
    }

    if (paymentMethod === "") {
        alert("Select a payment method.");
        return; // STOP submission
    }

    // Example additional logic:
    if (paymentMethod === "Installments") {
        let months = document.getElementById("monthstopay").value;
        if (months === "" || months <= 0) {
            alert("Months To Pay must be greater than 0.");
            return;
        }
    }

    // ----------------------------------------------------
    // 2. Build FormData object and send to Flask route
    // ----------------------------------------------------
    let form = document.getElementById("addProjectForm");
    let formData = new FormData(form);

    fetch("/contract_log", {
        method: "POST",
        body: formData
    })
    .then(response => {
        if (response.redirected) {
            // Flask may redirect after saving
            window.location.href = response.url;
        } else {
            return response.text();
        }
    })
    .then(data => {
        console.log("Server response:", data);
        alert("Project saved successfully!");
    })
    .catch(error => {
        console.error("Error:", error);
        alert("There was an error saving the project.");
    });

});
</script>
<script>
document.addEventListener("DOMContentLoaded", function () {

    const table = document.getElementById("allprojectsTable");
    if (!table) return;

    const columnsToShow = [
        "id",
        "clientname",
        "projectlocation",
        "totalcontractamount",
        "projectadministratorname",
        "projectcompletionstatus",
        "action"
    ];

    const headerCells = table.querySelectorAll("thead th");
    let colIndexMap = {};

    // Map column names  column index
    headerCells.forEach((th, index) => {
        const key = th.innerText.trim().toLowerCase().replace(/\s+/g, "");
        colIndexMap[key] = index;
    });

    // Loop through all columns and hide those NOT in columnsToShow
    headerCells.forEach((th, index) => {
        const field = th.innerText.trim().toLowerCase().replace(/\s+/g, "");
        if (!columnsToShow.includes(field)) {
            hideColumn(table, index);
        }
    });

    function hideColumn(table, columnIndex) {
        const rows = table.querySelectorAll("tr");
        rows.forEach(row => {
            const cells = row.children;
            if (cells[columnIndex]) {
                cells[columnIndex].style.display = "none";
            }
        });
    }

});
</script>

<script>
    const paymentMethod = document.getElementById('paymentMethod');
    const paymentSchedule = document.getElementById('paymentschedule');
    const bulletpaymentdate = document.getElementById('bullet_payment_date');
    const depositRequired = document.getElementById('deposit_required');
    const totalContractPrice = document.getElementById('total_contract_price');

    paymentMethod.addEventListener('change', function() {
        if (this.value === 'Installments') {
            paymentSchedule.style.display = 'block';
            bulletpaymentdate.style.display = 'none';

            const total = parseFloat(totalContractPrice.value);
            if (!isNaN(total)) {
                depositRequired.value = (total * 0.3).toFixed(2);
            } else {
                depositRequired.value = '';
            }

        } else {
            paymentSchedule.style.display = 'none';
            bulletpaymentdate.style.display = 'block';
        }
    });


</script>

<script>



let currentIdeditrole = null;
let currentIdeditdetails = null;
let currentIdeditdepartment = null;
let currentIdchangeapprover = null;
let currentIdeditbalance = null;

let currentFirstName = null; 



$(document).on('click', '.edit-priv-btn', function() {
    currentIdeditrole = $(this).data('id'); 
    $('#emp-id').text('ID: ' + currentIdeditrole);

    var row = $(this).closest('tr'); 

    currentFirstName = row.find('td').eq(1).text(); 

    var message = `Select New Role for <strong>${currentFirstName} -- ID: ${currentIdeditrole}</strong>`;
    $('#content-edit-priv').html(message);
});

$(document).on('click', '.edit-department-btn', function() {
    currentIdeditdepartment = $(this).data('id'); 
    $('#emp-id').text('ID: ' + currentIdeditdepartment);

    var row = $(this).closest('tr'); 

    currentFirstName = row.find('td').eq(1).text(); 

    var message = `Select New Department for <strong>${currentFirstName} -- ID: ${currentIdeditdepartment}</strong>`;
    $('#content-edit-department').html(message);
});

$(document).on('click', '.change-approver-btn', function() {
    currentIdchangeapprover = $(this).data('id'); 
    $('#emp-id').text('ID: ' + currentIdchangeapprover);

    var row = $(this).closest('tr'); 

    currentFirstName = row.find('td').eq(1).text(); 

    var message = `Select New Approver for <strong>${currentFirstName} -- ID: ${currentIdchangeapprover}</strong>`;
    $('#content-change-approver').html(message);
});

$(document).on('click', '.edit-balance-btn', function() {
    currentIdeditbalance = $(this).data('id'); 
    $('#emp-id').text('ID: ' + currentIdeditbalance);

    var row = $(this).closest('tr'); 

    currentFirstName = row.find('td').eq(1).text(); 

    var message = `Enter New Leave Days Balance for <strong>${currentFirstName} -- ID: ${currentIdeditbalance}</strong>`;
    $('#content-edit-balance').html(message);
});

$(document).ready(function () {

    $('#saveaccumulators').click(function () {
        let updates = [];
        const companyname = $('#company_name').val().trim();  // Get the company name from the hidden input

        // Check if company name is empty
        if (!companyname) {
            alert("Company name is required.");
            return;  // Prevent further execution if company name is missing
        }

        // Gather data from the table
        $('#employeesaccumulatorsTable .editable-field').each(function () {
            let $field = $(this);
            let id = $field.data('id'); // Employee ID
            let newValue = parseFloat($field.val()); // New value entered

            // Check if the ID and value are valid before adding to updates
            if (id && !isNaN(newValue)) {
                updates.push({ id: id, accumulated_days: newValue });
            } else {
                console.error("Invalid data-id or value for field:", $field);
            }
        });

        // Check if updates array is empty (no valid data to send)
        if (updates.length === 0) {
            alert("No valid data to update.");
            return;  // Prevent sending the request if no valid data
        }
        $('#edsLoader').show();  // Show loading overlay immediately

        // Send updates to the server
        $.ajax({
            url: '/update_accumulators',
            type: 'POST',
            contentType: 'application/json',
            data: JSON.stringify({ updates: updates, companyname: companyname }),
            success: function (response) {

                $('#editLeaveDaysAccumulatorModal').modal('hide');  // Hide the modal after success
                $('#edsLoader').hide();  // Show loading overlay immediately
                setTimeout(function() {
                    alert(response.message);  // Show alert after the overlay
                }, 100);  // 100ms delay to ensure UI update before alert
                location.reload();  // Reload the table to reflect changes
            },
            error: function () {
                alert('Error updating Accumulators.');
            }
        });
    });
});



$('#btn-dashboard').click(function() {
        $('#dashboard-tab').tab('show');
    });

$('#btn-leave-apps-portal').click(function() {
    $('#projects-tab').tab('show');
});

$('#closepriv').on('click', function() {
    $('#editModalpriv').modal('hide'); 
});

$('#closeapprover').on('click', function() {
    $('#editModalapprover').modal('hide'); 
});

$('#closeaccumulators').on('click', function() {
    $('#editLeaveDaysAccumulatorModal').modal('hide'); 
});

$('#cancel_add_emplyee_manual').on('click', function() {
    $('#manualaddemployeeModal').modal('hide'); 
});



$('#savedepartmentconfirm').on('click', function() {
    var newdepartment = $('#department-emp').val();  // Get the selected role
    var companyname = $('#company_name').val();  // Get the company name from the hidden input

    if (!newdepartment || !companyname) {
        alert("Please fill in all required fields.");
        return;  // Prevent further execution if fields are empty
    }

    $('#edsLoader').show();

    
    if (newdepartment) {
        // Send the data to the Flask endpoint
        $.ajax({
            url: '/update_department',  // Change to your desired endpoint
            method: 'POST',
            data: {
                department: newdepartment,
                currentId: currentIdeditdepartment,  // Include the currentId in the request
                companyname: companyname  // Include the company_name in the request
            },
            success: function(response) {
                // Handle the response from Flask (e.g., show success message or refresh data)
                $('#editModaldepartment').modal('hide');  // Hide the modal after success
                $('#edsLoader').hide();

                setTimeout(function() {
                    alert('Department updated successfully.');
                }, 100);  // 100ms delay to ensure UI update before alert
                location.reload();  
            },
            error: function(xhr, status, error) {
                // Handle any errors (e.g., alert user)
                alert('Error: ' + error);
            }
        });
    } else {
        // If no role is selected
        alert("Please select a department before saving.");
    }
});


$('#saveroleconfirm').on('click', function() {
    var newrole = $('#role-emp').val();  // Get the selected role
    var companyname = $('#company_name').val();  // Get the company name from the hidden input

    if (!newrole || !companyname) {
        alert("Please fill in all required fields.");
        return;  // Prevent further execution if fields are empty
    }

    $('#edsLoader').show();

    
    if (newrole) {
        // Send the data to the Flask endpoint
        $.ajax({
            url: '/update_role',  // Change to your desired endpoint
            method: 'POST',
            data: {
                role: newrole,
                currentId: currentIdeditrole,  // Include the currentId in the request
                companyname: companyname  // Include the company_name in the request
            },
            success: function(response) {
                // Handle the response from Flask (e.g., show success message or refresh data)
                $('#editModalpriv').modal('hide');  // Hide the modal after success
                $('#edsLoader').hide();

                setTimeout(function() {
                    alert('Role updated successfully.');
                }, 100);  // 100ms delay to ensure UI update before alert
                location.reload();  
            },
            error: function(xhr, status, error) {
                // Handle any errors (e.g., alert user)
                alert('Error: ' + error);
            }
        });
    } else {
        // If no role is selected
        alert("Please select a role before saving.");
    }
});

$('#adminextrainfo').on('click', function () {

    console.log("currentleaveDays:", $('#currentleavedays-admin').val());
    console.log("monthlyaccumulation:", $('#monthlyaccumulation-admin').val());
    console.log("companyname:", $('#company_name').val());
    console.log("email:", $('#email').val());
    console.log("firstName:", $('#firstname').val());
    console.log("surname:", $('#surname').val());

    const formData = {
        currentleavedays: $('#currentleavedays-admin').val().trim(),
        monthlyaccumulation: $('#monthlyaccumulation-admin').val().trim(),
        companyName: $('#company_name').val().trim(),
        email: $('#email').val().trim(),
        firstname: $('#firstname').val().trim(),
        surname: $('#surname').val().trim()
    };

    // Log the collected data for debugging
    console.log("Form data being sent:", formData);

    // Validate required fields
    if ( !formData.currentleavedays || !formData.monthlyaccumulation) {
        alert("Please fill in all required fields.");
        return;  // Stop execution if validation fails
    }

    // Optional: Show a loading overlay
    $('#edsLoader').show();

    // AJAX request to send data to Flask backend
    $.ajax({
        url: '/admin-modal',  // Replace with your Flask endpoint
        method: 'POST',
        data: formData,
        success: function (response) {
            // Hide loading overlay
            $('#edsLoader').hide();

            // Handle success (e.g., close modal and show confirmation)
            alert('Administrator info saved successfully.');
            $('#AdminModal').modal('hide');  // Close modal
            window.location.href = '/dashboard';
        },
        error: function (xhr, status, error) {
            // Hide loading overlay
            $('#edsLoader').hide();

            // Handle error (e.g., display error message)
            alert('Error: ' + error);
            console.error("Error details:", xhr.responseText);
        }
    });
});






$('#changeapproverconfirm').on('click', function() {
    var newapprover = $('#leaveapplicationsapprover-emp').val();  // Get the selected role
    var companyname = $('#company_name').val();  // Get the company name from the hidden input

    if (!newapprover || !companyname) {
        alert("Please select Leave Applications Approver before commiting.");
        return;  // Prevent further execution if fields are empty
    }

    $('#edsLoader').show();

    if (newapprover) {
        // Send the data to the Flask endpoint
        $.ajax({
            url: '/update_approver',  // Change to your desired endpoint
            method: 'POST',
            data: {
                approver: newapprover,
                currentIdapprover: currentIdchangeapprover,  // Include the currentId in the request
                companyname: companyname  // Include the company_name in the request
            },
            success: function(response) {
                
                $('#confirmationModalapprover').modal('hide');  // Hide the modal after success
                $('#editModalapprover').modal('hide');  // Hide the modal after success
                $('#edsLoader').hide();

                setTimeout(function() {
                    alert('Approver changed successfully.');
                }, 100);  // 100ms delay to ensure UI update before alert

                location.reload();  
            },
            error: function(xhr, status, error) {
                // Handle any errors (e.g., alert user)
                alert('Error: ' + error);
            }
        });
    } else {
        // If no role is selected
        alert("Please select an approver before saving.");
    }
});

$('#editbalanceconfirm').on('click', function() {
    var newbalance = $('#leavedaysbalance-emp').val().trim();  // Get the selected leave days balance
    var companyname = $('#company_name').val().trim();  // Get the company name from the hidden input

    // Check if the necessary fields have values
    if (!newbalance || !companyname) {
        alert("Please fill in all required fields.");
        return;  // Prevent further execution if fields are empty
    }

    $('#edsLoader').show();

    // Send the data to the Flask endpoint
    $.ajax({
        url: '/update_balance',  // Change to your desired endpoint
        method: 'POST',
        data: {
            balance: newbalance,
            currentIdbalance: currentIdeditbalance,  // Include the currentId in the request
            companyname: companyname  // Include the company_name in the request
        },
        success: function(response) {
            // Hide the modals immediately
            $('#confirmationModalbalance').modal('hide');  // Hide the confirmation modal
            $('#editModalbalance').modal('hide');  // Hide the edit modal
            
            // Hide the loading overlay immediately
            $('#edsLoader').hide();

            // Show alert after a very short delay to ensure the overlay is hidden first
            setTimeout(function() {
                alert('Leave Days Balance changed successfully');
            }, 100);  // 0ms delay to ensure the alert appears after hiding overlay
            location.reload();  // Reload the page or update the DOM as needed

        },
        error: function(xhr, status, error) {
            // Handle any errors (e.g., alert user)
            alert('Error: ' + error);
            $('#edsLoader').hide();  // Hide overlay if error occurs
        }
    });
});


$('#saveaddemployee').on('click', function(e) {
    e.preventDefault();

    // Get form data
    const formData = {
        firstname: $('#firstname-emp').val().trim(),
        surname: $('#surname-emp').val().trim(),
        whatsapp: $('#whatsapp-emp').val().trim(),
        email: $('#email-emp').val().trim(),
        role: $('#role-emp-add').val(),
        department: $('#department-emp-add').val(),
        selected_employees: $('#leaveapplicationsapprover').val(),
        currentleavedays: $('input[name="currentleavedays"]').val().trim(),
        monthlyaccumulation: $('input[name="monthlyaccumulation"]').val().trim()
    };

    // Log form data for debugging
    console.log("Form data being sent:", formData);

    // Validation: Check if all required fields are filled
    if (!formData.firstname || !formData.surname || !formData.whatsapp || !formData.email || !formData.role ||  !formData.department || !formData.selected_employees || !formData.currentleavedays || !formData.monthlyaccumulation) {
        alert("Please fill in all required fields.");
        return;  // Exit the function if validation fails
    }

    // Show loading overlay
    $('#edsLoader').show();

    // Send the form data using AJAX
    $.ajax({
        url: '/manual_add_employee',
        method: 'POST',
        data: formData,
        success: function(response) {
            
            $('#addEmployeeModal').modal('hide');
            $('#manualaddemployeeModal').modal('hide');
            $('#edsLoader').hide();
            // Add a slight delay before showing the alert to ensure UI update
            setTimeout(function() {
                alert('Employee added successfully');
            }, 100);  // 100ms delay to ensure UI update before alert
            //             
            location.reload();  // Reload the page or update the DOM as needed
        },
        error: function(xhr, status, error) {
            // Hide loading overlay and display error message
            $('#edsLoader').hide();

            // Check the response for more specific error messages
            if (xhr.status === 400) {
                alert('Bad Request: Please check your input data.');
            } else if (xhr.status === 500) {
                alert('Server Error: Something went wrong on the server side.');
            } else {
                alert('Error: ' + error);
            }
        }
    });
});








document.getElementById('savenewinfocomp').addEventListener('click', function() {
    const firstnameInput = document.getElementById('firstname-editinfo-4-comp');
    const surnameInput = document.getElementById('surname-editinfo-4-comp');
    const whatsappInput = document.getElementById('whatsapp-editinfo-4-comp');
    const emailInput = document.getElementById('email-editinfo-4-comp');
    const addressInput = document.getElementById('address-editinfo-4-comp');
    const idInput = document.getElementById('emp-id-hidden-comp');

    // Sanitize WhatsApp input: remove spaces and take last 9 digits
    let rawWhatsapp = whatsappInput.value.trim().replace(/\s+/g, '');
    let whatsappSanitized = rawWhatsapp.slice(-9);  // last 9 characters

    // Fallback to placeholder if value is empty
    if (!whatsappSanitized) {
        let placeholderClean = whatsappInput.placeholder.replace(/\s+/g, '');
        whatsappSanitized = placeholderClean.slice(-9);
    }

    const formData = {
        id: idInput.value,
        firstname: firstnameInput.value.trim() || firstnameInput.placeholder,
        surname: surnameInput.value.trim() || surnameInput.placeholder,
        whatsapp: whatsappSanitized,
        email: emailInput.value.trim() || emailInput.placeholder,
        address: addressInput.value.trim() || addressInput.placeholder
    };
    // Show loading overlay
    $('#edsLoader').show();

    // Send data using jQuery AJAX
    $.ajax({
        url: '/update_employee_details_admin_comp',
        method: 'POST',
        contentType: 'application/json',
        data: JSON.stringify(formData),
        success: function(response) {
            $('#editinfocompModal').modal('hide');
            $('#edsLoader').hide();

            console.log('Returned data:', response.data);  //  log it
            console.log('Full response:', response);

            console.log('Updated firstname:', response.data.firstname);

            const updated = response.data;
            alert(`Employee updated:\nName: ${updated.firstname} ${updated.surname}\nWhatsApp: ${updated.whatsapp}\nEmail: ${updated.email}\nAddress: ${updated.address}`);

            setTimeout(function() {
                location.reload();
            }, 100);
        },
        error: function(xhr, status, error) {
            // Hide loading overlay
            $('#edsLoader').hide();

            let serverErrorMsg = 'An unknown error occurred.';

            try {
                const response = JSON.parse(xhr.responseText);
                serverErrorMsg = response.error || serverErrorMsg;
            } catch (e) {
                serverErrorMsg = 'Could not parse error message.';
            }

            if (xhr.status === 400) {
                alert('Bad Request: ' + serverErrorMsg);
            } else if (xhr.status === 500) {
                alert('Server Error: ' + serverErrorMsg);
            } else {
                alert('Error: ' + serverErrorMsg);
            }
        }
    });
});





document.getElementById('savenewinfo').addEventListener('click', function() {
    const whatsappInput = document.getElementById('whatsapp-editinfo-4');
    const emailInput = document.getElementById('email-editinfo-4');
    const addressInput = document.getElementById('address-editinfo-4');


    // If field is empty, use placeholder value
    const formData = {
        whatsapp: whatsappInput.value.trim() || whatsappInput.placeholder,
        email: emailInput.value.trim() || emailInput.placeholder,
        address: addressInput.value.trim() || addressInput.placeholder
    };

    // Show loading overlay
    $('#edsLoader').show();

    // Send data using jQuery AJAX
    $.ajax({
        url: '/update_employee_details',
        method: 'POST',
        contentType: 'application/json',
        data: JSON.stringify(formData),
        success: function(response) {
            // Hide modals and loading overlay
            $('#editinfoModal').modal('hide');
            $('#edsLoader').hide();
            
            // Show success message with slight delay
            setTimeout(function() {
                alert('Employee details updated successfully');
                location.reload();
            }, 100);
        },
        error: function(xhr, status, error) {
            // Hide loading overlay
            $('#edsLoader').hide();

            // Handle different error cases
            if (xhr.status === 400) {
                alert('Bad Request: Please check your input data.');
            } else if (xhr.status === 500) {
                alert('Server Error: Something went wrong on the server side.');
            } else {
                alert('Error: ' + error);
            }
        }
    });
});


async function downloadLeaveApp(appId) {
    const btn = document.querySelector(`button[data-id="${appId}"]`);
    const originalText = btn.innerHTML;
    // Find the <tr> where the button is located
    const row = btn.closest('tr');

    // Find the full name from the "Employee Name" column
    // You can improve this by assigning a class to that <td> (e.g., <td class="employee-name">)
    const nameCell = Array.from(row.cells).find(cell =>
        cell.textContent.trim() && !cell.querySelector('button') && isNaN(cell.textContent.trim())
    );

    const fullName = nameCell ? nameCell.textContent.trim() : 'Unknown_Name';
    
    try {
        // 1. Show loading state
        btn.disabled = true;
        btn.innerHTML = '<i class="fa fa-spinner fa-spin"></i> Generating...';

        // 2. Fetch PDF
        const response = await fetch(`/download_leave_app/${appId}`);
        
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }

        // 3. Check content type (ensure it's PDF)
        const contentType = response.headers.get('content-type');
        if (!contentType || !contentType.includes('application/pdf')) {
            throw new Error('Invalid content type - expected PDF');
        }

        // 4. Create download
        const blob = await response.blob();
        const url = window.URL.createObjectURL(blob);
        
        const a = document.createElement('a');
        a.style.display = 'none';
        a.href = url;
        a.download = `leave_application_${fullName}_${appId}.pdf`;
        document.body.appendChild(a);
        a.click();

        // 5. Cleanup
        window.URL.revokeObjectURL(url);
        document.body.removeChild(a);

    } catch (error) {
        console.error('Download failed:', error);
        btn.innerHTML = '<i class="fa fa-exclamation-circle"></i> Failed - Retry';
        // Optional: Show user-friendly alert
        alert(`Download failed: ${error.message}`);
    } finally {
        // 6. Reset button (even if success or error)
        btn.disabled = false;
        btn.innerHTML = originalText;
    }
}


document.addEventListener('DOMContentLoaded', () => {
    const modals = document.querySelectorAll('.modal');
    const mainContent = document.querySelector('body > *:not(.modal)'); // Select all content outside modals

    modals.forEach(modal => {
        modal.addEventListener('show.bs.modal', () => {
            // Add inert to main content when modal is open
            mainContent.setAttribute('inert', '');
        });

        modal.addEventListener('hidden.bs.modal', () => {
            // Remove inert from main content when modal is closed
            mainContent.removeAttribute('inert');
        });
    });


    const myDiv = document.getElementById('adminoptionchoice');
        const shouldHide = myDiv.getAttribute('data-hide');

        // Hide if data-hide is "true"
        if (shouldHide === "True") {
            myDiv.remove();
            localStorage.removeItem('selectedProfile');
        }

    const myDiv2 = document.getElementById('approversonly');
        const shouldHide2 = myDiv2.getAttribute('data-hide');

        // Hide if data-hide is "true"
        if (shouldHide2 === "True") {
            myDiv2.remove();
        }


    const myDiv3 = document.getElementById('attendance');

    if (myDiv3) {
        const shouldHide3 = myDiv3.getAttribute('data-hide');  // Correct attribute

        // Hide if data-hide is "True"
        if (shouldHide3 === "True") {
            myDiv3.remove();
        }
    }

    const myDiv4 = document.getElementById('performance');

    if (myDiv4) {
        const shouldHide4= myDiv4.getAttribute('data-hide');  // Correct attribute

        // Hide if data-hide is "True"
        if (shouldHide4 === "True") {
            myDiv4.remove();
        }
    }


    document.getElementById('formatexcellmsbookexport').addEventListener('click', () => {
            window.location.href = '/export_lms_book_excel';
        });

    document.getElementById('formatpdflmsbookexport').addEventListener('click', () => {
        window.location.href = '/export_lms_book_pdf';
    });

    // Handling form submission using AJAX
    document.getElementById('upload-form').addEventListener('submit', function(event) {
        event.preventDefault(); // Prevent default form submission (since we're using AJAX)

        // Send the form data using AJAX
        fetch('/upload-excel', {
            method: 'POST',
        })
        .then(response => response.json())
        .then(data => {
            console.log(data); // Debug the response
            
            if (data.status === 'success') {
                alert('Employees Successfully Added!'); // Show success alert
                $('#edsLoader').hide(); // Hide the loading overlay

            } else {
                alert('Something went wrong. Please try again.'); // Handle error response
            }
        })
        .catch(error => {
            console.error('Error:', error); // Debug error
            $('#edsLoader').hide(); // Hide loading overlay in case of error
            alert('An error occurred while uploading the file.'); // Show error alert
        });
    });









    document.getElementById('leaveForm').addEventListener('submit', function (e) {
    // Prevent the default form submission
    e.preventDefault();

    // Check if the form is valid
    if (this.checkValidity()) {
      // Trigger the modal programmatically
      const modal = new bootstrap.Modal(document.getElementById('SubmitLeaveApplicationModal'));
      modal.show();
    } else {
      // Highlight invalid fields and show validation messages
      this.reportValidity();
    }




    $('#confirmSubmit').on('click', function () {
    // Validate the required fields
    var isValid = true;
    var errorMessage = '';

    // Check required fields
    $('#leaveForm').find('input[required], select[required], textarea[required]').each(function () {
        if (!$(this).val()) {
            isValid = false;
            errorMessage = 'Please fill in all required fields.';
            return false; // Exit the loop on the first empty field
        }
    });

    // If validation fails, show an alert and stop submission
    if (!isValid) {
        alert(errorMessage);
        return;
    }

    // Gather all the form data
    var formData = new FormData($('#leaveForm')[0]); // Include file inputs if any

    // Show a loading overlay (optional)
    $('#edsLoader').show();

    // Make the AJAX request to submit the form
    $.ajax({
        url: '/leave_application',  // Replace with your Flask route for handling the form submission
        type: 'POST',
        data: formData,
        processData: false, // Prevent jQuery from automatically processing the data
        contentType: false, // Prevent jQuery from setting the content-type header
        success: function (response) {
            // Hide the modals
            $('#SubmitLeaveApplicationModal').modal('hide');
            $('#edsLoader').hide();

            // Optionally, show a success message or redirect
            alert('Leave application submitted successfully.');
            location.reload(); // Reload the page or handle UI updates dynamically
        },
        error: function (xhr, status, error) {
            $('#edsLoader').hide();
            console.log("xhr.status:", xhr.status);
            console.log("xhr.responseText:", xhr.responseText);
            console.log("xhr.getResponseHeader('Content-Type'):", xhr.getResponseHeader('Content-Type'));
            try {
                var response = JSON.parse(xhr.responseText);
                alert("Error: " + response.message);
            } catch (e) {
                alert("An unexpected error occurred. Please try again.");
            }
        }

    });
});

  });



    
    // Event listener for "Select All" button
    document.getElementById('selectAllCheckboxes').addEventListener('click', function () {
        const checkboxes = document.querySelectorAll(".employee-checkbox-bulk-approver");
        checkboxes.forEach(checkbox => {
            if (!checkbox.checked) {
                checkbox.checked = true; // Select the checkbox
                const event = new Event('change');
                checkbox.dispatchEvent(event); // Trigger change event
            }
        });
    });

    // Event listener for "Deselect All" button
    document.getElementById('deselectAllCheckboxes').addEventListener('click', function () {
        const checkboxes = document.querySelectorAll(".employee-checkbox-bulk-approver");
        checkboxes.forEach(checkbox => {
            if (checkbox.checked) {
                checkbox.checked = false; // Deselect the checkbox
                const event = new Event('change');
                checkbox.dispatchEvent(event); // Trigger change event
            }
        });
    });

    // Trigger file input click on button click
    document.querySelector('.upload-template').addEventListener('click', function(event) {
        event.preventDefault(); // Prevent any accidental form submission
        document.getElementById('file-upload').click(); // This will open file manager
    });

    // Submit form after a file is selected
    document.getElementById('file-upload').addEventListener('change', function() {
        if (this.files.length > 0) {
            // Prevent form submission for now
            document.getElementById('upload-form').submit();  
            $('#edsLoader').show(); // Show loading overlay
        }
    });







    const leaveForm = document.getElementById("leaveForm");
    const leaveTypeField = document.getElementById("leaveType");
    const startDateField = document.getElementById("startDate");
    const endDateField = document.getElementById("endDate");
    const confirmationSubmitLeaveApplication = document.getElementById("confirmationSubmitLeaveApplication");


    leaveForm.addEventListener("submit", function (event) {
        // Prevent form submission
        event.preventDefault();

        // Get the values
        const leaveType = leaveTypeField.value;
        const startDate = startDateField.value;
        const endDate = endDateField.value;

        // Check if startDate and endDate are valid
        if (!startDate || !endDate) {
            alert("Please select valid start and end dates.");
            return;
        }

        // Format the dates to 'dd MMM yyyy'
        const formatDate = (date) => {
            const options = { day: '2-digit', month: 'long', year: 'numeric' };
            return new Date(date).toLocaleDateString('en-US', options);
        };

        const formattedStartDate = formatDate(startDate);
        const formattedEndDate = formatDate(endDate);

        // Calculate the number of days excluding Sundays
        let start = new Date(startDate);
        const end = new Date(endDate);
        let days = 0;

        while (start <= end) {
            // Add to days count if not Sunday (0 represents Sunday in JS)
            if (start.getDay() !== 0) {
                days++;
            }
            // Move to the next day
            start.setDate(start.getDate() + 1);
        }

        confirmationSubmitLeaveApplication.innerHTML = `Proceed to submit your <br><br> <strong><span style="background-color:#e9f1fb;padding:7px; border-radius:15px;">${leaveType} leave application</span></strong> <br><br> for <strong><span style="background-color:#e9f1fb;padding:7px; border-radius:15px;">${days} day(s)</span></strong> (excluding Sundays) <br><br> from <strong><span style="background-color:#e9f1fb;padding:7px; border-radius:15px;">${formattedStartDate}</span></strong> to <strong><span style="background-color:#e9f1fb;padding:4px; border-radius:15px;">${formattedEndDate}</span></strong>?`;
        // Show confirmation dialog
    });


    document.getElementById('download-btn-excel-template').addEventListener('click', function() {
        window.location.href = "/download-excel-template-add-employees";  // Triggers the Flask route to download the file
    });


    const bulkApproverAssignButton = document.getElementById('bulkapproverassign');
    const approverDropdown = document.getElementById('leaveapplicationsapprover-emp-bulk');
    const confirmMessage = document.getElementById('confirmMessage');
    const selectedEmployeesUl = document.getElementById('selectedEmployeesUl');



    // Style the selected employees list to be scrollable with max height
    selectedEmployeesUl.style.maxHeight = "300px";
    selectedEmployeesUl.style.overflowY = "auto";
    selectedEmployeesUl.style.border = "1px solid #ddd";
    selectedEmployeesUl.style.padding = "10px";
    selectedEmployeesUl.style.marginTop = "5px";

    // Event listener for individual checkboxes
    document.querySelectorAll(".employee-checkbox-bulk-approver").forEach(checkbox => {
        checkbox.addEventListener("change", () => {
            const employeeName = checkbox.getAttribute("data-employee-name");
            const employeeId = checkbox.value;

            if (checkbox.checked) {
                // Add employee to the selected list if not already present
                if (!selectedEmployeesUl.querySelector(`[data-employee-id="${employeeId}"]`)) {
                    const li = document.createElement("li");
                    li.textContent = employeeName;
                    li.setAttribute("data-employee-id", employeeId);
                    selectedEmployeesUl.appendChild(li);
                }
            } else {
                // Remove employee from the selected list
                const liToRemove = selectedEmployeesUl.querySelector(`[data-employee-id="${employeeId}"]`);
                if (liToRemove) {
                    selectedEmployeesUl.removeChild(liToRemove);
                }
            }
        });
    });

    // Event listener for "Assign Approver" button
    bulkApproverAssignButton.addEventListener('click', function () {
        const selectedApprover = approverDropdown.value;

        // Check if an approver is selected
        if (!selectedApprover) {
            alert('Please select an approver before proceeding.');
            return;
        }

        // Collect selected employees
        const selectedEmployees = Array.from(selectedEmployeesUl.children).map(li => li.textContent);

        if (selectedEmployees.length === 0) {
            alert('Please select at least one employee before proceeding.');
            return;
        }

        confirmMessage.innerHTML = `
            <p>Proceed to assign <br><br>
            <strong><span style="background-color:#e9f1fb;padding:7px; border-radius:15px;">${selectedApprover}</span></strong> <br><br>
            as the Leave Applications Approver for the following selected employees?</p>
        `;
    });


    document.getElementById('confirmAssign').addEventListener('click', function () {
        // Prepare the data to send to Flask
        const approver = document.getElementById('leaveapplicationsapprover-emp-bulk').value;
        const selectedEmployees = Array.from(document.getElementById('selectedEmployeesUl').children)
            .map(li => li.getAttribute('data-employee-id'));

        if (!approver || selectedEmployees.length === 0) {
            alert('Please select an approver and at least one employee before proceeding.');
            return;
        }

        const dataToSend = {
            approver: approver,
            employees: selectedEmployees,
        };
        $('#edsLoader').show();  // Hide loading overlay

        // Perform the AJAX request
        $.ajax({
            url: '/assign_bulk_approver',
            method: 'POST',
            contentType: 'application/json',
            data: JSON.stringify(dataToSend),
            success: function(response) {
                $('#ConfirmBulkApproverModal').modal('hide');  // Close the modal
                $('#edsLoader').hide();  // Hide loading overlay
                // Add a slight delay before showing the alert to ensure UI update
                setTimeout(function() {
                    alert('Approver assigned successfully');
                }, 100);  // 100ms delay to ensure UI update before alert
                location.reload();  // Reload the page or update the DOM as needed
            },
            error: function(xhr, status, error) {
                $('#edsLoader').hide();  // Hide loading overlay

                // Check the response for more specific error messages
                if (xhr.status === 400) {
                    alert('Bad Request: Please check your input data.');
                } else if (xhr.status === 500) {
                    alert('Server Error: Something went wrong on the server side.');
                } else {
                    alert('Error: ' + error);
                }
            }
        });
    });



    const today = new Date().toISOString().split('T')[0];
    const startDateInput = document.getElementById("startDate");
    const endDateInput = document.getElementById("endDate");

    // Function to add one day to startDate
    function addOneDay(dateString) {
        const date = new Date(dateString);
        date.setDate(date.getDate() + 1);
        return date.toISOString().split('T')[0];
    }

    // Function to update endDate min attribute
    function updateEndDateMin() {
        const startDateValue = startDateInput.value;
        if (startDateValue) {
            const minEndDate = startDateValue;
            endDateInput.setAttribute("min", minEndDate);
            endDateInput.value = ""; // Reset end date to force re-selection
        }
    }

    // Event listener for start date change
    startDateInput.addEventListener("change", updateEndDateMin);











    document.getElementById('selectAllCheckboxesbalances').addEventListener('click', function () {
        const checkboxes = document.querySelectorAll(".employee-checkbox-bulk-balances");
        checkboxes.forEach(checkbox => {
            if (!checkbox.checked) {
                checkbox.checked = true; // Select the checkbox
                const event = new Event('change');
                checkbox.dispatchEvent(event); // Trigger change event
            }
        });
    });

    // Event listener for "Deselect All" button
    document.getElementById('deselectAllCheckboxesbalances').addEventListener('click', function () {
        const checkboxes = document.querySelectorAll(".employee-checkbox-bulk-balances");
        checkboxes.forEach(checkbox => {
            if (checkbox.checked) {
                checkbox.checked = false; // Deselect the checkbox
                const event = new Event('change');
                checkbox.dispatchEvent(event); // Trigger change event
            }
        });
    });

    const bulkBalancesAssignButton = document.getElementById('bulkbalancesassign');
    const balancesDropdown = document.getElementById('leavedaysbalance-emp-bulk');
    const confirmMessagebalances = document.getElementById('confirmMessagebalances');
    const selectedEmployeesUlbalances = document.getElementById('selectedEmployeesUlbalances');

    // Style the selected employees list to be scrollable with max height
    selectedEmployeesUlbalances.style.maxHeight = "300px";
    selectedEmployeesUlbalances.style.overflowY = "auto";
    selectedEmployeesUlbalances.style.border = "1px solid #ddd";
    selectedEmployeesUlbalances.style.padding = "10px";
    selectedEmployeesUlbalances.style.marginTop = "5px";

    // Event listener for individual checkboxes
    document.querySelectorAll(".employee-checkbox-bulk-balances").forEach(checkbox => {
        checkbox.addEventListener("change", () => {
            const employeeName = checkbox.getAttribute("data-employee-name");
            const employeeId = checkbox.value;

            if (checkbox.checked) {
                // Add employee to the selected list if not already present
                if (!selectedEmployeesUlbalances.querySelector(`[data-employee-id="${employeeId}"]`)) {
                    const li = document.createElement("li");
                    li.textContent = employeeName;
                    li.setAttribute("data-employee-id", employeeId);
                    selectedEmployeesUlbalances.appendChild(li);
                }
            } else {
                // Remove employee from the selected list
                const liToRemove = selectedEmployeesUlbalances.querySelector(`[data-employee-id="${employeeId}"]`);
                if (liToRemove) {
                    selectedEmployeesUlbalances.removeChild(liToRemove);
                }
            }
        });
    });

    // Event listener for "Assign Approver" button
    bulkBalancesAssignButton.addEventListener('click', function () {
        const selectedBalance = balancesDropdown.value;

        // Check if an approver is selected
        if (!selectedBalance) {
            alert('Please input new leave days balance before proceeding.');
            return;
        }

        // Collect selected employees
        const selectedEmployees = Array.from(selectedEmployeesUlbalances.children).map(li => li.textContent);

        if (selectedEmployees.length === 0) {
            alert('Please select at least one employee before proceeding.');
            return;
        }

        confirmMessagebalances.innerHTML = `
            <p>Proceed to assign <br><br>
            <strong><span style="background-color:#e9f1fb;padding:7px; border-radius:15px;">${selectedBalance}</span></strong> <br><br>
            as the Leave Days Balance for the following selected employees?</p>
        `;
    });


    document.getElementById('confirmAssignbalances').addEventListener('click', function () {
        // Prepare the data to send to Flask
        const balance = document.getElementById('leavedaysbalance-emp-bulk').value;
        const selectedEmployees = Array.from(document.getElementById('selectedEmployeesUlbalances').children)
            .map(li => li.getAttribute('data-employee-id'));

        if (!balance || selectedEmployees.length === 0) {
            alert('Please input new leave days balance and at least one employee before proceeding.');
            return;
        }

        const dataToSend = {
            balance: balance,
            employees: selectedEmployees,
        };
        $('#edsLoader').show();  // Hide loading overlay

        // Perform the AJAX request
        $.ajax({
            url: '/assign_bulk_balances',
            method: 'POST',
            contentType: 'application/json',
            data: JSON.stringify(dataToSend),
            success: function(response) {
                $('#ConfirmBulkBalancesModal').modal('hide');  // Close the modal
                $('#edsLoader').hide();  // Hide loading overlay
                // Add a slight delay before showing the alert to ensure UI update
                setTimeout(function() {
                    alert('New Leave Days Balances assigned successfully');
                }, 100);  // 100ms delay to ensure UI update before alert
                location.reload();  // Reload the page or update the DOM as needed
            },
            error: function(xhr, status, error) {
                $('#edsLoader').hide();  // Hide loading overlay

                // Check the response for more specific error messages
                if (xhr.status === 400) {
                    alert('Bad Request: Please check your input data.');
                } else if (xhr.status === 500) {
                    alert('Server Error: Something went wrong on the server side.');
                } else {
                    alert('Error: ' + error);
                }
            }
        });
    });











    document.getElementById('selectAllCheckboxesaccumulators').addEventListener('click', function () {
        const checkboxes = document.querySelectorAll(".employee-checkbox-bulk-accumulators");
        checkboxes.forEach(checkbox => {
            if (!checkbox.checked) {
                checkbox.checked = true; // Select the checkbox
                const event = new Event('change');
                checkbox.dispatchEvent(event); // Trigger change event
            }
        });
    });



    // Event listener for "Deselect All" button
    document.getElementById('deselectAllCheckboxesaccumulators').addEventListener('click', function () {
        const checkboxes = document.querySelectorAll(".employee-checkbox-bulk-accumulators");
        checkboxes.forEach(checkbox => {
            if (checkbox.checked) {
                checkbox.checked = false; // Deselect the checkbox
                const event = new Event('change');
                checkbox.dispatchEvent(event); // Trigger change event
            }
        });
    });

    const bulkAccumulatorsAssignButton = document.getElementById('bulkaccumulatorsassign');
    const accumulatorsDropdown = document.getElementById('leavedaysaccumulators-emp-bulk');
    const confirmMessageaccumulators = document.getElementById('confirmMessageaccumulators88');
    const selectedEmployeesUlaccumulators = document.getElementById('selectedEmployeesUlaccumulators');

    // Style the selected employees list to be scrollable with max height
    selectedEmployeesUlaccumulators.style.maxHeight = "300px";
    selectedEmployeesUlaccumulators.style.overflowY = "auto";
    selectedEmployeesUlaccumulators.style.border = "1px solid #ddd";
    selectedEmployeesUlaccumulators.style.padding = "10px";
    selectedEmployeesUlaccumulators.style.marginTop = "5px";

    // Event listener for individual checkboxes
    document.querySelectorAll(".employee-checkbox-bulk-accumulators").forEach(checkbox => {
        checkbox.addEventListener("change", () => {
            const employeeName = checkbox.getAttribute("data-employee-name");
            const employeeId = checkbox.value;

            if (checkbox.checked) {
                // Add employee to the selected list if not already present
                if (!selectedEmployeesUlaccumulators.querySelector(`[data-employee-id="${employeeId}"]`)) {
                    const li = document.createElement("li");
                    li.textContent = employeeName;
                    li.setAttribute("data-employee-id", employeeId);
                    selectedEmployeesUlaccumulators.appendChild(li);
                }
            } else {
                // Remove employee from the selected list
                const liToRemove = selectedEmployeesUlaccumulators.querySelector(`[data-employee-id="${employeeId}"]`);
                if (liToRemove) {
                    selectedEmployeesUlaccumulators.removeChild(liToRemove);
                }
            }
        });
    });

    // Event listener for "Assign Approver" button
    bulkAccumulatorsAssignButton.addEventListener('click', function () {
        const selectedAccumulator = accumulatorsDropdown.value;

        console.log('Selected Accumulator:', selectedAccumulator);

        // Check if an approver is selected
        if (!selectedAccumulator) {
            alert('Please input new leave days accumulator before proceeding.');
            return;
        }

        // Collect selected employees
        const selectedEmployees = Array.from(selectedEmployeesUlaccumulators.children).map(li => li.textContent);

        if (selectedEmployees.length === 0) {
            alert('Please select at least one employee before proceeding.');
            return;
        }

        confirmMessageaccumulators.innerHTML = `
            <p>Proceed to assign <br><br>
            <strong><span style="background-color:#e9f1fb;padding:7px; border-radius:15px;">${selectedAccumulator}</span></strong> <br><br>
            as the Monthly Leave Days Accumulator for the following selected employees?</p>
        `;
    });


    document.getElementById('confirmAssignaccumulators').addEventListener('click', function () {
        // Prepare the data to send to Flask
        const accumulator = document.getElementById('leavedaysaccumulators-emp-bulk').value;
        const selectedEmployees = Array.from(document.getElementById('selectedEmployeesUlaccumulators').children)
            .map(li => li.getAttribute('data-employee-id'));

        if (!accumulator || selectedEmployees.length === 0) {
            alert('Please input new monthly leave days accumulator and at least one employee before proceeding.');
            return;
        }

        const dataToSend = {
            accumulator: accumulator,
            employees: selectedEmployees,
        };
        $('#edsLoader').show();  // Hide loading overlay

        // Perform the AJAX request
        $.ajax({
            url: '/assign_bulk_accumulators',
            method: 'POST',
            contentType: 'application/json',
            data: JSON.stringify(dataToSend),
            success: function(response) {
                $('#ConfirmBulkAccumulatorsModal').modal('hide');  // Close the modal
                $('#edsLoader').hide();  // Hide loading overlay
                // Add a slight delay before showing the alert to ensure UI update
                setTimeout(function() {
                    alert('New Monthly Leave Days Accumulator assigned successfully');
                }, 100);  // 100ms delay to ensure UI update before alert
                location.reload();  // Reload the page or update the DOM as needed
            },
            error: function(xhr, status, error) {
                $('#edsLoader').hide();  // Hide loading overlay

                // Check the response for more specific error messages
                if (xhr.status === 400) {
                    alert('Bad Request: Please check your input data.');
                } else if (xhr.status === 500) {
                    alert('Server Error: Something went wrong on the server side.');
                } else {
                    alert('Error: ' + error);
                }
            }
        });
    });







    let currentIdrevokeapproverapp = null

    $(document).on('click', '.revokeapprover-app-btn', function() {

        const formatDate = (date) => {
            const options = { day: '2-digit', month: 'long', year: 'numeric' };
            return new Date(date).toLocaleDateString('en-US', options);
        };

        currentIdrevokeapproverapp = $(this).data('id');
        $('#apprevoke-id').text('APP ID: ' + currentIdrevokeapproverapp);
        var row = $('#leaveappsTableapprovedbyme td').filter(function() {
            return $(this).text() == currentIdrevokeapproverapp;
        }).closest('tr');

        var name = row.find('td').eq(1).text();
        var leavetype = row.find('td').eq(2).text();
        var dateapplied = formatDate(row.find('td').eq(3).text());
        var leaveStartDate = formatDate(row.find('td').eq(4).text());
        var leaveEndDate = formatDate(row.find('td').eq(5).text());
        var leavedays = row.find('td').eq(6).text();
        
        var message = `Proceed to Revoke <strong><span style="background-color:#e9f1fb;padding:7px; border-radius:15px;">${leavetype}</span></strong> Leave Application for <strong><span style="background-color:#e9f1fb;padding:7px; border-radius:15px;">${name}</span></strong> applied on <br><br> <strong><span style="background-color:#e9f1fb;padding:7px; border-radius:15px;">${dateapplied}</span></strong> <br><br> for <strong><span style="background-color:#e9f1fb;padding:7px; border-radius:15px;">${leavedays} day(s)</span></strong> <br><br> from <strong><span style="background-color:#e9f1fb;padding:7px; border-radius:15px;">${leaveStartDate}</span></strong> to <strong><span style="background-color:#e9f1fb;padding:7px; border-radius:15px;">${leaveEndDate}</span></strong> <br><br> <span style="background-color:#e9f1fb;padding:7px; border-radius:15px;">[App ID -- <strong>${currentIdrevokeapproverapp}</strong>]</span>?`;
        
        $('#revokeapproverLeaveApplication').html(message);
    });



    $(document).on('click', '#confirmrevokeapproverleaveapp', function() {

        $('#edsLoader').show();  // Hide loading overlay

        $.ajax({
            url: '/revoke_leave_application_approver',  // Flask route to handle cancellation
            type: 'POST',
            contentType: 'application/json',
            data: JSON.stringify({ app_id: currentIdrevokeapproverapp }),
            success: function(response) {
                $('#revokeapproverappModal').modal('hide');  // Close the modal
                $('#edsLoader').hide();  // Hide loading overlay
                setTimeout(function() {
                    alert(response.message);
                }, 100);  // 100ms delay to ensure UI update before alert
                location.reload();  // Reload the page or update the DOM as needed
            },
            error: function (xhr, status, error) {
            // Handle errors gracefully
            $('#revokeapproverappModal').modal('hide');
            $('#edsLoader').hide();
            alert('Error: Unable to revoke the leave application.');
        }
        });
    });






    let currentIddelapp = null

    $(document).on('click', '.cancel-app-btn', function() {

        const formatDate = (date) => {
            const options = { day: '2-digit', month: 'long', year: 'numeric' };
            return new Date(date).toLocaleDateString('en-US', options);
        };

        currentIddelapp = $(this).data('id');
        $('#appcancel-id').text('APP ID: ' + currentIddelapp);
        var row = $('#myleaveappsTable td').filter(function() {
            return $(this).text() == currentIddelapp;
        }).closest('tr');
        
        var leavetype = row.find('td').eq(1).text();
        var dateapplied = formatDate(row.find('td').eq(2).text());
        var leaveStartDate = formatDate(row.find('td').eq(3).text());
        var leaveEndDate = formatDate(row.find('td').eq(4).text());
        var leavedays = row.find('td').eq(5).text();
        
        var message = `Proceed to Cancel <strong><span style="background-color:#e9f1fb;padding:7px; border-radius:15px;">${leavetype}</span></strong> Leave Application applied on <br><br> <strong><span style="background-color:#e9f1fb;padding:7px; border-radius:15px;">${dateapplied}</span></strong> <br><br> for <strong><span style="background-color:#e9f1fb;padding:7px; border-radius:15px;">${leavedays} day(s)</span></strong> <br><br> from <strong><span style="background-color:#e9f1fb;padding:7px; border-radius:15px;">${leaveStartDate}</span></strong> to <strong><span style="background-color:#e9f1fb;padding:7px; border-radius:15px;">${leaveEndDate}</span></strong> <br><br> <span style="background-color:#e9f1fb;padding:7px; border-radius:15px;">[App ID -- <strong>${currentIddelapp}</strong>]</span>?`;
        
    
        $('#cancelLeaveApplication').html(message);


    });



    $(document).on('click', '#confirmcancelleaveapp', function() {

        $('#edsLoader').show();  // Hide loading overlay

        $.ajax({
            url: '/cancel_leave_application',  // Flask route to handle cancellation
            type: 'POST',
            contentType: 'application/json',
            data: JSON.stringify({ app_id: currentIddelapp }),
            success: function(response) {
                $('#cancelappModal').modal('hide');  // Close the modal
                $('#edsLoader').hide();  // Hide loading overlay
                setTimeout(function() {
                    alert(response.message);
                }, 100);  // 100ms delay to ensure UI update before alert
                location.reload();  // Reload the page or update the DOM as needed
            },
            error: function(xhr, status, error) {
                console.error("Error:", error);
                alert("Failed to cancel the leave application. Please try again.");
            }
        });
    });



    let currentIdreapplyapp = null

    $(document).on('click', '.reapply-app-btn', function() {

        const formatDate = (date) => {
            const options = { day: '2-digit', month: 'long', year: 'numeric' };
            return new Date(date).toLocaleDateString('en-US', options);
        };

        currentIdreapplyapp = $(this).data('id');
        $('#appreapply-id').text('APP ID: ' + currentIdreapplyapp);
        var row = $('#myleaveappsTable td').filter(function() {
            return $(this).text() == currentIdreapplyapp;
        }).closest('tr');
        
        var leavetype = row.find('td').eq(1).text();
        var dateapplied = formatDate(row.find('td').eq(2).text());
        var leaveStartDate = formatDate(row.find('td').eq(3).text());
        var leaveEndDate = formatDate(row.find('td').eq(4).text());
        var leavedays = row.find('td').eq(5).text();
        
        var message = `Proceed to Re-apply <strong><span style="background-color:#e9f1fb;padding:7px; border-radius:15px;">${leavetype}</span></strong> Leave Application applied on <br><br> <strong><span style="background-color:#e9f1fb;padding:7px; border-radius:15px;">${dateapplied}</span></strong> <br><br> for <strong><span style="background-color:#e9f1fb;padding:7px; border-radius:15px;">${leavedays} day(s)</span></strong> <br><br> from <strong><span style="background-color:#e9f1fb;padding:7px; border-radius:15px;">${leaveStartDate}</span></strong> to <strong><span style="background-color:#e9f1fb;padding:7px; border-radius:15px;">${leaveEndDate}</span></strong> <br><br> <span style="background-color:#e9f1fb;padding:7px; border-radius:15px;">[App ID -- <strong>${currentIdreapplyapp}</strong>]</span>?`;
        
    
        $('#reapplyLeaveApplication').html(message);


    });

    $(document).on('click', '#confirmreapplyleaveapp', function () {
        $('#edsLoader').show();

        $.ajax({
            url: '/reapply_leave_application',
            type: 'POST',
            contentType: 'application/json',
            data: JSON.stringify({ app_id: currentIdreapplyapp }),

            success: function (response) {
                $('#reapplyappModal').modal('hide');
                $('#edsLoader').hide();
                setTimeout(function () {
                    alert(response.message);
                    location.reload();
                }, 100);
            },

            error: function (xhr, status, error) {
                $('#reapplyappModal').modal('hide');
                $('#edsLoader').hide();

                let errorMsg = "Unable to reapply for leave.";

                try {
                    const responseJSON = JSON.parse(xhr.responseText);
                    if (responseJSON.message) {
                        errorMsg = responseJSON.message;
                    }
                    if (responseJSON.error) {
                        errorMsg += "\nDetails: " + responseJSON.error;
                    }
                } catch (e) {
                    errorMsg += "\nUnexpected error format.";
                }

                alert("Error: " + errorMsg);
            }
        });
    });










    let currentIdrevokeapp = null

    $(document).on('click', '.revoke-app-btn', function() {

        const formatDate = (date) => {
            const options = { day: '2-digit', month: 'long', year: 'numeric' };
            return new Date(date).toLocaleDateString('en-US', options);
        };

        currentIdrevokeapp = $(this).data('id');
        $('#appreapply-id').text('APP ID: ' + currentIdrevokeapp );
        var row = $('#myleaveappsTable td').filter(function() {
            return $(this).text() == currentIdrevokeapp ;
        }).closest('tr');
        
        var leavetype = row.find('td').eq(1).text();
        var dateapplied = formatDate(row.find('td').eq(2).text());
        var leaveStartDate = formatDate(row.find('td').eq(3).text());
        var leaveEndDate = formatDate(row.find('td').eq(4).text());
        var leavedays = row.find('td').eq(5).text();
        
        var message = `Proceed to apply for Revocation of <strong><span style="background-color:#e9f1fb;padding:7px; border-radius:15px;">${leavetype}</span></strong> Leave Application applied on <br><br> <strong><span style="background-color:#e9f1fb;padding:7px; border-radius:15px;">${dateapplied}</span></strong> <br><br> for <strong><span style="background-color:#e9f1fb;padding:7px; border-radius:15px;">${leavedays} day(s)</span></strong> <br><br> from <strong><span style="background-color:#e9f1fb;padding:7px; border-radius:15px;">${leaveStartDate}</span></strong> to <strong><span style="background-color:#e9f1fb;padding:7px; border-radius:15px;">${leaveEndDate}</span></strong> <br><br> <span style="background-color:#e9f1fb;padding:7px; border-radius:15px;">[App ID -- <strong>${currentIdrevokeapp}</strong>]</span>?`;
        

        $('#revokeappLeaveApplication').html(message);


    });



    $(document).on('click', '#confirmrevokeleaveapp', function() {

        $('#edsLoader').show();  // Hide loading overlay

        $.ajax({
            url: '/revoke_leave_application',  // Flask route to handle cancellation
            type: 'POST',
            contentType: 'application/json',
            data: JSON.stringify({ app_id: currentIdrevokeapp }),
            success: function(response) {
                $('#revokeappModal').modal('hide');  // Close the modal
                $('#edsLoader').hide();  // Hide loading overlay
                setTimeout(function() {
                    alert(response.message);
                }, 100);  // 100ms delay to ensure UI update before alert
                location.reload();  // Reload the page or update the DOM as needed
            },
            error: function (xhr, status, error) {
            // Handle errors gracefully
            $('#revokeappModal').modal('hide');
            $('#edsLoader').hide();
            alert('Error: Unable to submit your leave application revocation request. Please make sure that you do not have any pending leave applications and try again.');
        }
        });
    });













    let currentIdreviveapp = null

    $(document).on('click', '.revive-app-btn', function() {

        const formatDate = (date) => {
            const options = { day: '2-digit', month: 'long', year: 'numeric' };
            return new Date(date).toLocaleDateString('en-US', options);
        };

        currentIdreviveapp = $(this).data('id');
        $('#apprevive-id').text('APP ID: ' + currentIdreviveapp);
        var row = $('#leaveappsTableapprovedbyme td').filter(function() {
            return $(this).text() == currentIdreviveapp;
        }).closest('tr');

        var name = row.find('td').eq(1).text();
        var leavetype = row.find('td').eq(2).text();
        var dateapplied = formatDate(row.find('td').eq(3).text());
        var leaveStartDate = formatDate(row.find('td').eq(4).text());
        var leaveEndDate = formatDate(row.find('td').eq(5).text());
        var leavedays = row.find('td').eq(6).text();
        
        var message = `Proceed to Revive <strong><span style="background-color:#e9f1fb;padding:7px; border-radius:15px;">${leavetype}</span></strong> Leave Application for <strong><span style="background-color:#e9f1fb;padding:7px; border-radius:15px;">${name}</span></strong> applied on <br><br> <strong><span style="background-color:#e9f1fb;padding:7px; border-radius:15px;">${dateapplied}</span></strong> <br><br> for <strong><span style="background-color:#e9f1fb;padding:7px; border-radius:15px;">${leavedays} day(s)</span></strong> <br><br> from <strong><span style="background-color:#e9f1fb;padding:7px; border-radius:15px;">${leaveStartDate}</span></strong> to <strong><span style="background-color:#e9f1fb;padding:7px; border-radius:15px;">${leaveEndDate}</span></strong> <br><br> <span style="background-color:#e9f1fb;padding:7px; border-radius:15px;">[App ID -- <strong>${currentIdreviveapp}</strong>]</span>?`;
        

        $('#reviveLeaveApplication').html(message);


    });



    $(document).on('click', '#confirmreviveleaveapp', function() {

        $('#edsLoader').show();  // Hide loading overlay

        $.ajax({
            url: '/revive_leave_application',  // Flask route to handle cancellation
            type: 'POST',
            contentType: 'application/json',
            data: JSON.stringify({ app_id: currentIdreviveapp }),
            success: function(response) {
                $('#reviveappModal').modal('hide');  // Close the modal
                $('#edsLoader').hide();  // Hide loading overlay
                setTimeout(function() {
                    alert(response.message);
                }, 100);  // 100ms delay to ensure UI update before alert
                location.reload();  // Reload the page or update the DOM as needed
            },
            error: function (xhr, status, error) {
            // Handle errors gracefully
            $('#reviveappModal').modal('hide');
            $('#edsLoader').hide();
            alert('Error: Unable to revive the leave application. Please make sure that the employee does not have any pending leave applications and try again.');
        }
        });
    });




    let currentIdapproveapp = null

    $(document).on('click', '.approve-app-btn', function() {

        const formatDate = (date) => {
            const options = { day: '2-digit', month: 'long', year: 'numeric' };
            return new Date(date).toLocaleDateString('en-US', options);
        };

        currentIdapproveapp = $(this).data('id');
        $('#appapprove-id').text('APP ID: ' + currentIdapproveapp);
        var row = $('#leaveappsTableapprovedbyme td').filter(function() {
            return $(this).text() == currentIdapproveapp;
        }).closest('tr');
        
        var leavetype = row.find('td').eq(2).text();
        var name = row.find('td').eq(1).text();
        var dateapplied = formatDate(row.find('td').eq(3).text());
        var leaveStartDate = formatDate(row.find('td').eq(4).text());
        var leaveEndDate = formatDate(row.find('td').eq(5).text());
        var leavedays = row.find('td').eq(6).text();
        
        var message = `Proceed to Approve <strong><span style="background-color:#e9f1fb;padding:7px; border-radius:15px;">${leavetype}</span></strong> Leave Application for <strong><span style="background-color:#e9f1fb;padding:7px; border-radius:15px;">${name}</span> applied on <br><br> <strong><span style="background-color:#e9f1fb;padding:7px; border-radius:15px;">${dateapplied}</span></strong> <br><br> for <strong><span style="background-color:#e9f1fb;padding:7px; border-radius:15px;">${leavedays} day(s)</span></strong> <br><br> from <strong><span style="background-color:#e9f1fb;padding:7px; border-radius:15px;">${leaveStartDate}</span></strong> to <strong><span style="background-color:#e9f1fb;padding:7px; border-radius:15px;">${leaveEndDate}</span></strong> <br><br> <span style="background-color:#e9f1fb;padding:7px; border-radius:15px;">[App ID -- <strong>${currentIdapproveapp}</strong>]</span>?`;
        
    
        $('#confirmationMessageapproveapp').html(message);

    });



    let currentIddisapproveapp = null

    $(document).on('click', '.disapprove-app-btn', function() {

        const formatDate = (date) => {
            const options = { day: '2-digit', month: 'long', year: 'numeric' };
            return new Date(date).toLocaleDateString('en-US', options);
        };

        currentIddisapproveapp = $(this).data('id');
        $('#appdisapprove-id').text('APP ID: ' + currentIddisapproveapp);
        var row = $('#leaveappsTableapprovedbyme td').filter(function() {
            return $(this).text() == currentIddisapproveapp;
        }).closest('tr');
        
        var leavetype = row.find('td').eq(2).text();
        var name = row.find('td').eq(1).text();
        var dateapplied = formatDate(row.find('td').eq(3).text());
        var leaveStartDate = formatDate(row.find('td').eq(4).text());
        var leaveEndDate = formatDate(row.find('td').eq(5).text());
        var leavedays = row.find('td').eq(6).text();
        
        var message = `Proceed to Disapprove <strong><span style="background-color:#e9f1fb;padding:7px; border-radius:15px;">${leavetype}</span></strong> Leave Application for <strong><span style="background-color:#e9f1fb;padding:7px; border-radius:15px;">${name}</span> applied on <br><br> <strong><span style="background-color:#e9f1fb;padding:7px; border-radius:15px;">${dateapplied}</span></strong> <br><br> for <strong><span style="background-color:#e9f1fb;padding:7px; border-radius:15px;">${leavedays} day(s)</span></strong> <br><br> from <strong><span style="background-color:#e9f1fb;padding:7px; border-radius:15px;">${leaveStartDate}</span></strong> to <strong><span style="background-color:#e9f1fb;padding:7px; border-radius:15px;">${leaveEndDate}</span></strong> <br><br> <span style="background-color:#e9f1fb;padding:7px; border-radius:15px;">[App ID -- <strong>${currentIddisapproveapp}</strong>]</span>?`;
        
    
        $('#confirmationMessagedisapproveapp').html(message);

    });


    $(document).on('click', '#confirmapproveleaveapp', function() {

        $('#edsLoader').show();  // Hide loading overlay

        $.ajax({
            url: '/approve_leave_application',  // Flask route to handle cancellation
            type: 'POST',
            contentType: 'application/json',
            data: JSON.stringify({ app_id: currentIdapproveapp }),



            success: function(response) {
                $('#approveappModal').modal('hide');  // Close the modal
                $('#edsLoader').hide();  // Hide loading overlay
                setTimeout(function() {
                    alert(response.message);
                }, 100);  // 100ms delay to ensure UI update before alert
                location.reload();  // Reload the page or update the DOM as needed
            },
            error: function (xhr, status, error) {
                $('#edsLoader').hide();
                let errorMsg = "Failed to approve the leave application.";
                try {
                    const responseJSON = JSON.parse(xhr.responseText);
                    if (responseJSON.message) {
                        errorMsg = responseJSON.message;
                    }
                    if (responseJSON.error) {
                        errorMsg += "\nDetails: " + responseJSON.error;
                    }
                } catch (e) {
                    errorMsg += "\nCould not parse error response.";
                }
                console.error("Error:", error);
                alert(errorMsg);
            }
        });
    });

    
    $(document).on('click', '#confirmdisapproveleaveapp', function() {

        $('#edsLoader').show();  // Hide loading overlay

        $.ajax({
            url: '/disapprove_leave_application',  // Flask route to handle cancellation
            type: 'POST',
            contentType: 'application/json',
            data: JSON.stringify({ app_id: currentIddisapproveapp }),



            success: function(response) {
                $('#disapproveappModal').modal('hide');  // Close the modal
                $('#edsLoader').hide();  // Hide loading overlay
                setTimeout(function() {
                    alert(response.message);
                }, 100);  // 100ms delay to ensure UI update before alert
                location.reload();  // Reload the page or update the DOM as needed
            },
            error: function (xhr, status, error) {
                $('#edsLoader').hide();
                let errorMsg = "Failed to disapprove the leave application.";
                try {
                    const responseJSON = JSON.parse(xhr.responseText);
                    if (responseJSON.message) {
                        errorMsg = responseJSON.message;
                    }
                    if (responseJSON.error) {
                        errorMsg += "\nDetails: " + responseJSON.error;
                    }
                } catch (e) {
                    errorMsg += "\nCould not parse error response.";
                }
                console.error("Error:", error);
                alert(errorMsg);
            }
        });
    });








    document.getElementById('saverole').addEventListener('click', function () {
    // Get the role dropdown element
        const roleDropdown = document.getElementById('role-emp');

        // Get the selected option
        const selectedOption = roleDropdown.options[roleDropdown.selectedIndex];

        // Check if a valid role is selected
        if (selectedOption && selectedOption.value !== "") {
            // Update the confirmation message with the selected option's text
            document.getElementById('confirmationMessage').innerHTML =
                `Proceed to assign the role <br><br> <strong><span style="background-color:#e9f1fb;padding:7px; border-radius:15px;">${selectedOption.text}</strong> <br><br> to <strong><span style="margin-top:8px;">${currentFirstName}</span></strong>?`;

            const confirmationModal = new bootstrap.Modal(document.getElementById('confirmationModal'));
            confirmationModal.show();
        } else {
            // Show alert if no valid option is selected
            alert("Please select a valid role before proceeding.");
        }
    });

    // Update selected value dynamically (optional, for reference or debugging)
    document.getElementById('role-emp').addEventListener('change', function () {
        const selectedOption = this.options[this.selectedIndex];
        console.log(`Updated Selection: ${selectedOption.value} (${selectedOption.text})`);
    });

    document.getElementById('savedepartment').addEventListener('click', function () {
    // Get the role dropdown element
        const departmentDropdown = document.getElementById('department-emp');

        // Get the selected option
        const selectedOption = departmentDropdown.options[departmentDropdown.selectedIndex];

        // Check if a valid role is selected
        if (selectedOption && selectedOption.value !== "") {
            // Update the confirmation message with the selected option's text
            document.getElementById('confirmationMessagedepartment').innerHTML =
                `Proceed to assign <strong><span style="margin-top:8px;">${currentFirstName}</span></strong> to the <br><br> <strong><span style="background-color:#e9f1fb;padding:7px; border-radius:15px;">${selectedOption.text}</strong> department?`;

            const confirmationModal = new bootstrap.Modal(document.getElementById('confirmationModaldepartment'));
            confirmationModal.show();
        } else {
            // Show alert if no valid option is selected
            alert("Please select a valid department before proceeding.");
        }
    });

    // Update selected value dynamically (optional, for reference or debugging)
    document.getElementById('department-emp').addEventListener('change', function () {
        const selectedOption = this.options[this.selectedIndex];
        console.log(`Updated Selection: ${selectedOption.value} (${selectedOption.text})`);
    });






    document.getElementById('savebalance').addEventListener('click', function () {
        // Get the input field for the leave days balance
        const balanceDays = document.getElementById('leavedaysbalance-emp');

        // Get the value entered in the input field
        const inputValue = balanceDays.value;

        // Check if a valid number is entered (non-empty and positive number)
        if (inputValue && !isNaN(inputValue) && parseFloat(inputValue) > 0) {
            // Update the confirmation message with the entered number
            document.getElementById('confirmationMessagebalance').innerHTML =
                `Proceed to update <br><br> <strong><span style="background-color:#e9f1fb;padding:7px; border-radius:15px;">${inputValue}</strong> <br><br> as the new Leave Days Balance for <br> <strong><span style="margin-top:8px;">${currentFirstName}</span></strong>?`;

            // Show the confirmation modal
            const confirmationModalbalance = new bootstrap.Modal(document.getElementById('confirmationModalbalance'));
            confirmationModalbalance.show();
        } else {
            // Show alert if no valid number is entered
            alert("Please enter a valid Leave Days Balance before proceeding.");
        }
    });







    document.getElementById('savebalance').addEventListener('click', function () {
        // Get the input field for the leave days balance
        const balanceDays = document.getElementById('leavedaysbalance-emp');

        // Get the value entered in the input field
        const inputValue = balanceDays.value;

        // Check if a valid number is entered (non-empty and positive number)
        if (inputValue && !isNaN(inputValue) && parseFloat(inputValue) > 0) {
            // Update the confirmation message with the entered number
            document.getElementById('confirmationMessagebalance').innerHTML =
                `Proceed to update <br><br> <strong><span style="background-color:#e9f1fb;padding:7px; border-radius:15px;">${inputValue}</strong> <br><br> as the new Leave Days Balance for <br> <strong><span style="margin-top:8px;">${currentFirstName}</span></strong>?`;

            // Show the confirmation modal
            const confirmationModalbalance = new bootstrap.Modal(document.getElementById('confirmationModalbalance'));
            confirmationModalbalance.show();
        } else {
            // Show alert if no valid number is entered
            alert("Please enter a valid Leave Days Balance before proceeding.");
        }
    });

    // Update input value dynamically (optional, for reference or debugging)
    document.getElementById('leavedaysbalance-emp').addEventListener('input', function () {
        const inputValue = this.value;
        console.log(`Updated Leave Days Balance: ${inputValue}`);
    });



    document.getElementById('formaddemployees').addEventListener('click', function() {
        $('#manualaddemployeeModal').modal('show');


    })

    document.getElementById('formaddemployees').addEventListener('click', function() {
        $('#manualaddemployeeModal').modal('show');


    })

    

    document.getElementById('removeselectedemployees').addEventListener('click', function() {
    // Get all the checkboxes that are checked
    const checkboxes = document.querySelectorAll('input[name="employee_ids"]:checked');
    const selectedEmployeeNames = [];
    const selectedEmployeeIds = [];

    // Loop through checked checkboxes and get the corresponding employee name and ID
    checkboxes.forEach(function(checkbox) {
        const row = checkbox.closest('tr');
        const employeeName = row.querySelector('td:nth-child(2)').textContent; // Get the name from the second column
        const employeeId = checkbox.value; // Assuming the checkbox value is the employee ID
        selectedEmployeeNames.push(employeeName);
        selectedEmployeeIds.push(employeeId);
    });

    // Check if at least one employee is selected
    if (selectedEmployeeNames.length > 0) {
        // Populate the confirmation message with the number of selected employees
        const confirmationMessage = `Proceed to remove <strong>${selectedEmployeeNames.length}</strong> employee(s)?`;
        document.getElementById('confirmationMessageremove').innerHTML = confirmationMessage;

        // Populate the modal with selected employee names
        const employeeListDiv = document.getElementById('selectedEmployeesList');
        employeeListDiv.innerHTML = ''; // Clear any previous content

        selectedEmployeeNames.forEach(function(name) {
            const div = document.createElement('div');
            div.textContent = name;
            employeeListDiv.appendChild(div);
        });

        // Show the modal
        $('#confirmationModalremove').modal('show');

        // When 'Yes' is clicked, send the selected employee IDs to the server
        document.getElementById('confirmERemove').addEventListener('click', function() {

            const companyname = $('#company_name').val();  // Get the company name from the hidden input

            fetch('/remove_employees', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    employee_ids: selectedEmployeeIds,
                    companyname: companyname  // Include the company name here

                })
            })
            .then(response => response.json())
            .then(data => {
                // Handle the server response (e.g., display a success message or update the UI)
                if (data.success) {
                    alert('Employees removed successfully!');
                    $('#confirmationModalremove').modal('hide');
                    $('#edsLoader').show();
                    location.reload();  

                    // You can refresh the table or update the UI here as needed
                } else {
                    alert('Error occurred while removing employees.');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('An error occurred. Please try again.');
            });
        });

    } else {
        // Show an alert if no employees are selected
        alert("Please select at least one employee to remove.");
    }
});





});

  </script>
<script>
    $(document).ready(function () {
        // Initialize DataTable for the main employees table
        $('#allprojectsTable').DataTable({
            paging: false,    // Enable pagination
            searching: true, // Enable search
            ordering: true,  // Enable sorting
            info: true,      // Show table information
            pageLength: 8,       // Force max 5 entries per page
            lengthChange: false, // Disable entries per page dropdown
        });


    });
</script>


<script>
    // Function to filter employees based on search input
    function searchEmployees() {
        var input, filter, list, items, label, i;
        input = document.getElementById('employeeSearch');
        filter = input.value.toLowerCase();
        list = document.getElementById('employeeList');
        items = list.getElementsByClassName('employee-item');

        // Loop through the items and hide those that do not match the search query
        for (i = 0; i < items.length; i++) {
            label = items[i].getElementsByTagName('label')[0];
            if (label) {
                if (label.innerText.toLowerCase().indexOf(filter) > -1) {
                    items[i].style.display = "";
                } else {
                    items[i].style.display = "none";
                }
            }
        }
    }
// On page load, retrieve the stored profile and apply it
window.addEventListener('load', function() {
    const savedProfile = localStorage.getItem('selectedProfile');
    
    if (savedProfile) {
        profileSelect.value = savedProfile;
        toggleProfileContent();  // Apply the stored profile on page load
    }
});


</script>


</body>
</html>
